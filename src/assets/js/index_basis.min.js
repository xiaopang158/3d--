!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("vue")):"function"==typeof define&&define.amd?define(["vue"],t):(e="undefined"!=typeof globalThis?globalThis:e||self)["vue-webgl-basis"]=t(e.Vue)}(this,(function(e){"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}function r(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function a(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function s(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?a(Object(i),!0).forEach((function(t){r(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):a(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function d(e,t,i){return(d=u()?Reflect.construct:function(e,t,i){var n=[null];n.push.apply(n,t);var o=new(Function.bind.apply(e,n));return i&&c(o,i.prototype),o}).apply(null,arguments)}function m(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function f(e){return function(e){if(Array.isArray(e))return w(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||p(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(e,t){if(e){if("string"==typeof e)return w(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?w(e,t):void 0}}function w(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function h(e,t){var i;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(i=p(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,a=!0,s=!1;return{s:function(){i=e[Symbol.iterator]()},n:function(){var e=i.next();return a=e.done,e},e:function(e){s=!0,r=e},f:function(){try{a||null==i.return||i.return()}finally{if(s)throw r}}}}var v=function(e,i){if(!e||!i)return!0;var n=!0;if(Object.keys(e).length!=Object.keys(i).length)return!1;for(var o in e)if("object"==t(e[o])){if(!(n=isSame(e[o],i[o])))break}else if(e[o]!=i[o]){n=!1;break}return n},y=function(e){for(var t=[].concat(e),i=[],n=0,o=t.length;n<o;n++){var r=Cesium.Cartographic.fromCartesian(t[n]),a=Cesium.Math.toDegrees(r.longitude),s=Cesium.Math.toDegrees(r.latitude),l=r.height;-1==i.indexOf(a)&&-1==i.indexOf(s)&&(i.push(a),i.push(s),i.push(l))}return i};var g={Message:{errorMsg:function(e){console.log("error",e),alert("error："+e)},warnMsg:function(e){console.log("warn",e)},successMsg:function(e){console.log("success",e)}},axiosJsonp:function(e){if(e)return new Promise((function(t,i){window.jsonCallBack=function(e){t(e)};var n=document.createElement("script");n.type="text/javascript",n.src="".concat(e,"&callback=jsonCallBack"),document.getElementsByTagName("head")[0].appendChild(n),setTimeout((function(){document.getElementsByTagName("head")[0].removeChild(n)}),500)}));console.error("Axios.JSONP 至少需要一个url参数!")},isEqualArr:v,CartesiantoDegrees:y,CartesiantoDegreesObjs:function(e){for(var t=[].concat(e),i=[],n=0,o=t.length;n<o;n++){var r=Cesium.Cartographic.fromCartesian(t[n]),a={longitude:Cesium.Math.toDegrees(r.longitude),latitude:Cesium.Math.toDegrees(r.latitude),height:r.height};i.push(a)}return i},unique:function(e){for(var t=[],i={},n=0;n<e.length;n++)i[e[n]]||(t.push(e[n]),i[e[n]]=1);return t},gradientColors:function(e,t,i,n){var o,r,a,s,l=[],c=[];n=n||1;var u,d=function(e){return Math.pow(e/255,n)};for(e=m(e).map(d),t=m(t).map(d),o=0;o<i;o++){for(s=1-(a=o/(i-1)),r=0;r<3;r++)c[r]=1===(u=Math.round(255*Math.pow(e[r]*s+t[r]*a,1/n)).toString(16)).length?"0"+u:u;l.push("#"+c.join(""))}return l;function m(e){return 4===e.length?e.substr(1).split("").map((function(e){return 17*parseInt(e,16)})):[e.substr(1,2),e.substr(3,2),e.substr(5,2)].map((function(e){return parseInt(e,16)}))}},getAngleAndRadian:function(e,t){var i=Cesium.Transforms.eastNorthUpToFixedFrame(e),n=Cesium.Cartesian3.subtract(t,e,new Cesium.Cartesian3),o=Cesium.Matrix4.multiplyByPointAsVector(Cesium.Matrix4.inverse(i,new Cesium.Matrix4),n,new Cesium.Cartesian3),r=Cesium.Cartesian3.normalize(o,new Cesium.Cartesian3),a=Math.atan2(r.y,r.x)-Cesium.Math.PI_OVER_TWO,s=Cesium.Math.TWO_PI-Cesium.Math.zeroToTwoPi(a),l=s*(180/Math.PI);return l<0&&(l+=360),{angle:l,radian:s}},CartographictoDegrees:function(e){return[Cesium.Math.toDegrees(e.longitude),Cesium.Math.toDegrees(e.latitude),e.height]},getPitch:function(e,t){var i=Cesium.Transforms.eastNorthUpToFixedFrame(e),n=Cesium.Cartesian3.subtract(t,e,new Cesium.Cartesian3),o=Cesium.Matrix4.multiplyByPointAsVector(Cesium.Matrix4.inverse(i,i),n,n);Cesium.Cartesian3.normalize(o,o);var r=Cesium.Math.PI_OVER_TWO-Cesium.Math.acosClamped(o.z),a=r*(180/Math.PI);return a<0&&(a+=360),{angle:a,radian:r}}},C=/^\s+|\s+$/g,b=/^[-+]0x[0-9a-f]+$/i,S=/^0b[01]+$/i,P=/^0o[0-7]+$/i,M=parseInt,E="object"==("undefined"==typeof global?"undefined":t(global))&&global&&global.Object===Object&&global,x="object"==("undefined"==typeof self?"undefined":t(self))&&self&&self.Object===Object&&self,L=E||x||Function("return this")(),R=Object.prototype.toString,I=Math.max,T=Math.min,k=function(){return L.Date.now()};function N(e,t,i){var n,o,r,a,s,l,c=0,u=!1,d=!1,m=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function f(t){var i=n,r=o;return n=o=void 0,c=t,a=e.apply(r,i)}function p(e){return c=e,s=setTimeout(h,t),u?f(e):a}function w(e){var i=e-l;return void 0===l||i>=t||i<0||d&&e-c>=r}function h(){var e=k();if(w(e))return v(e);s=setTimeout(h,function(e){var i=t-(e-l);return d?T(i,r-(e-c)):i}(e))}function v(e){return s=void 0,m&&n?f(e):(n=o=void 0,a)}function y(){var e=k(),i=w(e);if(n=arguments,o=this,l=e,i){if(void 0===s)return p(l);if(d)return s=setTimeout(h,t),f(l)}return void 0===s&&(s=setTimeout(h,t)),a}return t=V(t)||0,B(i)&&(u=!!i.leading,r=(d="maxWait"in i)?I(V(i.maxWait)||0,t):r,m="trailing"in i?!!i.trailing:m),y.cancel=function(){void 0!==s&&clearTimeout(s),c=0,n=l=o=s=void 0},y.flush=function(){return void 0===s?a:v(k())},y}function B(e){var i=t(e);return!!e&&("object"==i||"function"==i)}function D(e){return"symbol"==t(e)||function(e){return!!e&&"object"==t(e)}(e)&&"[object Symbol]"==R.call(e)}function V(e){if("number"==typeof e)return e;if(D(e))return NaN;if(B(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=B(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(C,"");var i=S.test(e);return i||P.test(e)?M(e.slice(2),i?2:8):b.test(e)?NaN:+e}var A=e.reactive({isViewer:!1,changeLayers:0,changeGeometrys:0}),_=function(e){A.isViewer=e},O=function(e){A.changeLayers+=1},F=function(e){A.changeGeometrys+=1,console.log(H.geometrys)},H={geometrys:{},layers:null};function G(e,t){var i=[];try{e&&e.forEach((function(e){i.push(viewer.scene.addS3MTilesLayerByScp(e.url,e.options))})),U(i,t,"S3M")}catch(e){var n=viewer.cesiumWidget;if(n._showRenderLoopErrors){n.showErrorPanel("渲染时发生错误，已停止渲染。",void 0,e)}}}function j(e,t,i){t&&t.SceneToken&&(Cesium.Credential.CREDENTIAL=new Cesium.Credential(t.SceneToken));var n=!0;if(t&&t.autoSetView&&(n=t.autoSetView),function(e){if(null===e||""===e)return!1;if('"'==e.charAt(0)||"'"==e.charAt(0)){var t=/^['|"](.*)['|"]$/;e=e.replace(t,"$1")}return!0}(e))try{U([viewer.scene.open(e,void 0,{autoSetView:n})],i,"SCENE")}catch(e){var o=viewer.cesiumWidget;if(o._showRenderLoopErrors){o.showErrorPanel("渲染时发生错误，已停止渲染。",void 0,e)}}}function U(e,t,i){Cesium.when.all(e,(function(e){console.log("layers:",e),H.layers=viewer.scene.layers.layerQueue,O(),t(e[0],i),H.layers.forEach((function(e){(!e.visibleDistanceMax||e.visibleDistanceMax>12e3)&&(e.visibleDistanceMax=12e3)}))}),(function(e){var t=viewer.cesiumWidget;if(t._showRenderLoopErrors){t.showErrorPanel("请检查url地址是否正确？",void 0,e)}}))}var W={addS3mLayers:G,addScene:j,addTerrainLayer:function(e,t){try{viewer.terrainProvider=new Cesium.CesiumTerrainProvider({url:e,isSct:t})}catch(e){var i=viewer.cesiumWidget;if(i._showRenderLoopErrors){i.showErrorPanel("渲染时发生错误，已停止渲染。",void 0,e)}}},addImageLayer:function(e){try{return viewer.imageryLayers.addImageryProvider(new Cesium.SuperMapImageryProvider({url:e}))}catch(e){var t=viewer.cesiumWidget;if(t._showRenderLoopErrors){t.showErrorPanel("渲染时发生错误，已停止渲染。",void 0,e)}}},layersDelete:function(e,t,i){switch(e){case"S3M":viewer.scene.layers.remove(t),O(),i();break;case"IMG":var n;if("nunber"==typeof t)n=viewer.imageryLayers.get(t);else for(var o=viewer.imageryLayers._layers,r=0;r<o.length;r++)o[r].imageryProvider.tablename&&o[r].imageryProvider.tablename===t&&(n=o[r]);n&&(viewer.imageryLayers.remove(n),O(),i());break;case"TERRAIN":viewer.terrainProvider=new Cesium.EllipsoidTerrainProvider,O(),i();break;case"MVT":viewer.scene.removeVectorTilesMap(t),O(),i()}},addMvtLayer:function(e,t,i){try{var n=viewer.scene.addVectorTilesMap({url:e,canvasWidth:512,name:t||"mvt",viewer:viewer});return Cesium.when(n.readyPromise,(function(e){var t=n.rectangle;viewer.scene.camera.flyTo({destination:new Cesium.Cartesian3.fromRadians(.5*(t.east+t.west),.5*(t.north+t.south),1e4),duration:0,orientation:{heading:0,roll:0}}),O(),i(n)})),n}catch(e){var o=viewer.cesiumWidget;if(o._showRenderLoopErrors){o.showErrorPanel("渲染时发生错误，已停止渲染。",void 0,e)}}}},z={flyByCameraParam:function(e){e&&viewer.scene.camera.flyTo({destination:new Cesium.Cartesian3(e.Cartesian3.x,e.Cartesian3.y,e.Cartesian3.z),orientation:{heading:e.heading,pitch:e.pitch,roll:e.roll},duration:0})},flyByLayerName:function(e,t){if(e&&t)switch(e){case"S3M":var i=viewer.scene.layers.find(t);viewer.flyTo(i,{duration:0});break;case"MVT":var n=viewer.scene.getVectorTilesMap(t).rectangle;viewer.scene.camera.flyTo({destination:new Cesium.Cartesian3.fromRadians(.5*(n.east+n.west),.5*(n.north+n.south),1e4),duration:0,orientation:{heading:0,roll:0}});break;case"IMG":var o;if("nunber"==typeof t)o=viewer.imageryLayers.get(t);else for(var r=viewer.imageryLayers._layers,a=0;a<r.length;a++)r[a].imageryProvider.tablename&&r[a].imageryProvider.tablename===t&&(o=r[a]);o&&viewer.flyTo(o,{duration:0})}}};function K(){}Object.assign(K.prototype,{addEventListener:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];void 0===this._listeners&&(this._listeners={}),this._mutex=this._mutex||{};var n=this._mutex,o=this._listeners;void 0===o[e]&&(o[e]=[]),-1===o[e].indexOf(t)&&(i&&(n[e]=t),o[e].push(t))},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var i=this._listeners;return void 0!==i[e]&&-1!==i[e].indexOf(t)},removeEventListener:function(e,t){if(void 0!==this._listeners){var i=this._listeners[e];if(this._mutex[e]===t&&(this._mutex[e]=null),void 0!==i){var n=i.indexOf(t);-1!==n&&i.splice(n,1)}}},dispatchEvent:function(e){var t=this;if(void 0!==this._listeners){var i=this._listeners[e.type];if(void 0!==i){e.target=this;var n=i.slice(0);if(this._mutex[e.type])return void n.find((function(i){return i===t._mutex[e.type]})).call(this,e);for(var o=0,r=n.length;o<r;o++)n[o].call(this,e)}}},removeAllListener:function(){for(var e in this._mutex={},this._listeners)this._listeners[e]=[]}});var Q="CLICK",X="LEFT_DOWN",Y="LEFT_UP",Z="MOUSE_MOVE",q="RIGHT_CLICK",J="LEFT_DOWN_MOUSE_MOVE",$=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(a,e);var t,n,r=(t=a,n=u(),function(){var e,i=l(t);if(n){var o=l(this).constructor;e=Reflect.construct(i,arguments,o)}else e=i.apply(this,arguments);return m(this,e)});function a(e){var t;return i(this,a),(t=r.call(this)).viewer=e,t.handler=new Cesium.ScreenSpaceEventHandler(t.viewer.scene.canvas),t.handler.setInputAction((function(e){t.dispatchEvent({type:Q,message:e})}),Cesium.ScreenSpaceEventType.LEFT_CLICK),t.handler.setInputAction((function(e){t.press=!0,t.dispatchEvent({type:X,message:e})}),Cesium.ScreenSpaceEventType.LEFT_DOWN),t.handler.setInputAction((function(e){t.press=!1,t.dispatchEvent({type:Y,message:e})}),Cesium.ScreenSpaceEventType.LEFT_UP),t.handler.setInputAction((function(e){t.dispatchEvent({type:q,message:e})}),Cesium.ScreenSpaceEventType.RIGHT_CLICK),t.handler.setInputAction((function(e){t.press&&t.dispatchEvent({type:J,message:e}),t.dispatchEvent({type:Z,message:e})}),Cesium.ScreenSpaceEventType.MOUSE_MOVE),t}return o(a,[{key:"addCameraMoveListener",value:function(e){this.viewer.camera.changed.addEventListener(e)}},{key:"removeCameraMoveListener",value:function(e){this.viewer.camera.changed.removeEventListener(e)}}]),a}(K);function ee(e){var t=function(e){var t=document.createElement("DIV");t.className="tooltip",this._div=t,this.message="",e.appendChild(t)};return t.prototype.setVisible=function(e){this._div.style.right=e?"10px":"-300px"},t.prototype.showAt=function(e,t){t&&(this._div.style.top=t),e&&(this.setVisible(!0),this._div.innerHTML=e)},new t(e)}var te,ie,ne={showRenderLoopErrors:"渲染时发生错误，已停止渲染。",AttributeError:"该组件props没有这个属性：",NoPickPositionSupported:"不支持深度纹理,无法绘制多边形，地形操作功能无法使用！",NoTerrain:"请在地形里使用地形组件！",initViewerWarn:"请先初始化viewer!",MoveMouseHeightBox:"点击鼠标左键结束矩形绘制，移动鼠标绘制box高度",RightClickEndDrawing:"右键单击结束绘制",LeftClickBottomBox:"点击鼠标左键，开始绘制矩形作为box底面",ClickModelAddBox:"点击模型，添加裁剪盒子",SkyLineWarn:"获取天际线体前，请先绘制天际线！",SkyLineBody:"天际线体",ShadowqueryWarn:"此操作需要先开启阴影！",VeiwshedBody:"可视体",VeiwshedBodyHidden:"不可视体",EchartsErr:"二维显示需要echarts支持，未找到相关依赖！",BaseMapImg:"底图",tip1:"<p>点击左键确定操作区域中间点</p><p>右键单击结束绘制</p>"},oe=(ie=(navigator.language||navigator.browserLanguage).toLowerCase(),window.lang=ie,ie).toLowerCase();var re=((te=void 0!==oe?oe:(navigator.language||navigator.browserLanguage).toLowerCase()).startsWith("zh")||te.startsWith("ja"),ne);var ae=function(e,t){var i=0;switch(t&&(i=t),e){case"Point":window.handlerPoint=new Cesium.DrawHandler(viewer,Cesium.DrawMode.Point);break;case"Polyline":window.handlerPolyline=new Cesium.DrawHandler(viewer,Cesium.DrawMode.Line,i);break;case"Polygon":window.handlerPolygon=new Cesium.DrawHandler(viewer,Cesium.DrawMode.Polygon,i);break;case"Marker":window.handlerMarker=new Cesium.DrawHandler(viewer,Cesium.DrawMode.Marker,i);break;case"Box":window.handlerBox=new Cesium.DrawHandler(viewer,Cesium.DrawMode.Box,i)}window.tooltip||(window.tooltip=function(e){var t=function(e){var t=document.createElement("DIV");t.className="twipsy right";var i=document.createElement("DIV");i.className="twipsy-arrow",t.appendChild(i);var n=document.createElement("DIV");n.className="twipsy-inner",t.appendChild(n),this._div=t,this._title=n,this.message="",e.appendChild(t);var o=this;t.onmousemove=function(e){o.showAt({x:e.clientX,y:e.clientY},o.message)}};return t.prototype.setVisible=function(e){this._div.style.display=e?"block":"none"},t.prototype.showAt=function(e,t){e&&t&&(this.setVisible(!0),this._title.innerHTML=t,this._div.style.left=e.x+10+"px",this._div.style.top=e.y-this._div.clientHeight/2+"px",this.message=t)},new t(e)}(viewer._element)),window.polylineCollection||(window.polylineCollection=new Cesium.PolylineCollection({translucentRS:Cesium.RenderState.fromCache({depthMask:!1,depthTest:{enabled:!1}})}),window.polylineTransparent=window.polylineCollection.add({width:2,material:Cesium.Material.fromType(Cesium.Material.ColorType,{color:Cesium.Color.fromCssColorString("#51ff00").withAlpha(.3)})}),viewer.scene.primitives.add(window.polylineCollection))},se=function(e,t,i){var n=!0;!1===t&&(n=t);var o=ce(e);return new Promise((function(t,i){var r=window.tooltip,a=o.activeEvt.addEventListener((function(t){1==t?(viewer.enableCursorStyle=!1,viewer._element.style.cursor="","Point"==e||"Marker"==e?document.body.classList.add("measureCur"):document.body.classList.add("drawCur")):(viewer.enableCursorStyle=!0,r.setVisible(!1),"Point"==e||"Marker"==e?document.body.classList.remove("measureCur"):document.body.classList.remove("drawCur"))})),s=o.movingEvt.addEventListener((function(t){if(t.x<200&&t.y<150)r.setVisible(!1);else if(o.polyline&&o.isDrawing){var i=f(o.positions);"Polygon"==e&&i.push(i[0]),window.polylineTransparent.show=!0,window.polylineTransparent.positions=i}})),l=o.drawEvt.addEventListener((function(i){if(!i.object.positions&&"Point"!=e&&"Box"!=e)return r.showAt(i,"<p>请绘制正确的多边形</p>"),o.polygon.show=!1,o.polyline.show=!1,o.deactivate(),void o.activate();if("Box"!=e){if("Point"==e||"Marker"==e)o.clear(),t({result:i});else{if(window.polylineTransparent.show=n,n&&"Polygon"==e&&n){o.polygon._polygon._material._color._value.alpha=.1;var c=f(i.object.positions);c.push(c[0]),window.polylineTransparent.positions=c}var u=y(i.object.positions);t({result:i,positions:u})}a(),s(),l()}else t({result:i})}))}))},le=function(e){var t;(t=e?ce(e):window.handlerPolygon)&&(t.deactivate(),t.clear(),viewer.enableCursorStyle=!0,window.tooltip.setVisible(!1),window.polylineTransparent&&(window.polylineTransparent.show=!1))},ce=function(e){var t;switch(e){case"Point":t=window.handlerPoint;break;case"Polyline":t=window.handlerPolyline;break;case"Polygon":t=window.handlerPolygon;break;case"Marker":t=window.handlerMarker;break;case"Box":t=window.handlerBox}return t},ue=ae,de=se,me=le,fe=function(e,t,i){window.selectHandler||(window.selectHandler=new Cesium.ScreenSpaceEventHandler(viewer.scene.canvas));var n=window.selectHandler;window.handlerPolygon&&window.handlerPolygon.polygon&&(window.handlerPolygon.polygon.show=!0),n.setInputAction((function(){var o=viewer.selectedEntity,r=window.editHandler;o&&(r&&r&&r.clear(),r?(r.deactivate(),r.setEditObject(o),r.activate()):(window.editHandler=new Cesium.EditHandler(viewer,o),window.editHandler.isEditZ=t||!1,window.editHandler.activate()),n.setInputAction((function(){if(o=viewer.selectedEntity,r=window.editHandler,o&&r&&r._positions){var t=y(r._positions);if(v(e,t))return;if(e=t,i&&i(t,window.editHandler),window.handlerPolygon&&window.handlerPolygon.polygon&&window.handlerPolygon.polygon.show){var n=f(r._positions);n.push(n[0]),window.polylineTransparent.positions=n}}}),Cesium.ScreenSpaceEventType.LEFT_UP))}),Cesium.ScreenSpaceEventType.LEFT_CLICK)},pe=function(){window.editHandler&&(window.editHandler.deactivate(),window.editHandler.clear()),window.selectHandler&&(window.selectHandler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_UP),window.selectHandler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_CLICK),window.selectHandler.destroy(),window.selectHandler=null)};var we=function(){function e(t,n,o,r){i(this,e),this.viewer=t,this.id_type=n,this.pickedEntity=null,this.leftDownFlag=!1,this.moveEndCallBack=o||void 0,this.leftUpCallBack=r||void 0,this.movePickedEntity=null,this.layers=t.scene.layers.layerQueue}return o(e,[{key:"addEventListener",value:function(){for(var e=this,t=0;t<e.layers.length;t++)e.layers[t].selectEnabled=!1;e.viewer.screenSpaceEventHandler.setInputAction((function(t){var i=e.viewer.scene.pick(t.position);if(e.leftDownFlag=!0,i){var n=Cesium.defaultValue(i.id,i.primitive.id);n.id&&n.id.includes(e.id_type)&&(e.pickedEntity=n,e.viewer.scene.screenSpaceCameraController.enableRotate=!1)}}),Cesium.ScreenSpaceEventType.LEFT_DOWN),e.viewer.screenSpaceEventHandler.setInputAction((function(t){e.leftDownFlag=!1,e.viewer.scene.screenSpaceCameraController.enableRotate=!0,e.leftUpCallBack&&e.pickedEntity&&e.leftUpCallBack(e.pickedEntity);e.pickedEntity=null}),Cesium.ScreenSpaceEventType.LEFT_UP),e.viewer.screenSpaceEventHandler.setInputAction((function(t){if(e.leftDownFlag){if(e.pickedEntity){var i=e.viewer.scene.pickPosition(t.endPosition);e.pickedEntity.position=i,e.moveEndCallBack&&e.moveEndCallBack(e.pickedEntity)}}else{var n=e.viewer.scene.pick(t.endPosition);if(n){var o=Cesium.defaultValue(n.id,n.primitive.id);o.id&&o.id.includes(e.id_type)?(e.movePickedEntity=o,o.point.pixelSize=20):e.movePickedEntity&&(e.movePickedEntity.point.pixelSize=10)}else e.movePickedEntity&&(e.movePickedEntity.point.pixelSize=10)}}),Cesium.ScreenSpaceEventType.MOUSE_MOVE)}},{key:"removeEventListener",value:function(){this.viewer.screenSpaceEventHandler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_DOWN),this.viewer.screenSpaceEventHandler.removeInputAction(Cesium.ScreenSpaceEventType.MOUSE_MOVE),this.viewer.screenSpaceEventHandler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_UP)}}]),e}();var he=function(){function e(){i(this,e)}return o(e,[{key:"createXMLflyLine",value:function(e){var t=new DOMParser;window.parser=t;var i=t.parseFromString("<cusxmlRoute></cusxmlRoute>","text/xml");window.xmlDoc=i;var n=this.createSceneRouteNode(i),o=this.createRouteNode(i,e),r=this.createRouteStyleNode(i);o.appendChild(r);var a=e.routeStops;if(!(a.length<2)){for(var s=0;s<a.length;s++){var l=a[s],c={longitude:l.point[0],latitude:l.point[1],altitude:l.point[2],heading:l.heading*(180/Math.PI),tilt:l.tilt*(180/Math.PI)+90},u=this.createStopNode(i,c,l,s);o.appendChild(u)}return n.appendChild(o),i.children[0].appendChild(n),i.children[0].innerHTML}console.warn("节点数小于2")}},{key:"createSceneRouteNode",value:function(e){var t=e.createElement("SceneRoute");return t.setAttribute("xmlns","http://www.supermap.com.cn/ugc60"),t}},{key:"createRouteNode",value:function(e,t){var i=e.createElement("route"),n={name:t.routeName||"飞行路线",speed:t.speed||"200",lineType:"0",showroutestop:"False",showrouteline:"False",altitudefree:"False",headingfree:"False",tiltfree:"False",flycircle:"False",alongline:t.isAlongLine||"False"};for(var o in n)i.setAttribute(o,n[o]);return i}},{key:"createRouteStyleNode",value:function(e){var t=e.createElement("style"),i=e.createElement("geostyle3d"),n=e.createElement("linecolor");n.textContent="RGBA(147,112,219,255)";var o=e.createElement("linewidth");o.textContent=2;var r=e.createElement("altitudeMode");r.textContent="Absolute";var a=e.createElement("bottomAltitude");return a.textContent=0,i.appendChild(n),i.appendChild(o),i.appendChild(r),i.appendChild(a),t.appendChild(i),t}},{key:"createStopNode",value:function(e,t,i,n){var o=e.createElement("routestop"),r={name:i.stopName||"Stop"+(n+1),speed:i.speed,excluded:"False",viewType:"camera"};for(var a in r)o.setAttribute(a,r[a]);var s=this.createStopCameraNode(e,t);o.appendChild(s);var l=this.createStopStyleNode(e);o.appendChild(l);var c=this.createStopSettingNode(e,i);return o.appendChild(c),o}},{key:"createStopCameraNode",value:function(e,t){var i=e.createElement("camera");for(var n in t){var o=e.createElement(n);o.textContent=t[n],i.appendChild(o)}return i}},{key:"createStopStyleNode",value:function(e){var t={icon:"",markersize:4.8,markericonscale:1,markercolor:"RGBA(255, 255, 255, 255)"},i=e.createElement("style"),n=e.createElement("geostyle3d");for(var o in t){var r=e.createElement(o);r.textContent=t[o],n.appendChild(r)}return i.appendChild(n),i}},{key:"createStopSettingNode",value:function(e,t){var i=e.createElement("setting"),n={turnTime:t.surroundDuration||1.5,turnSlowly:"False",stopPlayMode:t.stopPlayMode||"StopPause",autoPlay:"False",pauseTime:t.waitTime||0,angularSpeed:1};for(var o in n){var r=e.createElement(o);r.textContent=n[o],i.appendChild(r)}return i}}]),e}();var ve={polyline:[{id:"1",iconfont:"iconshixian",lineName:"实线"},{id:"2",iconfont:"iconxuxian",lineName:"虚线"},{id:"3",iconfont:"iconlunkuoxian",lineName:"轮廓线"},{id:"4",iconfont:"iconjiantouxian",lineName:"箭头线"},{id:"5",iconfont:"iconguangyunxian",lineName:"光晕线"},{id:"6",iconfont:"iconweijixian",lineName:"尾迹线"},{},{}],polygon:[{id:"1",iconfont:"iconchunse",faceName:"纯色"},{id:"2",iconfont:"iconwangge",faceName:"网格"},{id:"3",iconfont:"icontiaowen",faceName:"条纹"}]};var ye=[{id:0,name:"树木",type:"tree",data:[{id:0,name:"树1",thumbnail:"public/data/s3m/S3MData/tree.png",path:"public/data/s3m/S3MData/tree1.s3m"},{id:1,name:"树2",thumbnail:"public/data/s3m/S3MData/pine.png",path:"public/data/s3m/S3MData/tree2.s3m"},{id:2,name:"树3",thumbnail:"public/data/s3m/S3MData/tree3.png",path:"public/data/s3m/S3MData/tree3.s3m"},{id:3,name:"树4",thumbnail:"public/data/s3m/S3MData/tree2.png",path:"public/data/s3m/S3MData/tree4.s3m"},{id:4,name:"springTree",thumbnail:"public/data/s3m/S3MData/springTree.png",path:"public/data/s3m/S3MData/springTree.s3m"},{id:5,name:"autumnTree",thumbnail:"public/data/s3m/S3MData/autumnTree.png",path:"public/data/s3m/S3MData/autumnTree.s3m"},{id:6,name:"winterTree",thumbnail:"public/data/s3m/S3MData/winterTree.png",path:"public/data/s3m/S3MData/winterTree.s3m"},{},{},{}]},{id:1,name:"公共设施",type:"public-utilities",data:[{id:0,name:"椅子",thumbnail:"public/data/s3m/S3MData/bench.png",path:"public/data/s3m/S3MData/Chair.s3m"},{id:1,name:"垃圾箱",thumbnail:"public/data/s3m/S3MData/Dustbin.png",path:"public/data/s3m/S3MData/Dustbin.s3m"},{id:2,name:"垃圾箱2",thumbnail:"public/data/s3m/S3MData/paper-bucket.png",path:"public/data/s3m/S3MData/Dustbin2.s3m"},{id:3,name:"垃圾桶",thumbnail:"public/data/s3m/S3MData/dustbin1.png",path:"public/data/s3m/S3MData/GarbageCan.s3m"},{id:4,name:"报亭",thumbnail:"public/data/s3m/S3MData/newspaper.png",path:"public/data/s3m/S3MData/NewsStand.s3m"},{id:5,name:"邮政信箱",thumbnail:"public/data/s3m/S3MData/mailbox.png",path:"public/data/s3m/S3MData/PO-Box.s3m"},{id:6,name:"电信电话亭",thumbnail:"public/data/s3m/S3MData/phone-booth.png",path:"public/data/s3m/S3MData/T-TelBooth.s3m"},{},{},{}]},{id:2,name:"交通",type:"traffic",data:[{id:0,name:"限速牌",thumbnail:"public/data/s3m/S3MData/speed-limit.png",path:"public/data/s3m/S3MData/RestrictionBoard.s3m"},{id:1,name:"路灯",thumbnail:"public/data/s3m/S3MData/lamp-post.png",path:"public/data/s3m/S3MData/StreetLight.s3m"},{id:2,name:"红绿灯",thumbnail:"public/data/s3m/S3MData/traffic-light.png",path:"public/data/s3m/S3MData/TrafficLight.s3m"},{},{}]}],ge=function(){function e(){i(this,e),this._positions=null,this.boundingSphere=null,this._geometry=null,this._triangleArrayByWeight=null}return o(e,[{key:"initPolygonEmitter",value:function(e){if(this._positions=Cesium.defaultValue(e,[new Cesium.Cartesian3,new Cesium.Cartesian3,new Cesium.Cartesian3]),this.boundingSphere=Cesium.BoundingSphere.fromPoints(e),Cesium.defaultValue(e)){var t=Cesium.PolygonGeometry.fromPositions({positions:e,perPositionHeight:!0});this._geometry=Cesium.PolygonGeometry.createGeometry(t),this._triangleArrayByWeight=this.initWeight(this._geometry)}}},{key:"initWeight",value:function(e){var t,i,n=new Cesium.Cartesian3,o=new Cesium.Cartesian3,r=new Cesium.Cartesian3,a=e.indices,s=a.length/3,l=e.attributes.position.values,c=[],u=0;for(t=0;t<s;t++){var d=a[3*t],m=a[3*t+1],f=a[3*t+2];n.x=l[3*d],n.y=l[3*d+1],n.z=l[3*d+2],o.x=l[3*m],o.y=l[3*m+1],o.z=l[3*m+2],r.x=l[3*f],r.y=l[3*f+1],r.z=l[3*f+2];var p=this.triangleArea(n,o,r);u+=p,c.push(p)}var w=Math.max(100,10*s),h=[];for(t=0;t<s;t++){var v=Math.floor(c[t]/u*w);for(v=Math.max(1,v),i=0;i<v;i++)h.push(t)}return h}},{key:"triangleArea",value:function(e,t,i){var n=new Cesium.Cartesian3,o=new Cesium.Cartesian3,r=new Cesium.Cartesian3;return n=Cesium.Cartesian3.subtract(t,e,n),o=Cesium.Cartesian3.subtract(i,e,o),r=Cesium.Cartesian3.cross(n,o,r),.5*Cesium.Cartesian3.magnitude(r)}},{key:"randomVertex",value:function(e,t,i,n,o){return(1-Math.sqrt(e))*i+Math.sqrt(e)*(1-t)*n+Math.sqrt(e)*t*o}},{key:"getOneRandomPosition",value:function(){if(Cesium.defaultValue(this._geometry)){var e=Math.floor(Cesium.Math.randomBetween(0,this._triangleArrayByWeight.length)),t=this._triangleArrayByWeight[e],i=this._geometry.indices[3*t],n=this._geometry.indices[3*t+1],o=this._geometry.indices[3*t+2],r=this._geometry.attributes.position.values,a=r[3*i],s=r[3*i+1],l=r[3*i+2],c=r[3*n],u=r[3*n+1],d=r[3*n+2],m=r[3*o],f=r[3*o+1],p=r[3*o+2],w=Cesium.Math.randomBetween(0,1),h=Cesium.Math.randomBetween(0,1),v=this.randomVertex(w,h,a,c,m),y=this.randomVertex(w,h,s,u,f),g=this.randomVertex(w,h,l,d,p);return Cesium.Cartesian3.fromElements(v,y,g)}}},{key:"positions",get:function(){return this._positions},set:function(e){if(Cesium.defaultValue(e)){this._positions=e;var t=Cesium.PolygonGeometry.fromPositions({positions:this._positions,perPositionHeight:!0});this._geometry=Cesium.PolygonGeometry.createGeometry(t),this._triangleArrayByWeight=this.initWeight(this._geometry),this.boundingSphere=Cesium.BoundingSphere.fromPoints(e)}}}]),e}();var Ce=[{id:0,iconfont:"icondianguangyuan",lightName:"点光源"},{id:1,iconfont:"iconjuguangdeng",lightName:"聚光灯"},{id:2,iconfont:"iconpinghangguang",lightName:"平行光"}];var be=[{name:"线状纹理1",type:"line",url:"public/img/particleSystem/line-1.jpg"},{name:"线状纹理2",type:"line",url:"public/img/particleSystem/line-2.jpg"},{name:"环状纹理1",type:"ring",url:"public/img/particleSystem/ring-1.jpg"},{name:"环状纹理2",type:"ring",url:"public/img/particleSystem/ring-2.jpg"},{name:"环状六边形纹理",type:"ring",url:"public/img/particleSystem/ring-3.jpg"}];function Se(e){this.tableName=e.tableName,this.opacityMinValue=e.opacityMinValue,this.opacityMaxValue=e.opacityMaxValue,this.gradientMinOpacity=e.gradientMinOpacity,this.gradientMaxOpacity=e.gradientMaxOpacity,this.visibleMinValue=e.visibleMinValue,this.visibleMaxValue=e.visibleMaxValue}Se.prototype.setColorTable=function(e,t){if(Cesium.defined(e)){var i=e.minValue,n=e.maxValue,o=this.visibleMinValue,r=this.visibleMaxValue;if(o>r){var a=o;o=r,r=a}this.setOpacityFunction(e,i,n,o,r),this.setColorFunction(e,i,n,o,r,t)}},Se.prototype.setOpacityFunction=function(e,t,i,n,o){var r=this.opacityMinValue,a=this.opacityMaxValue,s=new Cesium.PiecewiseFunction;s.addPoint(t,0),s.addPoint(t+(i-t)*n,r),s.addPoint(t+(i-t)*o,a),s.addPoint(t+(i-t)*(o+.01),r),s.addPoint(i,0),e.opacityTransferFunction=s},Se.prototype.setColorFunction=function(e,t,i,n,o,r){var a=new Cesium.ColorTransferFunction,s=(o-n)/15;switch(r){case 1:a.addRGBPoint(t,9/255,9/255,212/255),a.addRGBPoint(t+(i-t)*n,9/255,10/255,1),a.addRGBPoint(t+(i-t)*(n+s),9/255,.2,1),a.addRGBPoint(t+(i-t)*(n+2*s),9/255,.4,1),a.addRGBPoint(t+(i-t)*(n+3*s),9/255,.6,1),a.addRGBPoint(t+(i-t)*(n+4*s),9/255,.8,1),a.addRGBPoint(t+(i-t)*(n+5*s),9/255,1,1),a.addRGBPoint(t+(i-t)*(n+6*s),.2,1,.8),a.addRGBPoint(t+(i-t)*(n+7*s),.4,1,.6),a.addRGBPoint(t+(i-t)*(n+8*s),.6,1,.4),a.addRGBPoint(t+(i-t)*(n+9*s),.8,1,.2),a.addRGBPoint(t+(i-t)*(n+10*s),1,1,0),a.addRGBPoint(t+(i-t)*(n+11*s),1,.8,0),a.addRGBPoint(t+(i-t)*(n+12*s),1,.6,0),a.addRGBPoint(t+(i-t)*(n+13*s),1,.4,0),a.addRGBPoint(t+(i-t)*(n+14*s),1,.2,0),a.addRGBPoint(t+(i-t)*(n+15*s),1,0,0);break;case 2:a.addRGBPoint(t,1,103/255,103/255),a.addRGBPoint(t+(i-t)*n,1,0,1),a.addRGBPoint(t+(i-t)*(n+s),1,.2,1),a.addRGBPoint(t+(i-t)*(n+2*s),1,.4,1),a.addRGBPoint(t+(i-t)*(n+3*s),1,.6,1),a.addRGBPoint(t+(i-t)*(n+4*s),1,.8,1),a.addRGBPoint(t+(i-t)*(n+5*s),1,1,1),a.addRGBPoint(t+(i-t)*(n+6*s),.2,1,.8),a.addRGBPoint(t+(i-t)*(n+7*s),.4,1,.6),a.addRGBPoint(t+(i-t)*(n+8*s),.6,1,.4),a.addRGBPoint(t+(i-t)*(n+9*s),.8,1,.2),a.addRGBPoint(t+(i-t)*(n+10*s),1,1,0),a.addRGBPoint(t+(i-t)*(n+11*s),1,.8,0),a.addRGBPoint(t+(i-t)*(n+12*s),1,.6,0),a.addRGBPoint(t+(i-t)*(n+13*s),1,.4,0),a.addRGBPoint(t+(i-t)*(n+14*s),1,.2,0),a.addRGBPoint(t+(i-t)*(n+15*s),1,0,0);break;case 3:a.addRGBPoint(t,157/255,0,1),a.addRGBPoint(t+(i-t)*n,157/255,0,1),a.addRGBPoint(t+(i-t)*(n+s),157/255,.2,1),a.addRGBPoint(t+(i-t)*(n+2*s),157/255,.4,1),a.addRGBPoint(t+(i-t)*(n+3*s),157/255,.6,1),a.addRGBPoint(t+(i-t)*(n+4*s),157/255,.8,1),a.addRGBPoint(t+(i-t)*(n+5*s),157/255,1,1),a.addRGBPoint(t+(i-t)*(n+6*s),.2,1,.8),a.addRGBPoint(t+(i-t)*(n+7*s),.4,1,.6),a.addRGBPoint(t+(i-t)*(n+8*s),.6,1,.4),a.addRGBPoint(t+(i-t)*(n+9*s),.8,1,.2),a.addRGBPoint(t+(i-t)*(n+10*s),1,1,0),a.addRGBPoint(t+(i-t)*(n+11*s),1,.8,0),a.addRGBPoint(t+(i-t)*(n+12*s),1,.6,0),a.addRGBPoint(t+(i-t)*(n+13*s),1,.4,0),a.addRGBPoint(t+(i-t)*(n+14*s),1,.2,0),a.addRGBPoint(t+(i-t)*(n+15*s),1,0,0);break;case 4:a.addRGBPoint(t,149/255,232/255,249/255),a.addRGBPoint(t+(i-t)*n,149/255,0,1),a.addRGBPoint(t+(i-t)*(n+s),149/255,.2,1),a.addRGBPoint(t+(i-t)*(n+2*s),149/255,.4,1),a.addRGBPoint(t+(i-t)*(n+3*s),149/255,.6,1),a.addRGBPoint(t+(i-t)*(n+4*s),149/255,.8,1),a.addRGBPoint(t+(i-t)*(n+5*s),149/255,1,1),a.addRGBPoint(t+(i-t)*(n+6*s),.2,1,.8),a.addRGBPoint(t+(i-t)*(n+7*s),.4,1,.6),a.addRGBPoint(t+(i-t)*(n+8*s),.6,1,.4),a.addRGBPoint(t+(i-t)*(n+9*s),.8,1,.2),a.addRGBPoint(t+(i-t)*(n+10*s),1,1,0),a.addRGBPoint(t+(i-t)*(n+11*s),1,.8,0),a.addRGBPoint(t+(i-t)*(n+12*s),1,.6,0),a.addRGBPoint(t+(i-t)*(n+13*s),1,.4,0),a.addRGBPoint(t+(i-t)*(n+14*s),1,.2,0),a.addRGBPoint(t+(i-t)*(n+15*s),1,0,0);break;case 5:a.addRGBPoint(t,26/255,1,156/255),a.addRGBPoint(t+(i-t)*n,26/255,0,1),a.addRGBPoint(t+(i-t)*(n+s),26/255,.2,1),a.addRGBPoint(t+(i-t)*(n+2*s),26/255,.4,1),a.addRGBPoint(t+(i-t)*(n+3*s),26/255,.6,1),a.addRGBPoint(t+(i-t)*(n+4*s),26/255,.8,1),a.addRGBPoint(t+(i-t)*(n+5*s),26/255,1,1),a.addRGBPoint(t+(i-t)*(n+6*s),.2,1,.8),a.addRGBPoint(t+(i-t)*(n+7*s),.4,1,.6),a.addRGBPoint(t+(i-t)*(n+8*s),.6,1,.4),a.addRGBPoint(t+(i-t)*(n+9*s),.8,1,.2),a.addRGBPoint(t+(i-t)*(n+10*s),1,1,0),a.addRGBPoint(t+(i-t)*(n+11*s),1,.8,0),a.addRGBPoint(t+(i-t)*(n+12*s),1,.6,0),a.addRGBPoint(t+(i-t)*(n+13*s),1,.4,0),a.addRGBPoint(t+(i-t)*(n+14*s),1,.2,0),a.addRGBPoint(t+(i-t)*(n+15*s),1,0,0);break;default:a.addRGBPoint(t,0,0,1),a.addRGBPoint(t+(i-t)*n,0,0,1),a.addRGBPoint(t+(i-t)*(n+s),0,.2,1),a.addRGBPoint(t+(i-t)*(n+2*s),0,.4,1),a.addRGBPoint(t+(i-t)*(n+3*s),0,.6,1),a.addRGBPoint(t+(i-t)*(n+4*s),0,.8,1),a.addRGBPoint(t+(i-t)*(n+5*s),0,1,1),a.addRGBPoint(t+(i-t)*(n+6*s),.2,1,.8),a.addRGBPoint(t+(i-t)*(n+7*s),.4,1,.6),a.addRGBPoint(t+(i-t)*(n+8*s),.6,1,.4),a.addRGBPoint(t+(i-t)*(n+9*s),.8,1,.2),a.addRGBPoint(t+(i-t)*(n+10*s),1,1,0),a.addRGBPoint(t+(i-t)*(n+11*s),1,.8,0),a.addRGBPoint(t+(i-t)*(n+12*s),1,.6,0),a.addRGBPoint(t+(i-t)*(n+13*s),1,.4,0),a.addRGBPoint(t+(i-t)*(n+14*s),1,.2,0),a.addRGBPoint(t+(i-t)*(n+15*s),1,0,0)}n+15*s<1&&a.addRGBPoint(i,1,0,0),e.colorTransferFunction=a},Se.prototype.setGradientOpacityValue=function(e){var t=e.minValue,i=e.maxValue,n=this.gradientMinOpacity,o=this.gradientMaxOpacity;if(n>o){var r=n;n=o,o=r}e.gradientOpacityMinValue=.1*Math.abs(i-t)*n,e.gradientOpacityMaxValue=.1*Math.abs(i-t)*o};var Pe=function(){function e(){i(this,e),this.emitterModelMatrix=new Cesium.Matrix4,this.translation=new Cesium.Cartesian3,this.rotation=new Cesium.Quaternion,this.hpr=new Cesium.HeadingPitchRoll,this.trs=new Cesium.TranslationRotationScale,this.gravityScratch=new Cesium.Cartesian3,this.state=null,this.particleSystem=null,this.gravity=1,this.fireWokes=[],this.emitterInitialLocation=new Cesium.Cartesian3(0,0,200),this.emitterModelMatrixScratch=new Cesium.Matrix4,this.applyGravity}return o(e,[{key:"create",value:function(e,t,i){var n=this;if(Cesium.defaultValue(e)){this.state=e,this.gravity=e.gravity;return this.particleSystem=viewer.scene.primitives.add(new Cesium.ParticleSystem({image:e.image,startColor:Cesium.Color.fromCssColorString(e.startColor),endColor:Cesium.Color.fromCssColorString(e.endColor),startScale:Number(e.startScale),endScale:Number(e.endScale),minimumParticleLife:Number(e.particleLife[0]),maximumParticleLife:Number(e.particleLife[1]),minimumSpeed:Number(e.speed[0]),maximumSpeed:Number(e.speed[1]),imageSize:new Cesium.Cartesian2(Number(e.particleSize),Number(e.particleSize)),emissionRate:Number(e.emissionRate),lifetime:Number(e.lifetime),loop:!0,bursts:e.bursts,emitter:this.computeEmitter(e.emitter,i),emitterModelMatrix:this.computeEmitterModelMatrix(void 0,void 0,t),updateCallback:function(e,t){var i=e.position;Cesium.Cartesian3.normalize(i,n.gravityScratch),Cesium.Cartesian3.multiplyByScalar(n.gravityScratch,Number(n.gravity)*t,n.gravityScratch),e.velocity=Cesium.Cartesian3.add(e.velocity,n.gravityScratch,e.velocity)},sizeInMeters:!0,modelMatrix:this.computeModelMatrix(t),performance:!1})),this.particleSystem}}},{key:"computeModelMatrix",value:function(e){return e?Cesium.Transforms.eastNorthUpToFixedFrame(e,void 0,new Cesium.Matrix4):Cesium.Matrix4.IDENTITY}},{key:"computeEmitterModelMatrix",value:function(e,t,i){return i?(this.hpr=Cesium.HeadingPitchRoll.fromDegrees(0,0,0,this.hpr),this.trs.translation=Cesium.Cartesian3.fromElements(0,0,4,this.translation),e&&(this.hpr=Cesium.HeadingPitchRoll.fromDegrees(e.heading,e.pitch,e.roll,this.hpr)),t&&(this.trs.translation=Cesium.Cartesian3.fromElements(t.x,t.y,t.z,this.translation)),this.trs.rotation=Cesium.Quaternion.fromHeadingPitchRoll(this.hpr,this.rotation),console.log(this.hpr),Cesium.Matrix4.fromTranslationRotationScale(this.trs,this.emitterModelMatrix)):Cesium.Matrix4.IDENTITY}},{key:"computeEmitterModelMatrixByHpr",value:function(e,t){for(var i in console.log(123),e)0!=e[i]&&(this.hpr[i]-=e[i]);return this.trs.rotation=Cesium.Quaternion.fromHeadingPitchRoll(this.hpr,this.rotation),Cesium.Matrix4.fromTranslationRotationScale(this.trs,this.emitterModelMatrix)}},{key:"computeEmitter",value:function(e,t){var i,n,o=e[0],r=e[1];switch(o){case"CircleEmitter":n=d(Cesium.CircleEmitter,f(r));break;case"SphereEmitter":n=d(Cesium.SphereEmitter,f(r));break;case"ConeEmitter":n=new Cesium.ConeEmitter((i=Cesium.Math).toRadians.apply(i,f(r)));break;case"BoxEmitter":n=new Cesium.BoxEmitter(d(Cesium.Cartesian3,f(r)));break;case"PolygonEmitter":n=new Cesium.PolygonEmitter(t);break;default:n=new Cesium.CircleEmitter(2)}return n}},{key:"clear",value:function(){Cesium.defaultValue(this.particleSystem)&&viewer.scene._primitives.remove(this.particleSystem)}},{key:"createFirework",value:function(e,t,i,n){var o=Cesium.Cartesian3.add(this.emitterInitialLocation,e,new Cesium.Cartesian3),r=Cesium.Matrix4.fromTranslation(o,this.emitterModelMatrixScratch);var a=viewer.scene.primitives.add(new Cesium.ParticleSystem({image:"public/img/particle/flaretrail6.png",startColor:t,endColor:t.withAlpha(0),minimumParticleLife:1,maximumParticleLife:2,speed:80,imageSize:new Cesium.Cartesian2(15,15),emissionRate:0,emitter:new Cesium.SphereEmitter(.1),bursts:i,lifetime:12,updateCallback:function(e,t){var i=e.position,n=Cesium.Cartesian3.normalize(i,new Cesium.Cartesian3);Cesium.Cartesian3.multiplyByScalar(n,1*t,n),e.velocity=Cesium.Cartesian3.add(e.velocity,n,e.velocity)},modelMatrix:this.computeModelMatrix(n),emitterModelMatrix:r,performance:!1}));this.fireWokes.push(a)}},{key:"clearFireWoke",value:function(){this.fireWokes.forEach((function(e){viewer.scene._primitives.remove(e)})),this.fireWokes.length=0}},{key:"getState",get:function(){return this.state}},{key:"setNewState",set:function(e){Cesium.defaultValue(e)&&(this.state=e)}}]),e}(),Me=[{particleType:"flame",particleList:[{image:"public/img/particle/基础火焰.png",startColor:"rgba(255, 255, 255, 0.3)",endColor:"rgba(0, 0, 0, 0)",lifetime:6,loop:!0,sizeInMeters:!0,emissionRate:50,gravity:0,particleLife:[1.5,1.6],speed:[3.5,4],startScale:2.5,endScale:1,particleSize:2,emitter:["ConeEmitter",[60]]},{image:"public/img/particle/环状火焰-火焰.png",startColor:"rgba(255, 255, 255, 0.3)",endColor:"rgba(102, 76.5, 0, 0)",lifetime:6,loop:!0,sizeInMeters:!0,emissionRate:200,gravity:0,particleLife:[3,4],speed:[.1,3],startScale:1,endScale:2,particleSize:5,emitter:["CircleEmitter",[30,25]]},{image:"public/img/particle/基础火焰.png",startColor:"rgba(255, 255, 255, 0.3)",endColor:"rgba(0, 0, 0, 0)",lifetime:16,loop:!0,sizeInMeters:!0,emissionRate:40,gravity:0,particleLife:[7,7],speed:[4,4],startScale:1,endScale:1.5,particleSize:1,emitter:["CircleEmitter",[.2]]},{image:"public/img/particle/流淌火-火焰.png",startColor:"rgba(255, 255, 255, 0.8)",endColor:"rgba(0, 0, 0, 0)",lifetime:16,loop:!0,sizeInMeters:!0,emissionRate:1800,gravity:1,particleLife:[1.5,5],speed:[6,24],startScale:2,endScale:4,particleSize:6,emitter:["PolygonEmitter",[]]},{image:"public/img/particle/爆炸起火.png",startColor:"rgba(255, 255, 255, 1)",endColor:"rgba(51,51, 51, 0)",lifetime:5,loop:!0,sizeInMeters:!0,emissionRate:30,gravity:.5,particleLife:[1.6,2.2],speed:[3,4],startScale:3,endScale:1.5,particleSize:2,emitter:["ConeEmitter",[65]]}]},{particleType:"fountain",particleList:[{image:"public/img/particle/水柱.png",startColor:"rgba(255, 255, 255, 0.6)",endColor:"rgba(204, 219, 255, 0.4)",lifetime:16,loop:!0,sizeInMeters:!0,emissionRate:40,gravity:-2.6,particleLife:[5,6],speed:[9,9.5],startScale:1,endScale:20,particleSize:1,emitter:["CircleEmitter",[.2]]},{image:"public/img/particle/水柱.png",startColor:"rgba(146, 170, 193, 1)",endColor:"rgba(146, 170, 193, 0)",lifetime:16,loop:!0,sizeInMeters:!0,emissionRate:40,gravity:-.5,particleLife:[7,7],speed:[4,4],startScale:1,endScale:1.5,particleSize:1,emitter:["CircleEmitter",[.2]]}]}];var Ee={initDrag:function(e,t){e.directive("drag",{beforeMount:function(e,t){var i,n,o,r,a,s,l=!1,c=e;c.addEventListener("touchstart",(function(e){if(l=!0,e.changedTouches[0]){var t=e.changedTouches[0],i=t.clientX,n=t.clientY;o=i-e.changedTouches[0].target.x,r=n-e.changedTouches[0].target.y,a=document.body.clientWidth,s=document.body.clientHeight}}),{passive:!1}),c.addEventListener("touchmove",N((function(t){t.preventDefault(),i=t.changedTouches[0].clientX-o,n=t.changedTouches[0].clientY-r,i<0&&n<0?(e.style.left="0px",e.style.top="0px"):i<0&&n+e.clientHeight<s?(e.style.left="0px",e.style.top=n+"px"):i<0&&n+e.clientHeight>=s?(e.style.left="0px",e.style.top=s-e.clientHeight+"px"):i+e.clientWidth>a&&n<0?(e.style.left=a-e.clientWidth+"px",e.style.top="0px"):i+e.clientWidth<a&&n+e.clientHeight>=s?(e.style.left=i+"px",e.style.top=s-e.clientHeight+"px"):i+e.clientWidth<a&&n<0?(e.style.left=i+"px",e.style.top="0px"):i+e.clientWidth>a&&n+e.clientHeight<s?(e.style.left=a-e.clientWidth+"px",e.style.top=n+"px"):i+e.clientWidth>a&&n+e.clientHeight>=s?(e.style.left=a-e.clientWidth+"px",e.style.top=s-e.clientHeight+"px"):(e.style.left=i+"px",e.style.top=n+"px")}),5),{passive:!1}),c.addEventListener("touchend",(function(e){l=!1,document.ontouchmove=null,document.ontouchmove=null,e.changedTouches[0].clientX,e.changedTouches[0].clientY}),{passive:!1}),c.onmousedown=function(t){if(a=document.body.clientWidth,s=document.body.clientHeight,!l){l=!0;var o=t.clientX,r=t.clientY,c=o-e.offsetLeft,u=r-e.offsetTop;document.onmousemove=N((function(t){i=t.clientX-c,n=t.clientY-u,i<0&&n<0?(e.style.left="0px",e.style.top="0px"):i<0&&n+e.clientHeight<s?(e.style.left="0px",e.style.top=n+"px"):i<0&&n+e.clientHeight>=s?(e.style.left="0px",e.style.top=s-e.clientHeight+"px"):i+e.clientWidth>a&&n<0?(e.style.left=a-e.clientWidth+"px",e.style.top="0px"):i+e.clientWidth<a&&n+e.clientHeight>=s?(e.style.left=i+"px",e.style.top=s-e.clientHeight+"px"):i+e.clientWidth<a&&n<0?(e.style.left=i+"px",e.style.top="0px"):i+e.clientWidth>a&&n+e.clientHeight<s?(e.style.left=a-e.clientWidth+"px",e.style.top=n+"px"):i+e.clientWidth>a&&n+e.clientHeight>=s?(e.style.left=a-e.clientWidth+"px",e.style.top=s-e.clientHeight+"px"):(e.style.left=i+"px",e.style.top=n+"px")}),5),document.onmouseup=function(e){document.onmousedown=null,document.onmousemove=null,l=!1}}}}}),e.directive("stopdrag",{beforeMount:function(e,t){e.onmousedown=function(e){"el-input__inner"!=e.target.className&&e.stopPropagation()}}})},tool:g,layerManagement:W,camera:z,initViewer:function(t,i){var n;if(window.viewer&&(window.viewer=null),window.isPCBroswer=Cesium.FeatureDetection.isPCBroswer())n=new Cesium.Viewer("cesiumContainer",{selectionIndicator:!1,timeline:!0,baseLayerPicker:!1,infoBox:!1,navigation:!1}),document.getElementsByClassName("cesium-viewer-timelineContainer")[0].style.visibility="hidden";else{var o=(n=new Cesium.Viewer("cesiumContainer",{selectionIndicator:!1,infoBox:!1,skyBox:!1,navigation:!1,contextOptions:{requestWebgl2:!0}})).scene;Cesium.defined(o.sun)&&(o.globe.enableLighting=!1),Cesium.defined(o.moon)&&(o.moon.show=!1),document.documentElement.style.height=window.innerHeight+"px",document.addEventListener("touchmove",(function(e){e.preventDefault()}),!1)}n.scene.debugShowFramesPerSecond=!0,n.scene.globe.baseColor=Cesium.Color.BLACK,window.viewer=n,window.scene=n.scene,scene.moon.show=!1,n.eventManager=new $(n);var r=n.cesiumWidget;_(!0),n.geocoder&&(n.geocoder.viewModel.geoKey="fvV2osxwuZWlY0wJb8FEb2i5"),window.tooltip||(window.tooltip=ee(n._element));try{t&&t.openingAnimation&&n.camera.flyTo({destination:new Cesium.Cartesian3(6788287.844465209,-41980756.10214644,29619220.04004376),duration:0,complete:function(){n.camera.flyTo({destination:new Cesium.Cartesian3.fromDegrees(110.60396458865515,34.54408834959379,30644793.325518917),duration:5})}}),t&&t.afterInitviewer&&t.afterInitviewer(),t&&t.sceneUrl&&j(t.sceneUrl,{},(function(e){})),t&&t.s3mScps&&G(t.s3mScps)}catch(e){if(r._showRenderLoopErrors){var a=re.showRenderLoopErrors;r.showErrorPanel(a,void 0,e)}}e.onBeforeUnmount((function(){n.destroy(),window.viewer=void 0,window.scene=void 0}))},terrainOperation:function(t){var i=e.reactive({digDepth:500,isEdit:!1,isEditZ:!1,lineVisible:!0,digPositions:[],modifyPositions:[],operationType:"dig",terrainVisible:"terrainVisible"});if(t)for(var n in t)i.hasOwnProperty(n)?i[n]=t[n]:g.Message.errorMsg(re.AttributeError+n);var o=[],r=[],a="dig";function l(e){e&&(o=e),viewer.scene.globe.removeAllExcavationRegion(),viewer.scene.globe.addExcavationRegion({name:"dig_terrain",position:o,height:i.digDepth,transparent:!1})}function c(e){e&&(r=e),viewer.scene.globe.removeAllModifyRegion(),viewer.scene.globe.addModifyRegion({name:"ggg",position:r})}return t&&t.digPositions&&l(t.digPositions),e.watch((function(){return i.digDepth}),(function(e){0!=o.length&&l()})),e.watch((function(){return i.isEdit}),(function(e){e&&window.handlerPolygon?"dig"===a?fe(o,i.isEditZ,l):fe(r,i.isEditZ,c):(pe(),window.handlerPolygon&&window.handlerPolygon.polygon&&(window.handlerPolygon.polygon.show=!1))})),e.watch((function(){return i.isEditZ}),(function(e){window.editHandler&&(window.editHandler.isEditZ=e)})),e.watch((function(){return i.terrainVisible}),(function(e){switch(e){case"terrainVisible":viewer.terrainProvider._visible=!0;break;case"terrainUnvisible":viewer.terrainProvider._visible=!1}})),s(s({},e.toRefs(i)),{},{digTerrain:function(e){e.preventDefault(),a="dig",window.handlerPolygon||ae("Polygon"),se("Polygon",i.lineVisible).then((function(e){o=e.positions;var t=window.handlerPolygon;l(e.positions),t.polygon.show=!1,t.polyline.show=!1,t.deactivate(),i.isEdit&&fe(o,i.isEditZ,l)}),(function(e){console.log(e)})),window.handlerPolygon.activate(),viewer.scene.pickPositionSupported||g.Message.errorMsg(re.NoPickPositionSupported)},clearDig:function(e){e.preventDefault(),o=[],window.handlerPolygon&&(viewer.scene.globe.removeAllExcavationRegion(),le("Polygon"),pe())},modifyTerrain:function(e){e.preventDefault(),a="modify",window.handlerPolygon||ae("Polygon"),se("Polygon",i.lineVisible).then((function(e){r=e.positions;var t=window.handlerPolygon;c(e.positions),t.polygon.show=!1,t.polyline.show=!1,i.isEdit&&fe(r,i.isEditZ,c)}),(function(e){console.log(e)})),window.handlerPolygon.activate(),viewer.scene.pickPositionSupported||alert("不支持深度纹理,无法绘制多边形，地形修改功能无法使用！")},clearModify:function(e){e.preventDefault(),window.handlerPolygon&&(viewer.scene.globe.removeAllModifyRegion(),le("Polygon"),pe())},digPosition:o,modifyPosition:r})},terrainSlope:function(t){var i=e.reactive({analysisArea:"ARM_REGION",displayMode:"FACE_AND_ARROW",wideMaxR:90,wideMinR:0,slopeInterval:[0,90],trans:.8,isEdit:!1,slopePositions:[],lineVisible:!0});if(t)for(var n in t)i.hasOwnProperty(n)?i[n]=t[n]:g.Message.errorMsg(re.AttributeError+n);var o=!0,r=new Cesium.SlopeSetting,a=Cesium.HypsometricSettingEnum.AnalysisRegionMode[i.analysisArea],l=Cesium.SlopeSettingEnum.DisplayMode[i.displayMode],c=new Cesium.ColorTable,u=[];function d(e){e&&(u=e),r.CoverageArea=e,viewer.scene.globe.SlopeSetting={slopeSetting:r,analysisMode:a}}return c.insert(80,new Cesium.Color(1,0,0)),c.insert(50,new Cesium.Color(221/255,224/255,7/255)),c.insert(30,new Cesium.Color(20/255,187/255,18/255)),c.insert(20,new Cesium.Color(0,161/255,1)),c.insert(0,new Cesium.Color(9/255,9/255,1)),t&&t.slopePositions&&d(t.slopePositions),A.isViewer&&(window.tooltip||(window.tooltip=ee(viewer._element))),e.watch((function(){return A.isViewer}),(function(e){e&&(window.tooltip||(window.tooltip=ee(viewer._element)))})),e.watch((function(){return i.analysisArea}),(function(e){switch(e){case"ARM_REGION":a=Cesium.HypsometricSettingEnum.AnalysisRegionMode.ARM_REGION;break;case"ARM_ALL":a=Cesium.HypsometricSettingEnum.AnalysisRegionMode.ARM_ALL;break;case"ARM_NONE":a=Cesium.HypsometricSettingEnum.AnalysisRegionMode.ARM_NONE}0!=u.length&&d(u)})),e.watch((function(){return i.wideMaxR}),(function(e){r.MaxVisibleValue=parseFloat(e),0!=u.length&&(viewer.scene.globe.SlopeSetting={slopeSetting:r,analysisMode:a})})),e.watch((function(){return i.wideMinR}),(function(e){r.MinVisibleValue=parseFloat(e),0!=u.length&&(viewer.scene.globe.SlopeSetting={slopeSetting:r,analysisMode:a})})),e.watch((function(){return i.slopeInterval}),(function(e){i.wideMinR=e[0],i.wideMaxR=e[1]})),e.watch((function(){return i.displayMode}),(function(e){switch(e){case"FACE":l=Cesium.SlopeSettingEnum.DisplayMode.FACE;break;case"ARROW":l=Cesium.SlopeSettingEnum.DisplayMode.ARROW;break;case"FACE_AND_ARROW":l=Cesium.SlopeSettingEnum.DisplayMode.FACE_AND_ARROW}r.DisplayMode=l,0!=u.length&&d(u)})),e.watch((function(){return i.trans}),(function(e){r.Opacity=parseFloat(e),0!=u.length&&(viewer.scene.globe.SlopeSetting={slopeSetting:r,analysisMode:a})})),e.watch((function(){return i.isEdit}),(function(e){e&&window.handlerPolygon?fe(u,!1,d):(pe(),window.handlerPolygon&&window.handlerPolygon.polygon&&(window.handlerPolygon.polygon.show=!1))})),e.onBeforeUnmount((function(){r.destroy(),c.destroy(),r=void 0,c=void 0})),s(s({},e.toRefs(i)),{},{startSlope:function(e){e.preventDefault(),tooltip.setVisible(!1),o&&(window.tooltip.showAt(" <p>点击鼠标左键绘制分析区域</p><p>点击鼠标右键结束绘制</p><p>坡度坡向分析需要带法线地形</p>","250px"),o=!1),r.DisplayMode=l,r.MaxVisibleValue=i.wideMaxR,r.MinVisibleValue=i.wideMinR,r.ColorTable=c,r.Opacity=i.trans,window.handlerPolygon||ae("Polygon"),se("Polygon",i.lineVisible).then((function(e){d(u=e.positions);var t=window.handlerPolygon;t.polygon.show=!1,t.polyline.show=!1,t.deactivate(),i.isEdit&&fe(u,!1,d)}),(function(e){console.log(e)})),handlerPolygon.activate(),scene.pickPositionSupported||g.Message.errorMsg(re.NoPickPositionSupported)},clearSlope:function(e){e.preventDefault(),u=[],window.handlerPolygon&&(viewer.scene.globe.SlopeSetting={analysisMode:Cesium.HypsometricSettingEnum.AnalysisRegionMode.ARM_NONE},tooltip.setVisible(!1),le("Polygon"),pe())},slopePosition:u})},terrainIsoline:function(t){var i=e.reactive({fillMaxHeight:9e3,fillMinHeight:0,fillHeight:[0,9e3],equivalentIsoline:100,fillOptionsSelected:"Line",lineColor:"#FF8040",isEdit:!1,isolinePositions:[],lineVisible:!0});if(t)for(var n in t)i.hasOwnProperty(n)?i[n]=t[n]:g.Message.errorMsg(re.AttributeError+n);var o=new Cesium.HypsometricSetting,r=Cesium.HypsometricSettingEnum.DisplayMode.LINE,a=new Cesium.ColorTable;!function(e){e.insert(5597.06640625,new Cesium.Color(0,0,1)),e.insert(5406.387386067709,new Cesium.Color(0,.2,1)),e.insert(5215.708365885417,new Cesium.Color(0,.4,1)),e.insert(5025.029345703126,new Cesium.Color(0,.6,1)),e.insert(4834.350325520834,new Cesium.Color(0,.8,1)),e.insert(4643.671305338543,new Cesium.Color(0,1,1)),e.insert(4452.992285156252,new Cesium.Color(.2,1,.8)),e.insert(4262.313264973961,new Cesium.Color(.4,1,.6)),e.insert(4071.6342447916695,new Cesium.Color(.6,1,.4)),e.insert(3880.955224609378,new Cesium.Color(.8,1,.2)),e.insert(3690.2762044270867,new Cesium.Color(1,1,0)),e.insert(3499.5971842447952,new Cesium.Color(1,.8,0)),e.insert(3308.918164062504,new Cesium.Color(1,.6,0)),e.insert(3118.239143880213,new Cesium.Color(1,.4,0)),e.insert(2927.5601236979214,new Cesium.Color(1,.2,0)),e.insert(2736.88110351563,new Cesium.Color(1,0,0))}(a);var l=[];function c(e){e&&(l=e),0!=l.length&&(e&&(o.CoverageArea=e),viewer.scene.globe.HypsometricSetting={hypsometricSetting:o,analysisMode:Cesium.HypsometricSettingEnum.AnalysisRegionMode.ARM_REGION})}return t&&t.isolinePositions&&c(t.isolinePositions),e.watch((function(){return i.fillMaxHeight}),(function(e){o.MaxVisibleValue=parseFloat(e),0!=l.length&&c()})),e.watch((function(){return i.fillMinHeight}),(function(e){o.MinVisibleValue=parseFloat(e),0!=l.length&&c()})),e.watch((function(){return i.fillHeight}),(function(e){i.fillMinHeight=e[0],i.fillMaxHeight=e[1]})),e.watch((function(){return i.equivalentIsoline}),(function(e){o.LineInterval=parseFloat(e),0!=l.length&&c()})),e.watch((function(){return i.lineColor}),(function(e){if(e){if(o._lineColor=Cesium.Color.fromCssColorString(e),0==l.length)return;c()}else console.warn("err: color is  null")})),e.watch((function(){return i.fillOptionsSelected}),(function(e){switch(e){case"None":r=void 0;break;case"Line":r=Cesium.HypsometricSettingEnum.DisplayMode.LINE,o.Opacity=1;break;case"Region":r=Cesium.HypsometricSettingEnum.DisplayMode.FACE,o.Opacity=.5;break;case"Line_Region":r=Cesium.HypsometricSettingEnum.DisplayMode.FACE_AND_LINE,o.Opacity=.5}o.DisplayMode=r,0!=l.length&&c(l)})),e.watch((function(){return i.isEdit}),(function(e){e&&window.handlerPolygon?fe(l,!1,c):(pe(),window.handlerPolygon&&window.handlerPolygon.polygon&&(window.handlerPolygon.polygon.show=!1))})),e.onBeforeUnmount((function(){o.destroy(),a.destroy(),o=void 0,a=void 0})),s(s({},e.toRefs(i)),{},{isoLineAnalysis:function(e){e.preventDefault(),o.DisplayMode=r,o._lineColor=Cesium.Color.fromCssColorString(i.lineColor),o.LineInterval=parseFloat(i.equivalentIsoline),o.MaxVisibleValue=parseFloat(i.fillMaxHeight),o.MinVisibleValue=parseFloat(i.fillMinHeight),o.ColorTableMinKey=2736.88110351563,o.ColorTableMaxKey=5597.06640625,o.ColorTable=a,window.handlerPolygon||ae("Polygon"),se("Polygon",i.lineVisible).then((function(e){l=e.positions;var t=window.handlerPolygon;c(l),t.polygon.show=!1,t.polyline.show=!1,t.deactivate(),i.isEdit&&fe(l,!1,c)}),(function(e){console.log(e)})),window.handlerPolygon.activate(),scene.pickPositionSupported||g.Message.errorMsg(re.NoPickPositionSupported)},clearIsoLine:function(e){e.preventDefault(),l=[],window.handlerPolygon&&(viewer.scene.globe.HypsometricSetting=void 0,o&&(o.MaxVisibleValue=-1e3),o&&(o.MinVisibleValue=-1e3),le("Polygon"),pe())},isolinePosition:l})},terrainFlood:function(t){var i=e.reactive({maxHeight:9e3,minHeight:1e3,floodHeight:[1e3,9e3],currentHeight:1e3,floodTrans:.8,cheackedBand:"band1",colorBandShow:!1,floodSpeed:800,floodPositions:[],lineVisible:!0});if(t)for(var n in t)i.hasOwnProperty(n)?i[n]=t[n]:g.Message.errorMsg(re.AttributeError+n);var o,r=Cesium.HypsometricSettingEnum.DisplayMode.FACE,a=new Cesium.HypsometricSetting,l=new Cesium.ColorTable;l.insert(9e3,new Cesium.Color(0,39/255,148/255)),l.insert(0,new Cesium.Color(149/255,232/255,249/255));var c=[];function u(e){e&&(c=e);var t=parseFloat(i.minHeight);a.CoverageArea=e,o=setInterval("flood()",100),window.flood=function(){if(t<=i.maxHeight&&(i.currentHeight=parseInt(t)),t>i.maxHeight)return i.currentHeight=i.maxHeight,void clearInterval(o);a.MaxVisibleValue=t;try{viewer.scene.globe.HypsometricSetting={hypsometricSetting:a,analysisMode:Cesium.HypsometricSettingEnum.AnalysisRegionMode.ARM_REGION}}catch(e){console.log(e),clearInterval(o)}t+=parseFloat(i.floodSpeed)/10}}return e.watch((function(){return i.floodTrans}),(function(e){a.Opacity=parseFloat(e),0!=c.length&&(viewer.scene.globe.HypsometricSetting={hypsometricSetting:a,analysisMode:Cesium.HypsometricSettingEnum.AnalysisRegionMode.ARM_REGION})})),e.watch((function(){return i.floodHeight}),(function(e){i.minHeight=e[0],i.maxHeight=e[1]})),e.watch((function(){return i.minHeight}),(function(e){a.MinVisibleValue=parseInt(e),0!=c.length?viewer.scene.globe.HypsometricSetting={hypsometricSetting:a,analysisMode:Cesium.HypsometricSettingEnum.AnalysisRegionMode.ARM_REGION}:i.currentHeight=parseInt(e)})),e.watch((function(){return i.maxHeight}),(function(e){a.MaxVisibleValue=parseInt(e),0!=c.length&&(viewer.scene.globe.HypsometricSetting={hypsometricSetting:a,analysisMode:Cesium.HypsometricSettingEnum.AnalysisRegionMode.ARM_REGION})})),e.watch((function(){return i.cheackedBand}),(function(e){l=function(e){var t=new Cesium.ColorTable;switch(e){case"band1":t.insert(9e3,new Cesium.Color(0,39/255,148/255)),t.insert(0,new Cesium.Color(149/255,232/255,249/255));break;case"band2":t.insert(9e3,new Cesium.Color(162/255,251/255,194/255)),t.insert(0,new Cesium.Color(1,103/255,103/255));break;case"band3":t.insert(9e3,new Cesium.Color(230/255,198/255,1)),t.insert(0,new Cesium.Color(157/255,0,1));break;case"band4":t.insert(9e3,new Cesium.Color(210/255,15/255,15/255)),t.insert(6e3,new Cesium.Color(221/255,224/255,7/255)),t.insert(5e3,new Cesium.Color(20/255,187/255,18/255)),t.insert(4e3,new Cesium.Color(0,161/255,1)),t.insert(0,new Cesium.Color(9/255,9/255,212/255));break;case"band5":t.insert(9e3,new Cesium.Color(186/255,1,229/255)),t.insert(0,new Cesium.Color(26/255,185/255,156/255));break;default:t.insert(9e3,new Cesium.Color(0,39/255,148/255)),t.insert(0,new Cesium.Color(149/255,232/255,249/255))}return t}(e),a.ColorTable=l,0!=c.length&&o&&(viewer.scene.globe.HypsometricSetting={hypsometricSetting:a,analysisMode:Cesium.HypsometricSettingEnum.AnalysisRegionMode.ARM_REGION})})),e.onBeforeUnmount((function(){a.destroy(),l.destroy(),a=void 0,l=void 0})),s(s({},e.toRefs(i)),{},{floodBegin:function(e){e.preventDefault(),a.DisplayMode=r,a._lineColor=new Cesium.Color(1,0,0,1),a.MinVisibleValue=i.minHeight,a.MaxVisibleValue=0,a.ColorTableMinKey=1,a.ColorTableMaxKey=9e3,a.ColorTable=l,a.Opacity=i.floodTrans,a.LineInterval=200,window.handlerPolygon||ue("Polygon"),t&&t.floodPositions?u(t.floodPositions):(de("Polygon",i.lineVisible).then((function(e){var t=window.handlerPolygon;u(e.positions),t.polygon.show=!1,t.deactivate()}),(function(e){console.log(e)})),window.handlerPolygon.activate(),viewer.scene.pickPositionSupported||g.Message.errorMsg(re.NoPickPositionSupported))},floodClear:function(e){e.preventDefault(),c=[],window.handlerPolygon&&(viewer.scene.globe.HypsometricSetting=void 0,clearInterval(o),me("Polygon"))},changeColor:function(e){i.colorBandShow=!1,i.cheackedBand=e},floodPosition:c})},clipBoxEditor:function(t){var i=e.reactive({clipModel:"ClipInside"});if(t)for(var n in t)i.hasOwnProperty(n)?i[n]=t[n]:g.Message.errorMsg(re.AttributeError+n);var o,r,a,l,c="clip_behind_all_plane";function u(){if(void 0!==a){var e=a.box.dimensions.getValue(),t=a.position.getValue(0),i=0;if(void 0!==a.orientation){var n=Cesium.Matrix3.fromQuaternion(a.orientation._value,new Cesium.Matrix3),o=Cesium.Matrix4.fromRotationTranslation(n,Cesium.Cartesian3.ZERO,new Cesium.Matrix4),r=Cesium.Matrix4.inverse(Cesium.Transforms.eastNorthUpToFixedFrame(t),new Cesium.Matrix4),s=Cesium.Matrix4.multiply(r,o,new Cesium.Matrix4),l=Cesium.Matrix4.getMatrix3(s,new Cesium.Matrix3);i=Cesium.HeadingPitchRoll.fromQuaternion(Cesium.Quaternion.fromRotationMatrix(l)).heading}d({dimensions:e,position:t,clipMode:c,heading:i})}}function d(e){for(var t=0,i=o.length;t<i;t++)o[t].setCustomClipBox(e)}function m(){if(r&&(r.deactivate(),tooltip.setVisible(!1)),a){var e,t=h(o);try{for(t.s();!(e=t.n()).done;){e.value.clearCustomClipBox()}}catch(e){t.e(e)}finally{t.f()}a=void 0,l.deactivate(),viewer.entities.removeAll(),r.clear()}}return A.isViewer&&(o=viewer.scene.layers.layerQueue,r=new Cesium.DrawHandler(viewer,Cesium.DrawMode.Box),window.tooltip||(window.tooltip=ee(viewer._element))),e.watch((function(){return A.isViewer}),(function(e){e&&(o=viewer.scene.layers.layerQueue,r=new Cesium.DrawHandler(viewer,Cesium.DrawMode.Box),window.tooltip||(window.tooltip=ee(viewer._element)))})),e.watch((function(){return i.clipModel}),(function(e){switch(e){case"ClipInside":c="clip_behind_all_plane";break;case"ClipOutside":c="clip_behind_any_plane"}a&&u()})),e.onBeforeUnmount((function(){l&&l.destroy(),l=void 0,o=void 0,r=void 0,a=void 0})),s(s({},e.toRefs(i)),{},{BoxClipByEitor:function(){m(),l||(function(){for(var e=0,t=o.length;e<t;e++)o[e].selectEnabled=!1,o[e].clipLineColor=new Cesium.Color(1,1,1,0)}(),r.movingEvt.addEventListener((function(e){r.isDrawing?tooltip.showAt(" <p>点击鼠标左键结束绘制box底面</p><p>移动鼠标绘制box高度</p><p>点击鼠标右键结束绘制</p>","230px"):tooltip.showAt(" <p>点击鼠标左键开始绘制box底面</p>","230px")})),r.drawEvt.addEventListener((function(e){var t={dimensions:(a=e.object).box.dimensions.getValue(),position:a.position.getValue(0),clipMode:c,heading:0};(l=new Cesium.BoxEditor(viewer,a)).editEvt.addEventListener((function(e){a.box.dimensions=e.dimensions,a.position=e.position,a.orientation=e.orientation,u()})),l.activate(),d(t),tooltip.setVisible(!1),r.clear(),r.deactivate()}))),r.activate()},clearBoxClipByEitor:m})},clipPolygon:function(t){var i=e.reactive({clipModelPolygon:"ClipInside",isEdit:!1,isEditZ:!1,lineVisible:!0});if(t)for(var n in t)i.hasOwnProperty(n)?i[n]=t[n]:g.Message&&g.Message.errorMsg(re.AttributeError+n);var o,r=Cesium.ModifyRegionMode.CLIP_INSIDE,a=!0,l=[];function c(e){l=e;var t,i=h(o);try{for(i.s();!(t=i.n()).done;){t.value.setModifyRegions([e],r)}}catch(e){i.e(e)}finally{i.f()}}return t&&t.polygonPositions&&c(t.slopePositions),A.isViewer&&(o=viewer.scene.layers.layerQueue,window.tooltip||(window.tooltip=ee(viewer._element))),e.watch((function(){return A.isViewer}),(function(e){e&&(o=viewer.scene.layers.layerQueue,window.tooltip||(window.tooltip=ee(viewer._element)))})),e.watch((function(){return i.clipModelPolygon}),(function(e){switch(e){case"ClipInside":r=Cesium.ModifyRegionMode.CLIP_INSIDE;break;case"ClipOutside":r=Cesium.ModifyRegionMode.CLIP_OUTSIDE}l.length>0&&c(l)})),e.watch((function(){return i.isEdit}),(function(e){e&&window.handlerPolygon?fe(l,i.isEditZ,c):(pe(),window.handlerPolygon&&window.handlerPolygon.polygon&&(window.handlerPolygon.polygon.show=!1))})),e.watch((function(){return i.isEditZ}),(function(e){window.editHandler&&(window.editHandler.isEditZ=e)})),e.onBeforeUnmount((function(){o=void 0})),s(s({},e.toRefs(i)),{},{clipPolygon:function(e){e.preventDefault(),tooltip.setVisible(!1),a&&(tooltip.showAt(" <p>点击鼠标左键开始绘制多边形</p><p>点击鼠标右键结束绘制</p>","230px"),a=!1),o||(o=viewer.scene.layers.layerQueue);var t,n=h(o);try{for(n.s();!(t=n.n()).done;){var r=t.value;r.selectEnabled=!1,r.clipLineColor=new Cesium.Color(1,1,1,0)}}catch(e){n.e(e)}finally{n.f()}window.handlerPolygon||ae("Polygon"),se("Polygon",i.lineVisible).then((function(e){c(e.positions);var t=window.handlerPolygon;t.polygon.show=!1,t.polyline.show=!1,t.deactivate(),i.isEdit&&fe(l,i.isEditZ,c)}),(function(e){console.log(e)})),window.handlerPolygon.activate(),scene.pickPositionSupported||g.Message&&g.Message.errorMsg(re.NoPickPositionSupported)},clearClipPolygon:function(e){if(e.preventDefault(),l=[],tooltip.setVisible(!1),window.handlerPolygon){le("Polygon");var t,i=h(o);try{for(i.s();!(t=i.n()).done;){t.value.clearModifyRegions()}}catch(e){i.e(e)}finally{i.f()}}},polygonPosition:l})},clipPlane:function(t){var i,n=e.reactive({isEdit:!0,isEditZ:!1,lineVisible:!0,PlanePositions:[]});if(t)for(var o in t)n.hasOwnProperty(o)?n[o]=t[o]:g.Message.errorMsg(re.AttributeError+o);var r=[];function a(e){r=e;var t,n=h(i);try{for(n.s();!(t=n.n()).done;){t.value.setCustomClipPlane(e[0],e[1],e[2])}}catch(e){n.e(e)}finally{n.f()}}return t&&t.PlanePositions&&clipPolygonUpdate(t.PlanePositions),A.isViewer&&(i=viewer.scene.layers.layerQueue,window.tooltip||(window.tooltip=ee(viewer._element))),e.watch((function(){return A.isViewer}),(function(e){e&&(i=viewer.scene.layers.layerQueue,window.tooltip||(window.tooltip=ee(viewer._element)))})),e.watch((function(){return n.isEdit}),(function(e){e||window.handlerPolygon?fe(r,n.isEditZ,a):(pe(),window.handlerPolygon&&window.handlerPolygon.polygon&&(window.handlerPolygon.polygon.show=!1))})),e.watch((function(){return n.isEditZ}),(function(e){window.editHandler&&(window.editHandler.isEditZ=e)})),e.onBeforeUnmount((function(){i=void 0})),s(s({},e.toRefs(n)),{},{clipPlaneStart:function(e){console.log(1),e.preventDefault(),tooltip.setVisible(!1),tooltip.showAt(" <p>点击鼠标左键开始绘制</p><p>绘制三点确定一个平面</p><p>点击鼠标右键结束绘制</p>","230px"),i||(i=viewer.scene.layers.layerQueue);var t,o=h(i);try{for(o.s();!(t=o.n()).done;){var s=t.value;s.selectEnabled=!1,s.clipLineColor=new Cesium.Color(1,1,1,0)}}catch(e){o.e(e)}finally{o.f()}window.handlerPolygon||ae("Polygon"),se("Polygon",n.lineVisible).then((function(e){a(e.result.object.positions),window.handlerPolygon.deactivate(),tooltip.setVisible(!1),fe(r,n.isEditZ,a)}),(function(e){console.log(e)})),window.handlerPolygon.activate(),scene.pickPositionSupported||alert("不支持深度纹理,无法绘制多边形，裁剪功能无法使用！")},clearClipPlane:function(e){if(e.preventDefault(),tooltip.setVisible(!1),r=[],window.handlerPolygon){le("Polygon");var t,n=h(i);try{for(n.s();!(t=n.n()).done;){t.value.clearCustomClipBox()}}catch(e){n.e(e)}finally{n.f()}}},planePosition:r})},clipCross:function(t){var i,n,o,r,a,l,c,u=e.reactive({clipWidth:5,clipHeight:5,heading:0,pitch:0,roll:0,extrude:1});if(t)for(var d in t)u.hasOwnProperty(d)?u[d]=t[d]:g.Message.errorMsg(re.AttributeError+d);function m(){var e,t=h(i);try{for(t.s();!(e=t.n()).done;){e.value.setCustomClipCross({position:c,dimensions:l,heading:u.heading,pitch:u.pitch,roll:u.roll,extrudeDistance:Number(u.extrude)})}}catch(e){t.e(e)}finally{t.f()}}function f(){r&&viewer.entities.removeById("cross-clip-identify-box");var e,t=h(i);try{for(t.s();!(e=t.n()).done;){e.value.clearCustomClipBox()}}catch(e){t.e(e)}finally{t.f()}o=!1,r=void 0,n.removeInputAction(Cesium.ScreenSpaceEventType.MOUSE_MOVE),n.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_CLICK)}return A.isViewer&&(n=new Cesium.ScreenSpaceEventHandler(viewer.scene.canvas),i=viewer.scene.layers.layerQueue),e.watch((function(){return A.isViewer}),(function(e){e&&(n=new Cesium.ScreenSpaceEventHandler(viewer.scene.canvas),i=viewer.scene.layers.layerQueue)})),e.watch((function(){return u.clipWidth}),(function(e){var t=Number(e);t<=0||!r||(r.box.dimensions=new Cesium.Cartesian3(u.clipWidth,u.clipHeight,.1),l=new Cesium.Cartesian3(t,u.clipHeight,u.extrude),m())})),e.watch((function(){return u.clipHeight}),(function(e){var t=Number(e);t<=0||!r||(r.box.dimensions=new Cesium.Cartesian3(u.clipWidth,u.clipHeight,.1),l=new Cesium.Cartesian3(u.clipWidth,t,u.extrude),m())})),e.watch((function(){return u.pitch}),(function(e){if(""!==e&&r){var t=Number(e),i=new Cesium.HeadingPitchRoll(Cesium.Math.toRadians(u.heading),Cesium.Math.toRadians(t),Cesium.Math.toRadians(u.roll)),n=Cesium.Transforms.headingPitchRollQuaternion(a,i);r.orientation=n,m()}})),e.watch((function(){return u.roll}),(function(e){if(""!==e&&r){var t=Number(e),i=new Cesium.HeadingPitchRoll(Cesium.Math.toRadians(u.heading),Cesium.Math.toRadians(u.pitch),Cesium.Math.toRadians(t)),n=Cesium.Transforms.headingPitchRollQuaternion(a,i);r.orientation=n,m()}})),e.watch((function(){return u.heading}),(function(e){if(""!==e&&r){var t=Number(e),i=new Cesium.HeadingPitchRoll(Cesium.Math.toRadians(t),Cesium.Math.toRadians(u.pitch),Cesium.Math.toRadians(u.roll)),n=Cesium.Transforms.headingPitchRollQuaternion(a,i);r.orientation=n,m()}})),e.watch((function(){return u.extrude}),(function(e){Number(e)<=0||!r||m()})),e.onBeforeUnmount((function(){n.destroy(),i=void 0,r=void 0,n=void 0,l=void 0})),s(s({},e.toRefs(u)),{},{startCross:function(e){e.preventDefault(),viewer&&(r&&f(),function(){var e,t,s=h(i);try{for(s.s();!(e=s.n()).done;){e.value.selectEnabled=!1}}catch(e){s.e(e)}finally{s.f()}a=Cesium.Cartesian3.fromDegrees(0,0,0),l=new Cesium.Cartesian3(u.clipWidth,u.clipHeight,.1),r=viewer.entities.add({id:"cross-clip-identify-box",position:a,show:!1,box:{dimensions:l,fill:!1,outline:!0,outlineColor:Cesium.Color.AQUA,outlineWidth:5}}),n.setInputAction((function(e){if(o){if(!(a=scene.pickPosition(e.endPosition)))return;r.position=a,t||(t=new Cesium.HeadingPitchRoll(Cesium.Math.toRadians(u.heading),Cesium.Math.toRadians(u.pitch),Cesium.Math.toRadians(u.roll)));var i=Cesium.Transforms.headingPitchRollQuaternion(a,t);r.orientation=i}}),Cesium.ScreenSpaceEventType.MOUSE_MOVE),n.setInputAction((function(e){if(o){if(!(c=scene.pickPosition(e.position)))return;m(),o=!1,r.show=!1}n.removeInputAction(Cesium.ScreenSpaceEventType.MOUSE_MOVE),n.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_CLICK),t=null}),Cesium.ScreenSpaceEventType.LEFT_CLICK)}(),o=!0,r.show=!0)},clearCross:f})},clipBox:clipBox,measure:function(t){var i,n,o,r,a,l,c,u=e.reactive({measureMode:"Space",clampMode:Cesium.ClampMode.Space,Ellipsoid:null,contourColor:"#ff7d00",isShowDVH:!1,isShowLine:!0,pickPointEnabled:!0});(a=new Cesium.HypsometricSetting).DisplayMode=Cesium.HypsometricSettingEnum.DisplayMode.LINE;var d=new Cesium.ColorTable;a._lineColor=Cesium.Color.fromCssColorString(u.contourColor),a.ColorTable=d,a.Opacity=.6,a.MaxVisibleValue=-100,a.MinVisibleValue=-100;var m=function(){setInterval((function(){console.log("now-state.pickPointEnabled:",u.pickPointEnabled)}),2e3),i=viewer.scene.layers.layerQueue,viewer.scene.globe.HypsometricSetting={hypsometricSetting:a,analysisMode:Cesium.HypsometricSettingEnum.AnalysisRegionMode.ARM_ALL},A.changeLayers&&f(),n=new Cesium.MeasureHandler(viewer,Cesium.MeasureMode.Distance,u.clampMode),o=new Cesium.MeasureHandler(viewer,Cesium.MeasureMode.Area,u.clampMode),r=new Cesium.MeasureHandler(viewer,Cesium.MeasureMode.DVH),n.activeEvt.addEventListener((function(e){1==e?(viewer.enableCursorStyle=!1,viewer._element.style.cursor="",document.body.classList.add("measureCur"),viewer.scene.pickPointEnabled=u.pickPointEnabled):(viewer.enableCursorStyle=!0,document.body.classList.remove("measureCur"),viewer.scene.pickPointEnabled=!1)})),n.measureEvt.addEventListener((function(e){var t=Number(e.distance),i=u.measureMode;"CGCS2000"!=i&&"XIAN80"!=i&&"WGS84"!=i||(t=Number(function(e){for(var t=[],i=0;i<e.length;i++){var n=Cesium.Cartographic.fromCartesian(e[i]),o=Cesium.Math.toDegrees(n.longitude),r=Cesium.Math.toDegrees(n.latitude);t.push(o,r)}var a=new Cesium.PolylineGeometry({positions:Cesium.Cartesian3.fromDegreesArray(t)});return scene.globe.computeSurfaceDistance(a,u.Ellipsoid)}(e.positions)));var o=t>1e3?(t/1e3).toFixed(2)+"km":t.toFixed(2)+"m";n.disLabel.text="距离:"+o})),o.activeEvt.addEventListener((function(e){1==e?(viewer.enableCursorStyle=!1,viewer._element.style.cursor="",document.body.classList.add("measureCur"),viewer.scene.pickPointEnabled=u.pickPointEnabled):(viewer.enableCursorStyle=!0,document.body.classList.remove("measureCur"),viewer.scene.pickPointEnabled=!1)})),o.measureEvt.addEventListener((function(e){var t=Number(e.area),i=u.measureMode;"CGCS2000"==i||"XIAN80"==i||"WGS84"==i?t=Number(function(e){for(var t=[],i=0;i<e.length;i++){var n=Cesium.Cartographic.fromCartesian(e[i]),o=Cesium.Math.toDegrees(n.longitude),r=Cesium.Math.toDegrees(n.latitude);t.push(o,r)}var a=new Cesium.PolygonGeometry.fromPositions({positions:Cesium.Cartesian3.fromDegreesArray(t)});return scene.globe.computeSurfaceArea(a,u.Ellipsoid)}(e.positions)):"6"==i&&(t=Number(function(e){for(var t=0,i=0;i<e.length;i++){var n=Cesium.Cartographic.fromCartesian(e[i]);t+=Cesium.Math.toDegrees(n.longitude)}for(var o=Math.round((t/e.length+6)/6),r=6*o-3,a=new Cesium.CustomProjection({name:"tmerc",centralMeridian:r,primeMeridian:0,standardParallel_1:0,standardParallel_2:0,eastFalse:5e5,northFalse:0,semimajorAxis:6378137,inverseFlattening:298.257222101}),s=[],l=0;l<e.length;l++){var c=Cesium.Cartographic.fromCartesian(e[l]),u=a.project(c);s.push(u)}return s.push(s[0]),Cesium.getPreciseArea(s,"China2000",r,o,1)}(e.positions)));var n=t>1e6?(t/1e6).toFixed(2)+"km²":t.toFixed(2)+"㎡";o.areaLabel.text="面积:"+n})),r.measureEvt.addEventListener((function(e){var t=e.distance>1e3?(e.distance/1e3).toFixed(2)+"km":e.distance+"m",i=e.verticalHeight>1e3?(e.verticalHeight/1e3).toFixed(2)+"km":e.verticalHeight+"m",n=e.horizontalDistance>1e3?(e.horizontalDistance/1e3).toFixed(2)+"km":e.horizontalDistance+"m";r.disLabel.text="空间距离:"+t,r.vLabel.text="垂直高度:"+i,r.hLabel.text="水平距离:"+n,l=Number(e.endHeight),u.isShowLine&&p(l)})),r.activeEvt.addEventListener((function(e){1==e?(viewer.enableCursorStyle=!1,viewer._element.style.cursor="",document.body.classList.add("measureCur"),viewer.scene.pickPointEnabled=u.pickPointEnabled):(viewer.enableCursorStyle=!0,document.body.classList.remove("measureCur"),viewer.scene.pickPointEnabled=!1)}))};function f(){for(var e=0;e<i.length;e++)i[e].hypsometricSetting={hypsometricSetting:a,analysisMode:Cesium.HypsometricSettingEnum.AnalysisRegionMode.ARM_ALL};c=!0}function p(e){if(viewer.scene.globe.HypsometricSetting.hypsometricSetting.MaxVisibleValue=e,viewer.scene.globe.HypsometricSetting.hypsometricSetting.MinVisibleValue=e,c)for(var t=0;t<i.length;t++)i[t].hypsometricSetting.hypsometricSetting?(i[t].hypsometricSetting.hypsometricSetting.MaxVisibleValue=e,i[t].hypsometricSetting.hypsometricSetting.MinVisibleValue=e):f()}function w(e){var t=scene.pickPosition(e.message.position);g.CartesiantoDegrees(t)[2]}function h(){p(-1e4),viewer.eventManager.removeEventListener("CLICK",w)}function v(){n&&n.deactivate(),o&&o.deactivate(),r&&r.deactivate(),u.isShowDVH=!1,u.Ellipsoid=null,l=-1e4}return A.isViewer&&m(),e.watch((function(){return A.isViewer}),(function(e){e&&m()})),e.watch((function(){return A.changeLayers}),(function(e){f()})),e.watch((function(){return u.isShowLine}),(function(e){p(e?l:-1e4)})),e.watch((function(){return u.pickPointEnabled}),(function(e){viewer.scene.pickPointEnabled=e})),e.watch((function(){return u.measureMode}),(function(e){"Space"==e?(u.clampMode=Cesium.ClampMode.Space,o.clampMode=Cesium.ClampMode.Space,n.clampMode=Cesium.ClampMode.Space):(u.clampMode=Cesium.ClampMode.Ground,o.clampMode=Cesium.ClampMode.Ground,n.clampMode=Cesium.ClampMode.Ground,u.Ellipsoid="XIAN80"==e?Cesium.Ellipsoid.XIAN80:"CGCS2000"==e?Cesium.Ellipsoid.CGCS2000:"WGS84"==e?Cesium.Ellipsoid.WGS84:null)})),e.onBeforeUnmount((function(){a.destroy(),i=void 0})),s(s({},e.toRefs(u)),{},{distanceClk:function(){v(),n&&n.activate()},areaClk:function(){v(),o&&o.activate()},heightClk:function(){c||f(),h(),viewer.eventManager.addEventListener("CLICK",w,!0),v(),u.isShowDVH=!0,r&&r.activate()},clear:function(){v(),n&&n.clear(),o&&o.clear(),r&&r.clear(),h(),viewer.scene.pickPointEnabled=!1}})},skyLine:function(t){var i=e.reactive({skylineRadius:1e4,lineWidth:3,skylineColor:"rgb(200, 0, 0)",skyBodyColor:"rgba(44,149,197,0.6)",barrierColor:"rgba(255, 186, 1, 1)",skylineMode:0,highlightBarrier:!1,getSkyline2d:!0,skylineSpatialAnalysisUrl:null,observerInformation:null,ignoreGlobe:!0});if(t)for(var n in t)i.hasOwnProperty(n)?i[n]=t[n]:g.Message.errorMsg(re.AttributeError+n);var o,r,a,l,c=!0,u=e.ref(null);function d(){window.echarts?(o||(o=window.echarts.init(u.value),window.onresize=function(){o.resize()}),o.setOption({title:{text:"二维天际线",textStyle:{fontSize:14}},grid:{left:30,right:0,top:30,bottom:8},tooltip:{},xAxis:{show:!1},yAxis:{show:!1},series:[{type:"bar",data:[]}]})):g.Message.warnMsg(re.EchartsErr)}function m(e){a.viewPosition=[e.longitude,e.latitude,e.height],a.pitch=e.pitch,a.direction=e.direction,a.radius=Number(i.skylineRadius),a.lineWidth=Number(i.lineWidth),a.color=Cesium.Color.fromCssColorString(i.skylineColor),a.displayStyle=Number(i.skylineMode>1?0:i.skylineMode),setTimeout((function(){i.highlightBarrier&&f(Cesium.Color.fromCssColorString(i.barrierColor));2==i.skylineMode&&(i.skylineSpatialAnalysisUrl?p():w(e)),function(e){if(i.observerInformation&&o){var t={tooltip:{trigger:"axis",formatter:function(e){var t=Number(e[0].axisValue),i=e[0].data;return["X: "+t.toFixed(6)+"<br/>","Y: "+i.toFixed(6)].join("")}},grid:{left:40,right:0,top:35,bottom:8,borderColor:"#333333"},color:"red",xAxis:[{type:"category",boundaryGap:!1,data:e.x,show:!1}],yAxis:{min:function(e){return(e.min-.05).toFixed(2)},show:!0,axisLine:{show:!0}},dataZoom:[{type:"inside",xAxisIndex:0,filterMode:"filter",start:0,end:100}],series:[{symbolSize:8,symbol:"circle",smooth:!0,type:"line",data:e.y,lineStyle:{width:2,shadowColor:"rgba(145, 146, 148,0.7)",shadowBlur:10,shadowOffsetY:8}}]};o.setOption(t)}}(a.getSkyline2D())}),300),i.observerInformation=e}function f(e){var t=a.getObjectIds();console.log(t);var i=viewer.scene.layers._layerQueue,n=function(n){i.forEach((function(i){i._id===Number(n)&&i.setObjsColor(t[n],e)}))};for(var o in t)n(o)}function p(){var e=a.getSkylineSectorParameter(),t={viewerPoint:e.viewPos,line3D:e.geoLine3D,height:0,lonlat:!0},n=i.skylineSpatialAnalysisUrl,o=JSON.stringify(t);axios.post(n,o).then((function(e){axios.get(e.data.newResourceLocation+".json").then((function(e){var t=e.data;if(null!==t.geometry){var n=new Uint8Array(t.geometry.model).buffer;r.add("SkyLineBody",{id:1,position:Cesium.Cartesian3.fromDegrees(t.geometry.position.x,t.geometry.position.y,t.geometry.position.z),hpr:new Cesium.HeadingPitchRoll(0,0,0),color:Cesium.Color.fromCssColorString(i.skyBodyColor)},n,!1),t.geometry.model=[4,0,0,0].concat(t.geometry.model),t.geometry.name=re.SkyLineBody,H.geometrys.SkyLineBody=t.geometry,F()}})).catch((function(e){console.log(e),g.Message.errorMsg("获取天际线体数据失败",e)}))})).catch((function(e){console.log(e),g.Message.errorMsg("获取天际线体数据失败",e)}))}function w(e){var t=a.getSkyline3D(),n=new Array,o=Cesium.Cartesian3.fromDegrees(e.longitude,e.latitude,e.height);n.push(o);for(var r=0;r<t.x.length;r++){var s=Cesium.Cartesian3.fromDegrees(t.x[r],t.y[r],t.z[r]);n.push(s)}viewer.entities.add({id:"SkyLineBody",polygon:{extrudedHeight:10,hierarchy:n,perPositionHeight:!0,material:Cesium.Color.fromCssColorString(i.skyBodyColor)}})}function h(){if(le(),tooltip.setVisible(!1),i.observerInformation){viewer.entities.removeById("SkyLineBody"),a&&a.clear();for(var e=0;e<l.layers._layerQueue.length;e++){l.layers.findByIndex(e).removeAllObjsColor()}i.observerInformation=null,o.clear(),d(),r.removeCollection("SkyLineBody"),H.geometrys.SkyLineBody&&(delete H.geometrys.SkyLineBody,F())}}return e.onMounted((function(){d()})),A.isViewer&&(l=viewer.scene,(a=new Cesium.Skyline(l)).ignoreGlobe=i.ignoreGlobe,a.build(),r=new Cesium.S3MInstanceCollection(l._context),l.primitives.add(r),i.observerInformation&&m(i.observerInformation),window.tooltip||(window.tooltip=createTooltip(viewer._element))),e.watch((function(){return A.isViewer}),(function(e){e&&(l=viewer.scene,(a=new Cesium.Skyline(viewer.scene)).ignoreGlobe=i.ignoreGlobe,a.build(),r=new Cesium.S3MInstanceCollection(viewer.scene._context),viewer.scene.primitives.add(r),i.observerInformation&&m(i.observerInformation),window.tooltip||(window.tooltip=createTooltip(viewer._element)))})),e.watch((function(){return i.skylineRadius}),(function(e){i.observerInformation&&(a.radius=parseFloat(e),a.pitch=parseFloat(i.observerInformation.pitch))})),e.watch((function(){return i.lineWidth}),(function(e){a.lineWidth=Number(e),i.observerInformation&&(a.pitch=parseFloat(i.observerInformation.pitch))})),e.watch((function(){return i.skylineColor}),(function(e){if(i.observerInformation&&""!=e){var t=Cesium.Color.fromCssColorString(e);a.color=t,a.pitch=parseFloat(i.observerInformation.pitch)}})),e.watch((function(){return i.barrierColor}),(function(e){!i.observerInformation&&i.highlightBarrier||f(Cesium.Color.fromCssColorString(e))})),e.watch((function(){return i.ignoreGlobe}),(function(e){a&&(a.ignoreGlobe=e)})),e.watch((function(){return i.highlightBarrier}),(function(e){if(e&&i.observerInformation)f(Cesium.Color.fromCssColorString(i.barrierColor));else for(var t=0;t<l.layers._layerQueue.length;t++){l.layers.findByIndex(t).removeAllObjsColor()}})),e.watch((function(){return i.skyBodyColor}),(function(e){if(i.observerInformation&&""!=e){var t=Cesium.Color.fromCssColorString(e);i.skylineSpatialAnalysisUrl?r.getInstance("SkyLineBody",1).updateColor(t):viewer.entities.getById("SkyLineBody").polygon.material=t}})),e.watch((function(){return i.getSkyline2d}),(function(e){e&&o?setTimeout((function(){o.resize()}),200):i.getSkyline2d=!1})),e.watch((function(){return i.skylineMode}),(function(e){0==e?(a.displayStyle=0,viewer.entities.removeById("SkyLineBody"),r.removeCollection("SkyLineBody"),H.geometrys.SkyLineBody&&(delete H.geometrys.SkyLineBody,F())):1==e?(a.displayStyle=1,viewer.entities.removeById("SkyLineBody"),r.removeCollection("SkyLineBody"),H.geometrys.SkyLineBody&&(delete H.geometrys.SkyLineBody,F())):2==e&&(a.displayStyle=0,i.observerInformation&&(i.skylineSpatialAnalysisUrl?p(i.observerInformation):w(i.observerInformation)))})),e.onBeforeUnmount((function(){h(),a=void 0,o=void 0,r=void 0})),s(s({},e.toRefs(i)),{},{skyLineAnalysis:function(){h();var e=viewer.scene.camera.positionCartographic;m({longitude:Cesium.Math.toDegrees(e.longitude),latitude:Cesium.Math.toDegrees(e.latitude),height:e.height,pitch:Cesium.Math.toDegrees(l.camera.pitch),direction:Cesium.Math.toDegrees(l.camera.heading)})},setLimitBody:function(){window.handlerPolygon||ae("Polygon"),tooltip.setVisible(!1),c&&(window.tooltip.showAt(" <p>点击鼠标左键绘制区域</p><p>点击鼠标右键结束绘制</p>","450px"),c=!1),se("Polygon").then((function(e){a.removeLimitbody("limitBody");for(var t=window.handlerPolygon,i=e.result.object.positions,n=[],o=0,r=i.length;o<r;o++){var s=Cesium.Cartographic.fromCartesian(i[o]),l=Cesium.Math.toDegrees(s.longitude),c=Cesium.Math.toDegrees(s.latitude);n.push([l,c])}for(var u=[],d=0,m=g.unique(n).length;d<m;d++)u.push(n[d][0]),u.push(n[d][1]);a.addLimitbody({position:u,name:"limitBody"}),t.polygon.show=!1,t.polyline.show=!1,t.deactivate()}),(function(e){console.log(e)})),window.handlerPolygon.activate()},echarts_box:u,clear:h})},shadowquery:function(t){var i=e.reactive({timeValue:[24,64],currentDate:new Date,shadowShow:!0,marks:{0:"0:00",8:"",16:"",24:"6:00",32:"",40:"",48:"12:00",56:"",64:"",72:"18:00",80:"",88:"",96:"24:00"},timeInterval:60,spacing:10,bottomHeight:1,extrudeHeight:30,shadowQueryRegion:[],layerShadowType:Cesium.ShadowType.ALL,terrainShadows:Cesium.ShadowMode.RECEIVE_ONLY,showStartImgForTime:!0,showStartImgForDate:!0,shadowRadio:{shadowRadio:"",longitude:"",latitude:"",height:"",isShow:!1},dockFontShow:!0,legendShow:!1,shadowBodyShow:!1,shadowBodyFilter:[0,100]});if(t)for(var n in t)i.hasOwnProperty(n)?i[n]=t[n]:g.Message.errorMsg(re.AttributeError+n);t&&t.shadowQueryRegion&&x(t.shadowQueryRegion);var o,r,a,l,c,u,d,m=!0,p=f(i.timeValue),w=e.ref(null),h="public/data/s3m/box.s3m",v=[],y=g.gradientColors,C=["#0000ff"];function b(){var e=viewer.scene;viewer.shadows=i.shadowShow,viewer.terrainShadows=i.terrainShadows,r=viewer.scene.layers.layerQueue,e.globe.enableLighting=!0,e.skyBox.show=!0,viewer.clock.multiplier=1,viewer.clock.shouldAnimate=!0,o=new Cesium.ShadowQueryPoints(e),(c=new Cesium.S3MInstanceCollection(e._context)).setCullEnabled(h,!0),e.primitives.add(c),o.queryPointsEvent.addEventListener((function(e){v=e,i.shadowBodyShow&&T()})),A.changeLayers&&S()}function S(){for(var e=0;e<r.length;e++)r[e].shadowType=i.layerShadowType,u=!0}function P(e){var t;t=p[0]===e[0]?M(e[1]):M(e[0]),viewer.clock.currentTime=Cesium.JulianDate.fromDate(t),p=e}function M(e){var t=parseInt(e/4),n=parseInt(e%4*15),o=i.currentDate;return o.setHours(t),o.setMinutes(n),o}function E(e){i.shadowShow&&(o.startTime=Cesium.JulianDate.fromDate(M(e[0])),o.endTime=Cesium.JulianDate.fromDate(M(e[1]))),i.showStartImgForTime&&i.shadowQueryRegion.length>0&&o.build()}function x(e){E(i.timeValue);var t=[];o.spacing=Number(i.spacing),o.timeInterval=Number(i.timeInterval);for(var n=Number(i.bottomHeight),r=Number(i.extrudeHeight),a=0,s=Cesium.arrayRemoveDuplicates(e,Cesium.Cartesian3.equalsEpsilon).length;a<s;a++){var l=Cesium.Cartographic.fromCartesian(e[a]),c=Cesium.Math.toDegrees(l.longitude),u=Cesium.Math.toDegrees(l.latitude);t.push(c),t.push(u)}i.shadowQueryRegion=t,o.qureyRegion({position:t,bottom:n,extend:r}),o.build()}function L(e){if(i.shadowBodyShow){var t=scene.pick(e.message.position);if(t&&t.id){var n=v[t.id];if(!n)return;var r=100*n.shadowRatio;(r<i.shadowBodyFilter[0]||r>i.shadowBodyFilter[1])&&(i.shadowRadio.isShow=!1);var a=g.CartesiantoDegrees(n.position);i.shadowRadio={shadowRadio:(100*n.shadowRatio).toFixed(0)+"%",longitude:a[0].toFixed(8),latitude:a[1].toFixed(8),height:a[2].toFixed(8),isShow:!0},w.value.style.top=e.message.position.y-160+"px",w.value.style.left=e.message.position.x+"px"}else i.shadowRadio.isShow=!1}else{var s=scene.pickPosition(e.message.position),l=Cesium.Cartographic.fromCartesian(s),c=o.getShadowRadio(l);if(-1!=c){var u=Cesium.Math.toDegrees(l.longitude),d=Cesium.Math.toDegrees(l.latitude),m=l.height;i.shadowRadio={shadowRadio:(100*c).toFixed(0)+"%",longitude:u.toFixed(8),latitude:d.toFixed(8),height:m.toFixed(8),isShow:!0},w.value.style.top=e.message.position.y-160+"px",w.value.style.left=e.message.position.x+"px"}else i.shadowRadio.isShow=!1}}function R(){i.shadowRadio.isShow=!1}function I(){i.legendShow=!1,le(),i.shadowQueryRegion.length=0,tooltip.setVisible(!1),R(),viewer.eventManager.removeEventListener("CLICK",L),o.clear(),v.length=0,c.removeCollection(h);for(var e=0;e<r.length;e++)r[e].shadowType=Cesium.ShadowType.NONE}function T(){var e=[];if(!(o._bottom<0||0==v.length)){for(var t,n,r,a=Number(i.spacing-.5),s=0,l=v.length;s<l;s++)e.push({position:v[s].position,color:(t=v[s].shadowRatio,n=void 0,r=void 0,n=parseInt(100*t),r=C[n],Cesium.Color.fromCssColorString(r)),scale:new Cesium.Cartesian3(a,a,a)});e.length>0&&c.add(h,e),k(i.shadowBodyFilter)}}function k(e){if(!(o._bottom<=0||0==v.length))for(var t=0,i=v.length;t<i;t++){var n=100*v[t].shadowRatio;n<e[0]||n>e[1]?c.getInstance(h,t).visible=!1:c.getInstance(h,t).visible=!0}}function N(e){d&&clearTimeout(d),d=setTimeout((function(){e()}),500)}return C=C.concat(y("#0000ff","#00ffff",20)).concat(y("#00ffff","#00ff00",20)).concat(y("#00ff00","#ffff00",20)).concat(y("#ffff00","#ff7f00",20)).concat(y("#ff7f00","#ff0000",20)),A.isViewer&&(window.tooltip||(window.tooltip=ee(viewer._element)),b()),e.watch((function(){return A.isViewer}),(function(e){e&&(window.tooltip||(window.tooltip=ee(viewer._element)),b())})),e.watch((function(){return A.changeLayers}),(function(e){S()})),e.watch((function(){return i.timeValue}),(function(e){P(e)})),e.watch((function(){return i.currentDate}),(function(e){P(p)})),e.watch((function(){return i.timeInterval}),(function(e){N((function(){o.timeInterval=Number(e)}))})),e.watch((function(){return i.spacing}),(function(e){N((function(){o.spacing=Number(e)}))})),e.watch((function(){return i.bottomHeight}),(function(e){0!==i.shadowQueryRegion.length&&N((function(){var t=Number(e),n=Number(i.extrudeHeight);o.qureyRegion({position:i.shadowQueryRegion,bottom:t,extend:n}),o.build()}))})),e.watch((function(){return i.extrudeHeight}),(function(e){0!==i.shadowQueryRegion.length&&N((function(){var t=Number(i.bottomHeight),n=Number(e);o.qureyRegion({position:i.shadowQueryRegion,bottom:t,extend:n}),o.build()}))})),e.watch((function(){return i.shadowShow}),(function(e){viewer.shadows=e;for(var t=0,n=r.length;t<n&&r[t].shadowType!=i.layerShadowType;t++)r[t].shadowType=i.layerShadowType})),e.watch((function(){return i.shadowBodyShow}),(function(e){e?(o.isPointsVisible=!1,T()):(o.isPointsVisible=!0,c.removeCollection(h))})),e.onBeforeUnmount((function(){I(),o.destroy(),o=void 0,viewer.shadows=!1,r=void 0})),s(s({},e.toRefs(i)),{},{timeChanged:E,filterChanged:function(e){k(e)},formatTooltip:function(e){return e===i.timeValue[0]?"开始时间:"+t(M(e).toLocaleTimeString()):"结束时间:"+t(M(e).toLocaleTimeString());function t(e){var t=e.split(":");return t[0]+":"+t[1]}},sunLightForTime:function(e){if(l&&(i.showStartImgForDate=!0,clearInterval(l)),!e)return i.showStartImgForTime=!0,void clearInterval(a);i.showStartImgForTime=!1;var t=f(p),n=t[0],o=t[1],r=n;a=setInterval((function(){r<o?(r+=.5,i.timeValue=[n,r]):(i.showStartImgForTime=!0,clearInterval(a))}),50)},sunLightForDate:function(e){if(a&&(clearInterval(a),i.showStartImgForTime=!0),!e)return i.showStartImgForDate=!0,void clearInterval(l);i.showStartImgForDate=!1;var t=M(p[1]),n=t.getMonth();l=setInterval((function(){n<11?n+=1:n=0,t.setMonth(n),i.currentDate=new Date(t)}),1e3)},analysis:function(){i.shadowShow?(tooltip.setVisible(!1),m&&(window.tooltip.showAt(" <p>点击鼠标左键绘制分析区域</p><p>点击鼠标右键结束绘制</p>","350px"),m=!1),u&&r[0].shadowType==i.layerShadowType||S(),window.handlerPolygon||ae("Polygon"),se("Polygon").then((function(e){var t=window.handlerPolygon;x(e.result.object.positions),t.polygon.show=!1,t.polyline.show=!1,t.deactivate(),viewer.eventManager.addEventListener("CLICK",L,!0)}),(function(e){console.log(e)})),window.handlerPolygon.activate(),i.legendShow=!0):i.shadowShow=!0},clear:I,bubble:w,closeBubble:R,dockBubble:function(e){e?(w.value.classList.add("bubbleDock"),i.dockFontShow=!1):(w.value.classList.remove("bubbleDock"),i.dockFontShow=!0)}})},viewshed:function(t){var i,n,o,r,a,l=e.reactive({viewshedSpatialUrl:"http://www.supermapol.com/realspace/services/spatialAnalysis-data_all/restjsr/spatialanalyst/geometry/3d/viewshedbody.json",observerInformation:null,direction:1,pitch:1,addheight:1.8,distance:200,verticalFov:60,horizontalFov:90,hintLineColor:"rgb(212,202,45)",visibleAreaColor:"rgba(9,199,112,0.5)",hiddenAreaColor:"rgba(238,114,22,0.5)",visibleBodyColor:"rgba(9,199,112,0.7)",invisibleBodyColor:"rgba(238,114,22,0.7)",visibleBody:!1,invisibleBody:!1,viewshedAnimation:!1,DynamicLine:[],DynamicSpeed:10});if(t)for(var c in t)l.hasOwnProperty(c)?l[c]=t[c]:g.Message.errorMsg(re.AttributeError+c);var u,d,m=!0,f=["public/data/s3m/car1.s3m"];function p(){r=viewer.scene,i=new Cesium.ViewShed3D(r),n=new Cesium.ScreenSpaceEventHandler(r.canvas),i.hintLineColor=Cesium.Color.fromCssColorString(l.hintLineColor),i.visibleAreaColor=Cesium.Color.fromCssColorString(l.visibleAreaColor),i.hiddenAreaColor=Cesium.Color.fromCssColorString(l.hiddenAreaColor),o=new Cesium.S3MInstanceCollection(r._context),viewer.scene.primitives.add(o),(d=new Cesium.DynamicLayer3D(r.context,f)).updateInterval=100,d.setCullEnabled(f[0],Cesium.CullFace.BACK),d.maxVisibleAltitude=2e3,d.minVisibleAltitude=0,r.primitives.add(d)}A.isViewer&&(window.tooltip||(window.tooltip=ee(viewer._element)),p()),e.watch((function(){return A.isViewer}),(function(e){e&&(window.tooltip||(window.tooltip=ee(viewer._element)),p())}));var w=null;function h(e){switch(e){case"LEFT_CLICK":n.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_CLICK);break;case"MOUSE_MOVE":n.removeInputAction(Cesium.ScreenSpaceEventType.MOUSE_MOVE);break;case"RIGHT_CLICK":n.removeInputAction(Cesium.ScreenSpaceEventType.RIGHT_CLICK);break;case"ALL":default:n.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_CLICK),n.removeInputAction(Cesium.ScreenSpaceEventType.MOUSE_MOVE),n.removeInputAction(Cesium.ScreenSpaceEventType.RIGHT_CLICK)}}function v(){var e=i.getViewshedParameter(),t={viewerPoint:e.viewPosition,point3DsList:e.point3DList,radius:e.distance,lonlat:!0,viewShedType:"VISIBLEBODY"},n=JSON.stringify(t),r=Cesium.Color.fromCssColorString(l.visibleBodyColor);window.axios.post(l.viewshedSpatialUrl,n).then((function(e){window.axios.get(e.data.newResourceLocation+".json").then((function(e){var t=e.data;if(null!=t.geometry){var n=new Uint8Array(t.geometry.model).buffer;o.add("VeiwshedBody",{id:1,position:Cesium.Cartesian3.fromDegrees(t.geometry.position.x,t.geometry.position.y,t.geometry.position.z),hpr:new Cesium.HeadingPitchRoll(0,0,0),color:r},n,!1),t.geometry.model=[4,0,0,0].concat(t.geometry.model),i.visibleAreaColor=Cesium.Color.fromCssColorString("rgba(0,0,0,0)"),i.hiddenAreaColor=Cesium.Color.fromCssColorString("rgba(0,0,0,0)"),t.geometry.name=re.VeiwshedBody,H.geometrys.VeiwshedBody=t.geometry,F()}else g.Message.errorMsg("获取geometry失败")})).catch((function(e){console.log(e)}))})).catch((function(e){console.log(e)}))}function y(){var e=i.getViewshedParameter(),t={viewerPoint:e.viewPosition,point3DsList:e.point3DList,radius:e.distance,lonlat:!0,viewShedType:"HIDDENBODY"},n=JSON.stringify(t),r=Cesium.Color.fromCssColorString(l.invisibleBodyColor);window.axios.post(l.viewshedSpatialUrl,n).then((function(e){window.axios.get(e.data.newResourceLocation+".json").then((function(e){var t=e.data;if(null!=t.geometry){var n=new Uint8Array(t.geometry.model).buffer;o.add("VeiwshedBodyHidden",{id:1,position:Cesium.Cartesian3.fromDegrees(t.geometry.position.x,t.geometry.position.y,t.geometry.position.z),hpr:new Cesium.HeadingPitchRoll(0,0,0),color:r},n,!1),t.geometry.model=[4,0,0,0].concat(t.geometry.model),i.visibleAreaColor=Cesium.Color.fromCssColorString("rgba(0,0,0,0)"),i.hiddenAreaColor=Cesium.Color.fromCssColorString("rgba(0,0,0,0)"),t.geometry.name=re.VeiwshedBodyHidden,H.geometrys.VeiwshedBodyHidden=t.geometry,F()}else g.Message.errorMsg("获取geometry失败")})).catch((function(e){console.log(e)}))})).catch((function(e){console.log(e)}))}function C(){b(),d.clearState(f[0],[1]),clearInterval(u),u=null,l.viewshedAnimation=!1,le("Polyline")}function b(){tooltip.setVisible(!1),viewer.entities.removeById("viewshedPoint"),document.body.classList.remove("measureCur"),i.distance=1e-5,i.viewPosition=[0,0,0],l.visibleBody=!1,l.invisibleBody=!1,l.observerInformation=null}function S(){i.distance=l.distance,i.build();for(var e=l.DynamicLine,t=[],n=1,o=e.length;n<o;n++)for(var r=e[n-1],a=e[n],s=Cesium.Cartesian3.distance(r,a),c=parseInt(s/(.05*l.DynamicSpeed))+1,m=1,p=c;m<=p;m++)t.push(Cesium.Cartesian3.lerp(r,a,m/c,new Cesium.Cartesian3));var w=g.CartesiantoDegreesObjs(t),h=new Cesium.DynamicObjectState({id:1,longitude:w[0].longitude,latitude:w[0].latitude,altitude:w[0].height,scale:new Cesium.Cartesian3(1,1,1)});d.updateObjectWithModel(f[0],[h]);var v=1;u=setInterval((function(){if(v>=w.length)clearInterval(u);else{h.longitude=w[v].longitude,h.latitude=w[v].latitude,h.altitude=w[v].height,d.updateObjectWithModel(f[0],[h]);var e=g.getAngleAndRadian(t[v-1],t[v]);i.direction=e.angle,i.viewPosition=[h.longitude,h.latitude,h.altitude+Number(l.addheight)],v+=1}}),50)}function P(e){if(""!=e)return Cesium.Color.fromCssColorString(e)}return e.watch((function(){return l.visibleBody}),(function(e){e&&l.observerInformation?v():(o.removeCollection("VeiwshedBody"),l.invisibleBody||(i.visibleAreaColor=Cesium.Color.fromCssColorString(l.visibleAreaColor),i.hiddenAreaColor=Cesium.Color.fromCssColorString(l.hiddenAreaColor)),H.geometrys.VeiwshedBody&&(delete H.geometrys.VeiwshedBody,F()))})),e.watch((function(){return l.invisibleBody}),(function(e){e&&l.observerInformation?y():(o.removeCollection("VeiwshedBodyHidden"),l.visibleBody||(i.visibleAreaColor=Cesium.Color.fromCssColorString(l.visibleAreaColor),i.hiddenAreaColor=Cesium.Color.fromCssColorString(l.hiddenAreaColor)),H.geometrys.VeiwshedBodyHidden&&(delete H.geometrys.VeiwshedBodyHidden,F()))})),e.watch((function(){return l.addheight}),(function(e){(""===e||e<0)&&(e=0),l.observerInformation&&(l.observerInformation[2]=w+parseFloat(e),i.viewPosition=l.observerInformation)})),e.watch((function(){return l.pitch}),(function(e){(""===e||e<0)&&(e=0),i.pitch=parseFloat(e)})),e.watch((function(){return l.direction}),(function(e){(""===e||e<0)&&(e=0),i.direction=parseFloat(e)})),e.watch((function(){return l.distance}),(function(e){(""===e||e<0)&&(e=0),i.distance=parseFloat(e)})),e.watch((function(){return l.verticalFov}),(function(e){(""===e||e<0)&&(e=0),i.verticalFov=parseFloat(e)})),e.watch((function(){return l.horizontalFov}),(function(e){(""===e||e<0)&&(e=0),i.horizontalFov=parseFloat(e)})),e.watch((function(){return l.hintLineColor}),(function(e){i.hintLineColor=P(e)})),e.watch((function(){return l.visibleAreaColor}),(function(e){i.visibleAreaColor=P(e)})),e.watch((function(){return l.visibleBodyColor}),(function(e){o.getInstance("VeiwshedBody",1).updateColor(P(e))})),e.watch((function(){return l.hiddenAreaColor}),(function(e){i.hiddenAreaColor=P(e)})),e.watch((function(){return l.invisibleBodyColor}),(function(e){o.getInstance("VeiwshedBodyHidden",1).updateColor(P(e))})),e.watch((function(){return l.viewshedAnimation}),(function(e){e?(b(),tooltip.showAt("<p>点击分析按钮激活事件</p><p>点击鼠标左键确认模型移动路线</p><p>单击右键结束分析</p>","300px")):C()})),e.onBeforeUnmount((function(){C(),o.destroy(),i.destroy(),n.destroy(),DynamicLayer3D.destroy(),i=void 0,n=void 0,o=void 0})),s(s({},e.toRefs(l)),{},{analysis:function(){viewer.enableCursorStyle=!1,viewer._element.style.cursor="",document.body.classList.add("measureCur"),l.viewshedAnimation?(u&&(C(),l.viewshedAnimation=!0,document.body.classList.add("measureCur")),function(){window.handlerPolyline||ae("Polyline");if(t.DynamicLine)return void S();se("Polyline",Cesium.ClampMode.Ground).then((function(e){var t=window.handlerPolyline;t.polyline.show=!1,window.polylineTransparent.show=!0,t.deactivate(),l.DynamicLine=e.result.object.positions,tooltip.setVisible(!1),l.DynamicLine.length<2?g.Message.warnMsg("至少需要两个点！"):S()}),(function(e){console.log(e)})),window.handlerPolyline.activate()}()):(m&&(window.tooltip.showAt(" <p>点击鼠标左键确认观察者位置</p> <p>右键单击结束分析</p>","450px"),m=!1),o.removeCollection("VeiwshedBody"),o.removeCollection("VeiwshedBodyHidden"),i.distance=1e-5,i.visibleAreaColor=Cesium.Color.fromCssColorString(l.visibleAreaColor),i.hiddenAreaColor=Cesium.Color.fromCssColorString(l.hiddenAreaColor),n.setInputAction((function(e){w=null;var t=r.pickPosition(e.position);a=t;var o=g.CartesiantoDegrees(t);w=o[2],o[2]+=Number(l.addheight),i.viewPosition=o,i.build(),l.observerInformation=o,document.body.classList.remove("measureCur"),h("LEFT_CLICK"),n.setInputAction((function(e){var t=e.endPosition,n=r.pickPosition(t);if(Cesium.Cartesian3.distance(a,n)>0){var o=g.CartesiantoDegrees(n);i.setDistDirByPoint(o)}}),Cesium.ScreenSpaceEventType.MOUSE_MOVE),n.setInputAction((function(e){l.direction=i.direction.toFixed(2),l.pitch=i.pitch.toFixed(2),l.distance=i.distance.toFixed(2),l.horizontalFov=i.horizontalFov,l.verticalFov=i.verticalFov,l.visibleBody&&v(),l.invisibleBody&&y(),tooltip.setVisible(!1),h("MOUSE_MOVE"),h("RIGHT_CLICK")}),Cesium.ScreenSpaceEventType.RIGHT_CLICK),function(e){viewer.entities.removeById("viewshedPoint"),viewer.entities.add(new Cesium.Entity({id:"viewshedPoint",point:new Cesium.PointGraphics({color:P(l.hiddenAreaColor),pixelSize:8}),position:e}))}(Cesium.Cartesian3.fromDegrees(o[0],o[1],o[2]))}),Cesium.ScreenSpaceEventType.LEFT_CLICK))},clear:C})},profile:function(t){var i,n,o,r=e.reactive({profile2d:!1,polylineColor:"rgb(250, 213, 6)",polylineWidth:5,initEchartsOption:null,updateEchartsOption:null});if(t)for(var a in t)r.hasOwnProperty(a)?r[a]=t[a]:g.Message.errorMsg(re.AttributeError+a);var l=!0,c=[],u=[],d=null,m=e.ref(null);function f(){window.echarts?(i||(i=window.echarts.init(m.value),window.onresize=function(){i.resize()}),r.initEchartsOption?i.setOption(r.initEchartsOption):i.setOption({title:{text:"剖面分析",textStyle:{fontSize:14}},grid:{left:30,right:0,top:30,bottom:8},tooltip:{},xAxis:{data:[]},yAxis:{data:[]},series:[{type:"bar",data:[]}]})):g.Message.warnMsg(re.EchartsErr)}function p(e,t){r.profile2d=!0,i.clear(),i.showLoading(),c.length=0,u.length=0;for(var a=[],s=1,l=t.length;s<l;s++){var d=t[s-1],m=t[s],f=Cesium.Cartesian3.distance(d,m);w(parseInt(f));for(var p=1,h=n;p<=h;p++)a.push(Cesium.Cartesian3.lerp(d,m,p/n,new Cesium.Cartesian3))}viewer.scene.clampToHeightMostDetailed(a).then((function(e){u=e,c=g.CartesiantoDegreesObjs(u),function(){if(i.hideLoading(),i.clear(),r.updateEchartsOption)return void i.setOption(r.updateEchartsOption);var e={title:{text:"剖面信息",textStyle:{fontSize:14}},grid:{left:50,right:8,top:40,bottom:20},tooltip:{trigger:"axis",backgroundColor:"#ffffff",textStyle:{color:"#000"},formatter:function(e){var t=e[0].dataIndex;return o=u[t],['当前位置: <hr size=1 style="margin: 3px 0">',"经度: "+c[t].longitude.toFixed(6)+"<br/>","纬度: "+c[t].latitude.toFixed(6)+"<br/>","海拔: "+c[t].height.toFixed(2)+"米<br/>"].join("")}},xAxis:{data:c.map((function(e,t){return t})),show:!1},yAxis:{min:function(e){return e.min<20?0:Math.floor(e.min)},axisLabel:{interval:"auto",formatter:function(e,t){return e>999?(e/1e3).toFixed(2)+"km":e+"m"}},splitLine:{show:!0}},toolbox:{left:"right",feature:{dataZoom:{yAxisIndex:"none"},restore:{},saveAsImage:{}}},dataZoom:[{type:"inside",xAxisIndex:0,filterMode:"filter",start:0,end:100}],series:{name:"height",type:"line",data:c.map((function(e){return e.height})),areaStyle:{}}};i.setOption(e)}()}))}function w(e){n=e/1e4>1?parseInt(e/100):e/1e3>5?parseInt(e/10):e/1e3>2?parseInt(e/5):e/1e3>1?parseInt(e/2):e/100>5?parseInt(e/1.5):e/100>2?e:2*e}function h(){r.profile2d=!1,viewer.entities.removeById("location4"),viewer.entities.removeById("polyline-profile"),i.clear(),c.length=0,u.length=0,le("Polyline"),pe(),f(),tooltip.setVisible(!1)}return e.onMounted((function(){f()})),A.isViewer&&(window.tooltip||(window.tooltip=ee(viewer._element))),e.watch((function(){return A.isViewer}),(function(e){e&&(window.tooltip||(window.tooltip=ee(viewer._element)))})),e.watch((function(){return r.profile2d}),(function(e){e&&i?setTimeout((function(){i.resize()}),200):r.getSkyline2d=!1})),e.onBeforeUnmount((function(){h(),i.clear(),c.length=0,u.length=0})),s(s({},e.toRefs(r)),{},{echarts_box:m,myChart:i,Entypositions:o,LatAndLons:c,Cartesians:u,analysis:function(){l&&(tooltip.showAt(" <p>点击鼠标左键开始绘制</p> <p>单击右键结束分析</p><p>选中可进行编辑</p>","250px"),l=!1),window.handlerPolyline||ae("Polyline"),se("Polyline").then((function(e){i.showLoading(),d=e.positions,function(e){viewer.entities.removeById("polyline-profile"),viewer.entities.removeById("location4");var t=Cesium.Color.fromCssColorString(r.polylineColor);viewer.entities.add({id:"polyline-profile",polyline:{positions:Cesium.Cartesian3.fromDegreesArrayHeights(e),width:r.polylineWidth,material:t,clampToGround:!0}}),function(){if(viewer.entities.getById("location4"))return;viewer.entities.add({id:"location4",position:new Cesium.CallbackProperty((function(){return o}),!1),billboard:{image:"src/style/images/location4.png",width:30,height:40,scaleByDistance:new Cesium.NearFarScalar(10,1,2e3,.6),eyeOffset:new Cesium.Cartesian3(0,1,-5)}})}()}(e.positions);var t=window.handlerPolyline;t.polyline.show=!1,window.polylineTransparent.show=!1,t.deactivate(),p("",e.result.positions),fe(d,!1,p),tooltip.setVisible(!1)}),(function(e){console.log(e)})),window.handlerPolyline.activate()},clear:h})},sightLine:function(t){var i,n,o,r=e.reactive({viewPosition:null,visibleColor:"rgb(0, 200, 0)",hiddenColor:"rgb(200, 0, 0)",barrierColor:"rgba(255, 186, 1, 1)",highlightBarrier:!1,lineWidth:3,showBarrierPoints:!0});if(t)for(var a in t)r.hasOwnProperty(a)?null!=t[a]&&(r[a]=t[a]):g.Message.errorMsg(re.AttributeError+a);var l,c,u=!0,d=!1,m=[],f=0,p=[],w=[],v=[];function y(){i=viewer.scene,(n=new Cesium.Sightline(i)).visibleColor=Cesium.Color.fromCssColorString(r.visibleColor),n.hiddenColor=Cesium.Color.fromCssColorString(r.hiddenColor),n.lineWidth=Number(r.lineWidth),o=new we(viewer,"sightPoint_",M,E)}function C(e){d=!0,clearTimeout(l),l=setTimeout((function(){d=!1}),20);var t=i.pickPosition(e.message.position),o=g.CartesiantoDegrees(t);o[2]<0&&(o[2]=0,t=Cesium.Cartesian3.fromDegrees(o[0],o[1],o[2])),r.viewPosition?(n.addTargetPoint({position:o,name:"sightPoint_Target"+f}),p.push(t),requestAnimationFrame((function(){requestAnimationFrame((function(){n.getBarrierPoint("sightPoint_Target"+f,(function(e){var t;if(t=f,viewer.entities.add(new Cesium.Entity({id:"sightPoint_Target"+t,point:new Cesium.PointGraphics({color:new Cesium.CallbackProperty((function(){return Cesium.Color.fromCssColorString(v[t])}),!1),pixelSize:10}),position:new Cesium.CallbackProperty((function(){return p[t]}),!1)})),e&&e.position){e.position.height+=2;var i=Cesium.Cartographic.toCartesian(e.position);w.push(i);var o=n.getObjectIds();m.push(o),v.push(r.hiddenColor)}else w.push({x:6378137,y:0,z:0}),v.push(r.visibleColor);!function(e){var t=viewer.entities.add({name:"Point_Barrier"+e,position:new Cesium.CallbackProperty((function(){return w[e]}),!1),cylinder:{length:3,topRadius:2,bottomRadius:0,material:Cesium.Color.fromCssColorString("#d60000")}});b.push(t)}(f),f+=1}))}))}))):(n.viewPosition=o,r.viewPosition=o,n.build(),viewer.entities.add(new Cesium.Entity({id:"sightPoint_view",point:new Cesium.PointGraphics({color:Cesium.Color.fromCssColorString(r.barrierColor),pixelSize:10}),position:new Cesium.CallbackProperty((function(){return c}),!1)})),c=t)}A.isViewer&&(window.tooltip||(window.tooltip=ee(viewer._element)),y()),e.watch((function(){return A.isViewer}),(function(e){e&&(window.tooltip||(window.tooltip=ee(viewer._element)),y())}));var b=[];function S(e){if(r.viewPosition&&!d){var t=i.pickPosition(e.message.endPosition),o=g.CartesiantoDegrees(t);n.addTargetPoint({position:o,name:"point"})}}function P(){window.tooltip.setVisible(!1),document.body.classList.remove("measureCur"),r.highlightBarrier&&x(),n.removeTargetPoint("point"),n.build(),o.addEventListener(),viewer.eventManager.removeEventListener("CLICK",C),viewer.eventManager.removeEventListener("MOUSE_MOVE",S),viewer.eventManager.removeEventListener("RIGHT_CLICK",P)}function M(e){if(e.id)if(e.id.includes("sightPoint_Target")){var t=g.CartesiantoDegrees(e.position._value);n.addTargetPoint({position:t,name:e.id})}else if(e.id.includes("sightPoint_view")){var i=g.CartesiantoDegrees(e.position._value);n.viewPosition=i}}function E(e){requestAnimationFrame((function(){requestAnimationFrame((function(){if(e.id)if(e.id.includes("sightPoint_view"))for(var t=0,o=w.length;t<o;t++)a("sightPoint_Target"+t,!0);else e.id.includes("sightPoint_Target")&&a(e.id);function a(t,o){n.getBarrierPoint(t,(function(a){var s=t.charAt(t.length-1);if(a&&a.position){a.position.height+=2;var l,c=Cesium.Cartographic.toCartesian(a.position);if(o){var u=n._targetPoints.values[s],d=Cesium.Cartesian3.fromDegrees(u[0],u[1],u[2]);l=Cesium.Cartesian3.distance(d,c)}else l=Cesium.Cartesian3.distance(e.position._value,c);l>=2.5?(w[s]=c,v[s]=r.hiddenColor):(w[s]={x:6378137,y:0,z:0},v[s]=r.visibleColor);var f=n.getObjectIds();if(m.splice(s,1,f),r.highlightBarrier){var p,y=h(i.layers.layerQueue);try{for(y.s();!(p=y.n()).done;){p.value.removeAllObjsColor()}}catch(e){y.e(e)}finally{y.f()}x()}}else w[s]={x:6378137,y:0,z:0},v[s]=r.visibleColor}))}}))}))}function x(e){var t=Cesium.defaultValue(e,Cesium.Color.fromCssColorString(r.barrierColor)),i=viewer.scene.layers.layerQueue,n=m[m.length-1],o=n[String(Object.keys(n))];console.log("barrierIds:",o),i.forEach((function(e){"Building@CBD"===e._name&&e.setObjsColor(o,t)}))}function L(){n.removeAllTargetPoint();var e,t=h(i.layers.layerQueue);try{for(t.s();!(e=t.n()).done;){e.value.removeAllObjsColor()}}catch(e){t.e(e)}finally{t.f()}f=0,m.length=0,p.length=0,w.length=0,v.length=0,o.removeEventListener(),viewer.entities.removeAll(),document.body.classList.remove("measureCur"),window.tooltip.setVisible(!1),r.viewPosition=null,b.length=0,viewer.eventManager.removeEventListener("CLICK",C),viewer.eventManager.removeEventListener("MOUSE_MOVE",S),viewer.eventManager.removeEventListener("RIGHT_CLICK",P)}return e.watch((function(){return r.lineWidth}),(function(e){n&&(n.lineWidth=Number(e))})),e.watch((function(){return r.visibleColor}),(function(e){n&&(n.visibleColor=Cesium.Color.fromCssColorString(e))})),e.watch((function(){return r.hiddenColor}),(function(e){n&&(n.hiddenColor=Cesium.Color.fromCssColorString(e))})),e.watch((function(){return r.barrierColor}),(function(e){0!==m.length&&x(Cesium.Color.fromCssColorString(e))})),e.watch((function(){return r.highlightBarrier}),(function(e){if(e)x();else{var t,n=h(i.layers.layerQueue);try{for(n.s();!(t=n.n()).done;){t.value.removeAllObjsColor()}}catch(e){n.e(e)}finally{n.f()}}})),e.watch((function(){return r.showBarrierPoints}),(function(e){0!==b.length&&b.forEach((function(t){t.show=e}))})),e.onBeforeUnmount((function(){L(),n=void 0})),s(s({},e.toRefs(r)),{},{analysis:function(){viewer.enableCursorStyle=!1,viewer._element.style.cursor="",document.body.classList.add("measureCur"),u&&(window.tooltip.showAt(" <p>点击鼠标左键确认观察者位置</p><p>再点击左键确认目标位置</p> <p>右键单击结束分析</p>","400px"),u=!1),o.removeEventListener(),viewer.eventManager.addEventListener("CLICK",C,!0),viewer.eventManager.addEventListener("MOUSE_MOVE",S),viewer.eventManager.addEventListener("RIGHT_CLICK",P,!0)},clear:L})},openness:function(t){var i=e.reactive({addHeight:1,viewPosition:null,viewDomeRadius:100,domeType:"ALLDOME",isClosed:!1,visibleAreaColor:"rgba(9,199,112,0.5)",hiddenAreaColor:"rgba(238,114,22,0.5)",startAngle:0,endAngle:360});if(t)for(var n in t)i.hasOwnProperty(n)?i[n]=t[n]:g.Message.errorMsg(re.AttributeError+n);var o,r,a,l=!0;function c(){o=viewer.scene,(r=new Cesium.ViewDome(o)).viewPosition=[0,0,0],r.distance=Number(i.viewDomeRadius),r.domeType=Cesium.ViewDomeType[i.domeType],r.visibleAreaColor=Cesium.Color.fromCssColorString(i.visibleAreaColor),r.hiddenAreaColor=Cesium.Color.fromCssColorString(i.hiddenAreaColor),r.startAngle=Number(i.startAngle),r.endAngle=Number(i.endAngle),r.isClosed=i.isClosed,r.build()}function u(e){viewer.enableCursorStyle=!0,document.body.classList.remove("measureCur");var t=o.pickPosition(e.message.position),n=g.CartesiantoDegrees(t);n[2]+=Number(i.addHeight),i.viewPosition={longitude:n[0].toFixed(6),latitude:n[1].toFixed(6),height:n[2].toFixed(2)},r.viewPosition=n,r.build(),window.tooltip.setVisible(!1),viewer.eventManager.removeEventListener("CLICK",u),viewer.eventManager.removeEventListener("MOUSE_MOVE",d),r.startAngle=Number(i.startAngle)}function d(e){a=o.pickPosition(e.message.endPosition)}function m(){viewer.entities.removeById("opennessPoint"),document.body.classList.remove("measureCur"),window.tooltip.setVisible(!1),i.viewPosition=null,r.viewPosition=[0,0,0],r.startAngle=Number(i.startAngle)}return A.isViewer&&(window.tooltip||(window.tooltip=ee(viewer._element)),c()),e.watch((function(){return A.isViewer}),(function(e){e&&(window.tooltip||(window.tooltip=ee(viewer._element)),c())})),e.watch((function(){return i.viewDomeRadius}),(function(e){""!=e&&(r.distance=Number(e))})),e.watch((function(){return i.domeType}),(function(e){""!=e&&(r.domeType=Cesium.ViewDomeType[e])})),e.watch((function(){return i.isClosed}),(function(e){""!=e&&(r.isClosed=e)})),e.watch((function(){return i.startAngle}),(function(e){""!=e&&(r.startAngle=Number(e))})),e.watch((function(){return i.endAngle}),(function(e){""!=e&&(r.endAngle=Number(e))})),e.watch((function(){return i.visibleAreaColor}),(function(e){if(""!=e){var t=Cesium.Color.fromCssColorString(e);r.visibleAreaColor=t}})),e.watch((function(){return i.hiddenAreaColor}),(function(e){if(""!=e){var t=Cesium.Color.fromCssColorString(e);r.hiddenAreaColor=t}})),e.watch((function(){return i.addHeight}),(function(e,t){var n=e-t;n=Cesium.defaultValue(n,0),r.viewPosition[2]+=Number(n),a=Cesium.Cartesian3.fromDegrees(r.viewPosition[0],r.viewPosition[1],r.viewPosition[2]),r.startAngle=Number(i.startAngle)})),e.onBeforeUnmount((function(){m(),r.destroy(),r=void 0})),s(s({},e.toRefs(i)),{},{analysis:function(){viewer.enableCursorStyle=!1,viewer._element.style.cursor="",document.body.classList.add("measureCur"),l&&(window.tooltip.showAt(" <p>点击鼠标左键确认分析位置</p>","250px"),l=!1),viewer.entities.removeById("opennessPoint"),viewer.entities.add(new Cesium.Entity({id:"opennessPoint",point:new Cesium.PointGraphics({color:Cesium.Color.fromCssColorString("rgba(238,114,22,1)"),pixelSize:8}),position:new Cesium.CallbackProperty((function(){return a}),!1)})),viewer.eventManager.addEventListener("CLICK",u,!0),viewer.eventManager.addEventListener("MOUSE_MOVE",d,!0)},clear:m})},spatialQuery3d:function(t){var i=e.reactive({layerNames:[],selectedLayerName:null,scale:3,positionMode:"intersects",Xpitch:0,Yroll:0,Zheading:0,geometryType:"box",drawType:"Fill_And_WireFrame",FillColor:"rgba(192,211,25,0.5)",WireFrameColor:"rgba(89,129,228,0.8)",searchColor:"rgba(255, 186, 1, 1)",GeometryBodyNames:[],boxParameters:[100,100,100],sphereParameters:[100],coneParameters:[100,200],cylinderParameters:[100,100,200],ellicpseParameters:[100,50,50],rotateOrigin:null});if(t)for(var n in t)i.hasOwnProperty(n)?i[n]=t[n]:g.Message.errorMsg(re.AttributeError+n);var o,r,a,l,c,u=!0,d=[];function m(){if(i.GeometryBodyNames=[],d=[],H.geometrys)for(var e in H.geometrys){d.push(e);var n=H.geometrys[e].name;i.GeometryBodyNames.includes(n)||i.GeometryBodyNames.push(n)}0===i.GeometryBodyNames.length&&(t&&t.geometryType?i.geometryType=t.geometryType:i.geometryType="box")}function f(){o=viewer.scene,r=viewer.scene.layers.layerQueue,(a=new Cesium.SpatialQuery3D(o)).outlineColor=Cesium.Color.fromCssColorString(i.WireFrameColor),a.fillColor=Cesium.Color.fromCssColorString(i.FillColor),a.fillStyle=Cesium.FillStyle[i.drawType],v(i.geometryType),y(i.positionMode),a.build(),setTimeout((function(){0===i.layerNames.length&&p()}),1e3),c=new Cesium.S3MInstanceCollection(o._context),viewer.scene.primitives.add(c)}function p(){var e=h(i.selectedLayerName);a&&a.layers&&(a.layers=e?[e]:[]),i.layerNames.length=0,r&&r.length>0&&(r.forEach((function(e,t){i.layerNames.includes(e._name)||i.layerNames.push(e._name)})),i.selectedLayerName||(i.selectedLayerName=i.layerNames[0]))}function w(e){document.body.classList.remove("measureCur");var t=o.pickPosition(e.message.position);C(g.CartesiantoDegrees(t)),tooltip.setVisible(!1),viewer.eventManager.removeEventListener("CLICK",w)}function h(e){return r.find((function(t,i){return t._name===e}))}function v(e){switch(e){case"box":var t=i.boxParameters;l=new Cesium.GeoBox(t[0],t[1],t[2]);break;case"sphere":var n=i.sphereParameters;l=new Cesium.GeoSphere(n[0]);break;case"cone":var o=i.coneParameters;l=new Cesium.GeoCone(o[0],o[1]),i.rotateOrigin&&(l.rotateOrigin="APEX"==i.rotateOrigin?Cesium.RotationOrigin.APEX:Cesium.RotationOrigin.CENTER);break;case"cylinder":var r=i.cylinderParameters;l=new Cesium.GeoCylinder(r[0],r[1],r[2]);break;case"ellicpse":var s=i.ellicpseParameters;l=new Cesium.GeoEllipsoid(s[0],s[1],s[2]);break;default:(l=new Cesium.GeoModel3D).geoModel=H.geometrys.SkyLineBody,a.clear()}a.geometry=l}function y(e){var t;switch(e){case"intersects":t=Cesium.PositionMode.Intersects;break;case"disjoint":t=Cesium.PositionMode.Disjoint;break;case"contains":t=Cesium.PositionMode.Contains;break;default:t=Cesium.PositionMode.Intersects}a.positionMode=t}function C(e){a&&a.geometry&&(a.geometry.geoPosition=new Cesium.Point3D(e[0],e[1],e[2]))}function b(){var e=h(i.selectedLayerName);console.log(e),e&&(e.selectedColor=new Cesium.Color(.7,.7,1,1),e.setSelection([]),e.selectColorType=Cesium.SelectColorType.MIX),a.clear(),tooltip.setVisible(!1),document.body.classList.remove("measureCur"),a.geometry.geoPosition=new Cesium.Point3D(0,0,0),viewer.eventManager.removeEventListener("CLICK",w)}return A.isViewer&&(window.tooltip||(window.tooltip=ee(viewer._element)),f()),e.watch((function(){return A.isViewer}),(function(e){e&&(window.tooltip||(window.tooltip=ee(viewer._element)),f())})),e.watch((function(){return A.changeLayers}),(function(e){p()})),A.changeGeometrys&&m(),e.watch((function(){return A.changeGeometrys}),(function(e){m()})),e.watch((function(){return i.Xpitch}),(function(e){""!=e&&(l.geoRotationX=parseFloat(e))})),e.watch((function(){return i.Yroll}),(function(e){""!=e&&(l.geoRotationY=parseFloat(e))})),e.watch((function(){return i.Zheading}),(function(e){""!=e&&(l.geoRotationZ=parseFloat(e))})),e.watch((function(){return i.scale}),(function(e){""!=e&&(l.geoScaleX=parseFloat(e),l.geoScaleY=parseFloat(e),l.geoScaleZ=parseFloat(e))})),e.watch((function(){return i.positionMode}),(function(e){""!=e&&y(e)})),e.watch((function(){return i.geometryType}),(function(e){""!==e&&v(e)})),e.watch((function(){return i.drawType}),(function(e){""!=e&&(a.fillStyle=Cesium.FillStyle[e])})),e.watch((function(){return i.FillColor}),(function(e){""!=e&&(a.fillColor=Cesium.Color.fromCssColorString(e))})),e.watch((function(){return i.WireFrameColor}),(function(e){""!=e&&(a.outlineColor=Cesium.Color.fromCssColorString(e))})),e.watch((function(){return i.searchColor}),(function(e){""!=e&&(h(i.selectedLayerName).selectedColor=Cesium.Color.fromCssColorString(e))})),e.watch((function(){return i.selectedLayerName}),(function(e,t){var i=h(t);i&&(i.selectedColor=new Cesium.Color(.7,.7,1,1),i.setSelection([]),i.selectColorType=Cesium.SelectColorType.MIX),b()})),e.onBeforeUnmount((function(){a.destroy(),a=void 0,r=void 0,l=void 0})),s(s({},e.toRefs(i)),{},{setPosition:C,getQueryIDs:function(){return a.getQueryIDs()},analysis:function(){try{var e=h(i.selectedLayerName);if(!e)return void g.Message.warnMsg("请选择需要查询的图层！");if(a.layers=[e],tooltip.setVisible(!1),e.selectedColor=Cesium.Color.fromCssColorString(i.searchColor),e.selectColorType=Cesium.SelectColorType.REPLACE,e.selectEnabled=!1,console.log(a.geometry),"number"==typeof i.geometryType)return v(i.geometryType),void a.build();a.build(),viewer.enableCursorStyle=!1,viewer._element.style.cursor="",document.body.classList.add("measureCur"),u&&(window.tooltip.showAt(" <p>点击鼠标左键确认查询位置</p>","300px"),u=!1),viewer.eventManager.addEventListener("CLICK",w,!0)}catch(e){console.error(e)}},clear:b})},splitScreen:function(t){var i,n,o,r=e.reactive({multiViewport:"NONE",selectedViewport:"0",TreeDatas:[]});if(t)for(var a in t)r.hasOwnProperty(a)?r[a]=t[a]:g.Message.errorMsg(re.AttributeError+a);var l=e.ref(null),c={KeysViewport1:[],KeysViewport2:[],KeysViewport3:[],KeysViewport4:[]};function u(){i=viewer.scene.layers.layerQueue,n=viewer.imageryLayers._layers,o=viewer.scene._vectorTileMaps._layerQueue,viewer.terrainProvider,r.TreeDatas.length=0,function(){if(0==i.length)return;var e={id:"s3m",label:"S3M图层",children:[]};i.forEach((function(t,i){var n={id:"s3m-"+i,label:t._name};e.children.push(n)})),r.TreeDatas[0]=e}(),function(){if(1==n.length)return;var e={id:"img",label:"IMG图层",children:[]};n.forEach((function(t,i){var n=t._imageryProvider instanceof Cesium.MvtProviderGL;if(0===i||n)return!0;var o={id:"img-"+i,label:re.BaseMapImg};t._imageryProvider.tablename&&(o.label=t._imageryProvider.tablename),e.children.unshift(o)})),e.children.length>0&&(r.TreeDatas[1]=e)}(),function(){if(console.log(o),0==o.length)return;var e={id:"mvt",label:"MVT图层",children:[]};o.forEach((function(t,i){var n={id:"mvt-"+i,label:t.name};e.children.unshift(n)})),r.TreeDatas[2]=e}(),setTimeout((function(){l.value.setCheckedNodes(r.TreeDatas);var e=l.value.getCheckedKeys(!0);c.KeysViewport1=f(e),c.KeysViewport2=f(e),c.KeysViewport3=f(e),c.KeysViewport4=f(e)}),500)}return e.onMounted((function(){setTimeout((function(){u()}),500)})),e.watch((function(){return A.changeLayers}),(function(e){u()})),e.watch((function(){return r.multiViewport}),(function(e){viewer.scene.multiViewportMode=Cesium.MultiViewportMode[e]})),e.watch((function(){return r.selectedViewport}),(function(e,t){var i=l.value.getCheckedKeys(!0);c["KeysViewport"+t]=i,l.value.setCheckedKeys(c["KeysViewport"+e],!0)})),e.onBeforeUnmount((function(){i=null,n=null,o=null,c=null})),s(s({},e.toRefs(r)),{},{tree:l,checkNode:function(e){var t=l.value.getNode(e);!function(e,t){var a=e[0],s=e[1];switch(a){case"s3m":if(!s){for(var l=0;l<i.length;l++)i[l].setVisibleInViewport(Number(r.selectedViewport),t);return}i[s].setVisibleInViewport(Number(r.selectedViewport),t);break;case"img":if(!s){for(var c=0;c<n.length;c++)n[c].setVisibleInViewport(Number(r.selectedViewport),t);return}n[s].setVisibleInViewport(Number(r.selectedViewport),t);break;case"mvt":if(!s){for(var u=0;u<o.length;u++)o[u].setVisibleInViewport(Number(r.selectedViewport),t);return}o[s].setVisibleInViewport(Number(r.selectedViewport),t)}}(e.id.split("-"),t.checked)}})},roller:function(t){var i,n,o,r=e.reactive({useRoller:!1,rollerMode:"lrRoller",lrRoller:"1",tbRoller:"4",TreeDatas:[]});if(t)for(var a in t)r.hasOwnProperty(a)?r[a]=t[a]:g.Message.errorMsg(re.AttributeError+a);var l=document.getElementById("cesiumContainer"),c=document.body.clientWidth-l.clientWidth,u=document.body.clientHeight-l.clientHeight,d=l.clientWidth,m=l.clientHeight,f=e.ref(null),p=e.ref(null),w=e.ref(null),h=e.ref(null),v=e.ref(null),y=new Cesium.BoundingRectangle,C={startX:.33,startY:.33,endX:.66,endY:.66,index:1,mode:1};function b(){var e,t;i=viewer.scene.layers.layerQueue,n=viewer.imageryLayers._layers,o=viewer.scene._vectorTileMaps._layerQueue,viewer.terrainProvider,r.TreeDatas.length=0,function(){if(0==i.length)return;var e={id:"s3m",label:"S3M图层",children:[]};i.forEach((function(t,i){var n={id:"s3m-"+i,label:t._name};e.children.push(n)})),r.TreeDatas[0]=e}(),function(){if(1==n.length)return;var e={id:"img",label:"IMG图层",children:[]};n.forEach((function(t,i){if(0===i)return!0;if(t._imageryProvider instanceof Cesium.MvtProviderGL)return!0;var n={id:"img-"+i,label:re.BaseMapImg};t._imageryProvider.tablename&&(n.label=t._imageryProvider.tablename),e.children.unshift(n)})),e.children.length>0&&(r.TreeDatas[1]=e)}(),function(){if(0==o.length)return;var e={id:"mvt",label:"MVT图层",children:[]};o.forEach((function(t,i){var n={id:"mvt-"+i,label:t.name};e.children.unshift(n)})),r.TreeDatas[2]=e}(),t={id:"globe-0",label:"地表"},(e={id:"globe",label:"地球",children:[]}).children.push(t),r.TreeDatas[4]=e,setTimeout((function(){f.value.setCheckedNodes(r.TreeDatas)}),500)}function S(){var e=C.startX,t=C.startY,i=C.endX,n=C.endY;switch(C.mode){case 1:Cesium.BoundingRectangle.unpack([e,0,1,1],0,y);break;case 2:Cesium.BoundingRectangle.unpack([0,0,e,1],0,y);break;case 4:Cesium.BoundingRectangle.unpack([0,t,1,1],0,y);break;case 8:Cesium.BoundingRectangle.unpack([0,0,1,t],0,y);break;case 15:Cesium.BoundingRectangle.unpack([e,t,i-e,n-t],0,y);break;default:Cesium.BoundingRectangle.unpack([0,0,1,1],0,y)}f.value.getCheckedKeys(!0).forEach((function(e){P(e.split("-"),!0)}))}function P(e,t){var r=e[0],a=e[1];switch(r){case"s3m":if(!a){for(var s=0;s<i.length;s++)i[s].swipeEnabled=t,i[s].swipeRegion=y;return}i[a].swipeEnabled=t,i[a].swipeRegion=y;break;case"img":if(!a){for(var l=1;l<n.length;l++)n[l].swipeEnabled=t,n[l].swipeRegion=y;return}n[a].swipeEnabled=t,n[a].swipeRegion=y;break;case"mvt":if(!a){for(var c=0;c<o.length;c++)o[c].swipeEnabled=t,o[c].swipeRegion=y;return}o[a].swipeEnabled=t,o[a].swipeRegion=y;break;case"globe":viewer.scene.globe.swipeEnabled=t,viewer.scene.globe.swipeRegion=y}}function M(e){p.value.style.display="none",w.value.style.display="none",h.value.style.display="none",v.value.style.display="none",1&e&&(p.value.style.display="block"),2&e&&(w.value.style.display="block"),4&e&&(h.value.style.display="block"),8&e&&(v.value.style.display="block")}return e.watch((function(){return A.changeLayers}),(function(e){b()})),e.onMounted((function(){!function(){function e(e){document.removeEventListener("mousemove",i,!1)}function t(e,t){C.index=t,document.addEventListener("mousemove",i,!1)}function i(e){switch(e.preventDefault?e.preventDefault():e.returnValue=!1,C.index){case 1:p.value.style.left=e.clientX-c+"px",C.startX=(e.clientX-c)/d;break;case 2:h.value.style.top=e.clientY-u+"px",C.startY=(e.clientY-u)/m;break;case 3:w.value.style.left=e.clientX-c+"px",C.endX=(e.clientX-c)/d;break;case 4:v.value.style.top=e.clientY-u+"px",C.endY=(e.clientY-u)/m}S()}p.value.addEventListener("mousedown",(function(e){t(e,1)}),!1),w.value.onmousedown=function(e){t(e,3)},h.value.onmousedown=function(e){t(e,2)},v.value.onmousedown=function(e){t(e,4)},window.addEventListener("resize",(function(){d=document.body.clientWidth-c,m=document.body.clientHeight-u})),document.addEventListener("mouseup",e,!1)}(),setTimeout((function(){b()}),500)})),e.watch((function(){return r.multiViewport}),(function(e){viewer.scene.multiViewportMode=Cesium.MultiViewportMode[e]})),e.watch((function(){return r.selectedViewport}),(function(e,t){var i=f.value.getCheckedKeys(!0);r["KeysViewport"+t]=i,f.value.setCheckedKeys(r["KeysViewport"+e],!0)})),e.watch((function(){return r.useRoller}),(function(e){e?(1!=C.mode&&2!=C.mode||M(1),4!=C.mode&&8!=C.mode||M(4),15==C.mode&&M(15),S()):(M(0),P(["s3m"],!1),P(["img"],!1),P(["mvt"],!1),P(["globe"],!1))})),e.watch((function(){return r.rollerMode}),(function(e){switch(e){case"lrRoller":r.useRoller&&M(1),C.mode=Number(r.lrRoller);break;case"tbRoller":r.useRoller&&M(4),C.mode=Number(r.tbRoller);break;case"customRoller":r.useRoller&&M(15),C.mode=15}r.useRoller&&S()})),e.watch((function(){return r.lrRoller}),(function(e){r.useRoller&&(C.mode=Number(e),S())})),e.watch((function(){return r.tbRoller}),(function(e){r.useRoller&&(C.mode=Number(e),S())})),e.onBeforeUnmount((function(){i=void 0,n=void 0,o=void 0})),s(s({},e.toRefs(r)),{},{tree:f,checkNode:function(e){var t=f.value.getNode(e);P(e.id.split("-"),t.checked)},verticalSliderLeft:p,verticalSliderRight:w,horizontalSliderTop:h,horizontalSliderBottom:v})},layerManage:function(t){var i,n,o,r,a,l,c=e.reactive({TreeDatas:[],expandedKeys:[]}),u=e.ref(null),d=e.ref(null),m=function(){},f=document.getElementById("cesiumContainer"),p=document.body.clientWidth-f.clientWidth,w=document.body.clientHeight-f.clientHeight;function h(){i=viewer.scene.layers.layerQueue,n=viewer.imageryLayers._layers,r=viewer.scene._vectorTileMaps._layerQueue,o=viewer.terrainProvider,c.TreeDatas.length=0,v(),y(),g(),function(){if(!o.tablename)return;var e={id:"terrain",label:"地形图层",children:[]},t={id:"terrain-0",label:o.tablename};e.children.push(t),c.TreeDatas[3]=e}(),setTimeout((function(){u.value.setCheckedNodes(c.TreeDatas)}),500),console.log(r)}function v(){if(0!=i.length){var e={id:"s3m",label:"S3M图层",children:[]};i.forEach((function(t,i){var n={id:"s3m-"+i,label:t._name};e.children.push(n)})),c.TreeDatas[0]=e}else c.TreeDatas[0]&&u.value.remove(c.TreeDatas[0])}function y(){if(1!=n.length){var e={id:"img",label:"IMG图层",children:[]};n.forEach((function(t,i){var n=t._imageryProvider instanceof Cesium.MvtProviderGL;if(0===i||n)return!0;var o={id:"img-"+i,label:re.BaseMapImg};t._imageryProvider.tablename&&(o.label=t._imageryProvider.tablename),e.children.unshift(o)})),e.children.length>0&&(c.TreeDatas[1]=e)}else c.TreeDatas[1]&&u.value.remove(c.TreeDatas[1])}function g(){if(0!=r.length){var e={id:"mvt",label:"MVT图层",children:[]};r.forEach((function(t,i){var n={id:"mvt-"+i,label:t.name};e.children.unshift(n)})),c.TreeDatas[2]=e}else c.TreeDatas[2]&&u.value.remove(c.TreeDatas[2])}return t&&t.deleteCallback&&(m=t.deleteCallback),e.watch((function(){return A.changeLayers}),(function(e){h()})),e.onMounted((function(){setTimeout((function(){h()}),500)})),document.onclick=function(e){e.stopPropagation(),d.value.style.display="none"},e.onBeforeUnmount((function(){document.onclick=function(){}})),s(s({},e.toRefs(c)),{},{tree:u,domContextmenu:d,checkNode:function(e){var t=u.value.getNode(e);!function(e,t){var o=e[0],s=e[1];switch(o){case"s3m":if(!s){for(var l=0;l<i.length;l++)i[l].visible=t;return}i[s].visible=t;break;case"img":if(!s){for(var c=1;c<n.length;c++)n[c].show=t;return}n[s].show=t;break;case"mvt":if(!s){for(var u=0;u<r.length;u++)r[u].show=t;return}r[s].show=t;break;case"terrain":t?viewer.terrainProvider=a:(a=viewer.terrainProvider,viewer.terrainProvider=new Cesium.EllipsoidTerrainProvider)}}(e.id.split("-"),t.checked)},nodeContextmenu:function(e,t){t.id.split("-")[1]&&(l=t,d.value.style.left=e.clientX+30-p+"px",e.clientX>=1810&&(d.value.style.left=e.clientX-80-p+"px"),d.value.style.top=e.clientY-w+"px",d.value.style.display="block")},nodeClick:function(e){!function(e){var t,o=e[0],a=e[1];switch(o){case"s3m":a&&(t=i[a]);break;case"img":a&&(t=n[a]);break;case"mvt":a&&(t=r[a])}t&&viewer.flyTo(t)}(e.id.split("-"))},deleteLayer:function(){d.value.style.display="none";var e=l.id.split("-"),t=e[0],o=e[1];switch(t){case"s3m":o&&(viewer.scene.layers.remove(i[o]._name),v(),setTimeout((function(){c.expandedKeys=["s3m"],u.value.setCheckedNodes(c.TreeDatas)}),50));break;case"img":o&&(viewer.imageryLayers.remove(n[o]),y(),setTimeout((function(){u.value.setCheckedNodes(c.TreeDatas)}),50));break;case"mvt":o&&(viewer.scene.removeVectorTilesMap(r[o].name),g(),setTimeout((function(){u.value.setCheckedNodes(c.TreeDatas)}),100));break;case"terrain":viewer.terrainProvider=new Cesium.EllipsoidTerrainProvider,a=null;var s=u.value.getNode(t);u.value.remove(s)}O(),m(l)}})},mvtlayerStyle:function(t){var i,n,o,r,a=e.reactive({layerNames:[],selectedLayerIndex:"none",childLayerNames:[],selectedChildLayerIndex:"none",mvtAlpha:1,showLayer:!0,textAvoidance:!0,openFilter:!1,propertyKeys:[],symbols:[],clickGetFeature:{layer:{id:null},id:null},isClickShowProperty:!0,dockFontShow:!0,bubbleShow:!1,selectedPropertyKeys:[""],selectedSymbols:[""],inputPropertys:[""],inputSymbols:[""],inputValues:[""]}),l=[],c=!1,u=e.ref(null);function d(){(i=viewer.scene._vectorTileMaps._layerQueue)&&i.length>0?(i.forEach((function(e,t){a.layerNames.includes(e.name)||a.layerNames.push(e.name)})),console.log("init"),(a.selectedLayerIndex="none")&&(a.selectedLayerIndex=0)):a.selectedLayerIndex="none",viewer.eventManager.addEventListener("CLICK",p,!0)}function m(e){return e.slice(0,e.length-1)}function f(){if(""==a.inputPropertys[0])return!1;var e=["any"];return a.inputPropertys.forEach((function(t,i){var n=[];n[0]=a.inputSymbols[i],n[1]=t,n[2]=a.inputValues[i],"number"==typeof Number(n[2])&&(n[2]=Number(n[2])),e.push(n)})),!(e.length<2)&&e}function p(e){var t=viewer.scene.pick(e.message.position)||viewer.selectedEntity;if(Cesium.defined(t)&&Cesium.defined(t.pickResult)){var i=document.body.clientWidth-e.message.position.x;u.value.style.left=i>=300?e.message.position.x+"px":e.message.position.x-250+"px",u.value.style.top=e.message.position.y-220+"px",a.bubbleShow=!0;var n=null;for(var o in t.pickResult){n=t.pickResult[o];break}var r=n[0].feature;r&&(a.clickGetFeature=r),console.log(r)}else a.bubbleShow=!1}function w(){r&&(n.removeLayer(r.id),r=null)}return a.symbols=["!","!=",">",">=","<","<=","==","in","like","!like","left","right"],A.isViewer&&setTimeout((function(){return d()}),500),e.watch((function(){return A.isViewer}),(function(e){d()})),e.watch((function(){return A.changeLayers}),(function(e){d()})),e.watch((function(){return a.selectedLayerIndex}),(function(e){"none"!==e&&(l.length=0,n=i[e],a.showLayer=n.show,n.readyPromise.then((function(e){e&&(n.mapboxStyle.layers.forEach((function(e,t){a.childLayerNames.includes(e.id)||a.childLayerNames.push(e.id);var i=n.getLayoutProperty(e.id,"visibility");l.push(i)})),a.selectedChildLayerIndex=0)})))})),e.watch((function(){return a.selectedChildLayerIndex}),(function(e){o=n.mapboxStyle.layers[e];var t=n.querySourceFeatures({sourceLayer:o.id,filter:["<","$id",10]});0==t.length?a.propertyKeys=[]:a.propertyKeys=t[0]._keys.length>0?t[0]._keys:[]})),e.watch((function(){return a.mvtAlpha}),(function(e){n&&(n.alpha=Number(e))})),e.watch((function(){return a.showLayer}),(function(e){n&&(n.show=e)})),e.watch((function(){return a.textAvoidance}),(function(e){if(n)for(var t=n.mapboxStyle.layers,i=0;i<t.length;i++)t[i].isOverlapDisplayed=e})),e.watch((function(){return a.isClickShowProperty}),(function(e){if(e)return viewer.eventManager.addEventListener("CLICK",p,!0),void(a.bubbleShow=!0);viewer.eventManager.removeEventListener("CLICK",p),a.bubbleShow=!1})),e.watch((function(){return a.selectedPropertyKeys}),(function(e,t){e.length===t.length&&e.forEach((function(e,t){a.inputPropertys[t]=e}))}),{deep:!0}),e.watch((function(){return a.selectedSymbols}),(function(e,t){e.length===t.length&&e.forEach((function(e,t){if("left"===e||"right"===e)return""===a.inputPropertys[t]||a.inputPropertys[t].includes("left(")||a.inputPropertys[t].includes("right(")?void(a.inputPropertys[t]=e+"()"):void(a.inputPropertys[t]=e+"("+a.inputPropertys[t]+",2)");a.inputSymbols[t]=e}))}),{deep:!0}),e.onBeforeUnmount((function(){i=null,n=null,o=null})),s(s({},e.toRefs(a)),{},{addCondition:function(e){if(!e)return a.selectedPropertyKeys=m(a.selectedPropertyKeys),a.selectedSymbols=m(a.selectedSymbols),a.inputSymbols=m(a.inputSymbols),a.inputPropertys=m(a.inputPropertys),void(a.inputValues=m(a.inputValues));a.selectedPropertyKeys=a.selectedPropertyKeys.concat([""]),a.selectedSymbols=a.selectedSymbols.concat([""]),a.inputSymbols=a.inputSymbols.concat([""]),a.inputPropertys=a.inputPropertys.concat([""]),a.inputValues=a.inputValues.concat([""])},propertySearch:function(){var e=f();e&&function(e){r&&w();if(!o)return;var t=o.id+"_highlight";r||((r=Cesium.clone(o,!0)).id=t,"line"==o.type?r.paint["line-color"]="rgba(0,255,255,1.00)":"fill"==o.type?r.paint["fill-color"]="rgba(0,255,255,1.00)":r.paint["text-color"]="rgba(255,0,0,1.00)",r.layout.visibility="visible",r.minzoom=3,n.addLayer(r),n.setFilter(r.id,e))}(e)},propertyFilter:function(){var e=f();c=!0,n&&(n.mapboxStyle.layers.forEach((function(e){n.setLayoutProperty(e.id,"visibility","none")})),n.setLayoutProperty(o.id,"visibility","visible"),e&&n.setFilter(o.id,e))},clear:function(){w(),c&&(n.mapboxStyle.layers.forEach((function(e,t){n.setLayoutProperty(e.id,"visibility",l[t])})),n.setFilter(o.id,null),n.refresh(),c=!1)},bubble:u,closeBubble:function(){a.bubbleShow=!1},dockBubble:function(e){e?(u.value.classList.add("bubbleDock"),a.dockFontShow=!1):(u.value.classList.remove("bubbleDock"),a.dockFontShow=!0)}})},s3mlayerAttribute:function(t){var i,n,o=e.reactive({layerNames:[],selectedLayerName:"none",brightness:1,contrast:1,hue:0,saturation:1,gamma:1,shadowMode:"noShadow",shadowDarkness:.3,selectEnabled:!0,multiChoose:!1,cullEnabled:!1,visibility:"showAll"});if(t)for(var r in t)o.hasOwnProperty(r)?o[r]=t[r]:g.Message.errorMsg(re.AttributeError+r);function a(){viewer.scene,(i=viewer.scene.layers.layerQueue)&&i.length>0?(i.forEach((function(e,t){o.layerNames.includes(e._name)||o.layerNames.push(e._name)})),(o.selectedLayerName="none")&&(o.selectedLayerName=o.layerNames[0],n=i[0])):o.layerNames=[]}return A.isViewer&&a(),e.watch((function(){return A.isViewer}),(function(e){e&&a()})),e.watch((function(){return A.changeLayers}),(function(e){a()})),e.onBeforeUnmount((function(){i=null})),e.watch((function(){return o.selectedLayerName}),(function(e){var t=o.layerNames.indexOf(e);-1!=t&&(n=i[t])})),e.watch((function(){return o.brightness}),(function(e){n&&(n.brightness=Number(e))})),e.watch((function(){return o.contrast}),(function(e){n&&(n.contrast=Number(e))})),e.watch((function(){return o.hue}),(function(e){n&&(n.hue=Number(e))})),e.watch((function(){return o.saturation}),(function(e){n&&(n.saturation=Number(e))})),e.watch((function(){return o.gamma}),(function(e){n&&(n.gamma=Number(e))})),e.watch((function(){return o.shadowMode}),(function(e){if(n)switch(e){case"noShadow":viewer.shadows=!1,n.shadowType=Cesium.ShadowType.NONE;break;case"chooseShadow":viewer.shadows=!0,n.shadowType=Cesium.ShadowType.SELECTION,n.refresh();break;case"allShadow":viewer.shadows=!0,n.shadowType=Cesium.ShadowType.ALL,n.refresh()}})),e.watch((function(){return o.shadowDarkness}),(function(e){viewer.scene.shadowMap.darkness=Number(e)})),e.watch((function(){return o.multiChoose}),(function(e){n&&(n.multiChoose=e)})),e.watch((function(){return o.selectEnabled}),(function(e){n&&(n.selectEnabled=e)})),e.watch((function(){return o.cullEnabled}),(function(e){n&&(n.cullEnabled=e)})),e.watch((function(){return o.visibility}),(function(e){if(n)switch(e){case"showAll":n.setObjsVisible([],!1);break;case"onlyHideSlection":var t=n.getSelection();n.setObjsVisible(t,!1);break;case"onlyShowSlection":var i=n.getSelection();n.setObjsVisible(i,!0)}})),s({},e.toRefs(o))},s3mlayerStyle:function(t){var i,n,o=this,r=e.reactive({layerNames:[],selectedLayerName:"none",foreColor:"#ffffff",lineColor:"rgba(27, 27, 27, 1)",selectedColor:"#A40FF4",selectColorMode:"mix",bottomAltitude:0,LODScale:5,layerTrans:1,fillStyle:"fill",visibleDistanceMin:0,visibleDistanceMax:1e4});if(t)for(var a in t)r.hasOwnProperty(a)?r[a]=t[a]:g.Message.errorMsg(re.AttributeError+a);function l(){viewer.scene,(i=viewer.scene.layers.layerQueue)&&i.length>0?(i.forEach((function(e,t){r.layerNames.includes(e._name)||r.layerNames.push(e._name)})),(r.selectedLayerName="none")&&(r.selectedLayerName=r.layerNames[0],n=i[0])):r.layerNames=[]}return A.isViewer&&l(),e.watch((function(){return A.isViewer}),(function(e){e&&l()})),e.watch((function(){return A.changeLayers}),(function(e){l()})),e.onBeforeUnmount((function(){i=null})),e.watch((function(){return r.selectedLayerName}),(function(e){var t=r.layerNames.indexOf(e);-1!=t&&(n=i[t])})),e.watch((function(){return r.foreColor}),(function(e){n&&(n.style3D.fillForeColor=Cesium.Color.fromCssColorString(e))})),e.watch((function(){return r.lineColor}),(function(e){n&&(n.style3D.lineColor=Cesium.Color.fromCssColorString(e))})),e.watch((function(){return r.selectedColor}),(function(e){n&&(n.selectedColor=Cesium.Color.fromCssColorString(e))})),e.watch((function(){return r.selectColorMode}),(function(e){n&&(n.selectColorType="mix"===e?0:1)})),e.watch((function(){return r.bottomAltitude}),(function(e){n&&(n.style3D.bottomAltitude=Number(e)),n.refresh()})),e.watch((function(){return r.fillStyle}),(function(e){if(n)switch(e){case"fill":n.style3D.fillStyle=Cesium.FillStyle.Fill;break;case"wireframe":n.style3D.fillStyle=Cesium.FillStyle.WireFrame,n.style3D.lineColor=Cesium.Color.fromCssColorString(r.lineColor);break;case"fill-and-wireframe":n.style3D.fillStyle=Cesium.FillStyle.Fill_And_WireFrame,n.style3D.lineColor=Cesium.Color.fromCssColorString(r.lineColor)}n.refresh()})),e.watch((function(){return r.LODScale}),(function(e){n&&(n.lodRangeScale=Number(e))})),e.watch((function(){return r.layerTrans}),(function(e){n&&(n.style3D.fillForeColor.alpha=Number(e))})),e.watch((function(){return r.visibleDistanceMin}),(function(e){""==e&&(e=0),n&&(n.visibleDistanceMin=Number(e))})),e.watch((function(){return r.visibleDistanceMax}),(function(e){""==e&&(e=o.maxNumber),n&&(n.cullEnabled=e),n.visibleDistanceMax=Number(e)})),s({},e.toRefs(r))},s3mlayerOperation:function(t){var i,n,o=e.reactive({layerNames:[],selectedLayerName:"none",selectedoffset:!1,offsetX:0,offsetY:0,offsetZ:0,polygonOffset:!1,polygonOffsetFactor:0,polygonOffsetUnit:0});if(t)for(var r in t)o.hasOwnProperty(r)?o[r]=t[r]:g.Message.errorMsg(re.AttributeError+r);function a(){viewer.scene,(i=viewer.scene.layers.layerQueue)&&i.length>0?(i.forEach((function(e,t){o.layerNames.includes(e._name)||o.layerNames.push(e._name)})),(o.selectedLayerName="none")&&(o.selectedLayerName=o.layerNames[0],n=i[0])):o.layerNames=[]}function l(){var e=n.getSelection();n.removeAllObjsOffset(),e.length>0&&n.setObjsOffset(e)}return A.isViewer&&a(),e.watch((function(){return A.isViewer}),(function(e){e&&a()})),e.watch((function(){return A.changeLayers}),(function(e){a()})),e.onBeforeUnmount((function(){i=null})),e.watch((function(){return o.selectedLayerName}),(function(e){var t=o.layerNames.indexOf(e);-1!=t&&(n=i[t])})),e.watch((function(){return o.selectedoffset}),(function(e){if(n)if(e){var t=Number(o.offsetX),i=Number(o.offsetY),r=Number(o.offsetZ);n.selectedTranslate=new Cesium.Cartesian3(t,i,r),viewer.eventManager.addEventListener("CLICK",l,!0),l()}else viewer.eventManager.removeEventListener("CLICK",l),n.selectedTranslate=new Cesium.Cartesian3(0,0,0),n.removeAllObjsOffset(),n.releaseSelection()})),e.watch((function(){return o.offsetX}),(function(e){if(o.selectedoffset){var t=Number(e),i=Number(o.offsetY),r=Number(o.offsetZ);n.selectedTranslate=new Cesium.Cartesian3(t,i,r)}})),e.watch((function(){return o.offsetY}),(function(e){if(o.selectedoffset){var t=Number(o.offsetX),i=Number(o.offsetY),r=Number(o.offsetZ);n.selectedTranslate=new Cesium.Cartesian3(t,i,r)}})),e.watch((function(){return o.offsetZ}),(function(e){if(o.selectedoffset){var t=Number(o.offsetX),i=Number(o.offsetY),r=Number(o.offsetZ);n.selectedTranslate=new Cesium.Cartesian3(t,i,r)}})),e.watch((function(){return o.polygonOffset}),(function(e){n&&(e?n.setPolygonoffset(Number(o.polygonOffsetFactor),Number(e)):n.setPolygonoffset(0,0))})),e.watch((function(){return o.polygonOffsetFactor}),(function(e){n&&o.polygonOffset&&n.setPolygonoffset(Number(e),Number(o.polygonOffsetUnit))})),e.watch((function(){return o.polygonOffsetUnit}),(function(e){n&&o.polygonOffset&&n.setPolygonoffset(Number(o.polygonOffsetFactor),Number(e))})),s({},e.toRefs(o))},modelFlood:function(t){var i,n,o=e.reactive({layerNames:[],selectedLayerName:"none",maxHeight:200,minHeight:0,floodHeight:[0,200],currentHeight:0,floodSpeed:1,floodTrans:.8,cheackedBand:"band1",colorBandShow:!1,floodPositions:[],lineVisible:!0});if(t)for(var r in t)o.hasOwnProperty(r)?o[r]=t[r]:g.Message.errorMsg(re.AttributeError+r);var a,l=Cesium.HypsometricSettingEnum.DisplayMode.FACE,c=new Cesium.HypsometricSetting,u=new Cesium.ColorTable;u.insert(500,new Cesium.Color(0,39/255,148/255)),u.insert(0,new Cesium.Color(149/255,232/255,249/255));var d=[];function m(){viewer.scene,(i=viewer.scene.layers.layerQueue)&&i.length>0&&(i.forEach((function(e,t){o.layerNames.includes(e._name)||o.layerNames.push(e._name)})),(o.selectedLayerName="none")&&(o.selectedLayerName=o.layerNames[0],n=i[0]))}function f(e){e&&(d=e),c.CoverageArea=e;var t=Number(o.minHeight);a=setInterval("ModelFlood()",100),window.ModelFlood=function(){if(t>o.maxHeight)return o.currentHeight=o.maxHeight,void clearInterval(a);o.currentHeight=Number(t.toFixed(2)),c.MaxVisibleValue=t;try{p()}catch(e){console.log(e),clearInterval(a)}t+=parseFloat(o.floodSpeed)/10}}function p(){0!=d.length&&(n.hypsometricSetting={hypsometricSetting:c,analysisMode:Cesium.HypsometricSettingEnum.AnalysisRegionMode.ARM_REGION})}return A.isViewer&&m(),e.watch((function(){return A.isViewer}),(function(e){e&&m()})),e.watch((function(){return A.changeLayers}),(function(e){m()})),e.onBeforeUnmount((function(){i=null,c.destroy(),u.destroy(),c=void 0,u=void 0})),e.watch((function(){return o.selectedLayerName}),(function(e){var t=o.layerNames.indexOf(e);-1!=t&&(n=i[t])})),e.watch((function(){return o.maxHeight}),(function(e){c.MaxVisibleValue=parseInt(e),p()})),e.watch((function(){return o.minHeight}),(function(e){c.MinVisibleValue=parseInt(e),o.currentHeight=parseInt(e),p()})),e.watch((function(){return o.floodHeight}),(function(e){o.minHeight=e[0],o.maxHeight=e[1]})),e.watch((function(){return o.floodTrans}),(function(e){c.Opacity=parseFloat(e),p()})),e.watch((function(){return o.cheackedBand}),(function(e){u=function(e){var t=new Cesium.ColorTable;switch(e){case"band1":t.insert(500,new Cesium.Color(0,39/255,148/255)),t.insert(0,new Cesium.Color(149/255,232/255,249/255));break;case"band2":t.insert(500,new Cesium.Color(162/255,251/255,194/255)),t.insert(0,new Cesium.Color(1,103/255,103/255));break;case"band3":t.insert(500,new Cesium.Color(230/255,198/255,1)),t.insert(0,new Cesium.Color(157/255,0,1));break;case"band4":t.insert(500,new Cesium.Color(210/255,15/255,15/255)),t.insert(100,new Cesium.Color(221/255,224/255,7/255)),t.insert(50,new Cesium.Color(20/255,187/255,18/255)),t.insert(4e3,new Cesium.Color(0,161/255,1)),t.insert(0,new Cesium.Color(9/255,9/255,212/255));break;case"band5":t.insert(500,new Cesium.Color(186/255,1,229/255)),t.insert(0,new Cesium.Color(26/255,185/255,156/255));break;default:t.insert(500,new Cesium.Color(0,39/255,148/255)),t.insert(0,new Cesium.Color(149/255,232/255,249/255))}return t}(e),c.ColorTable=u,p()})),s(s({},e.toRefs(o)),{},{floodClear:function(e){e.preventDefault(),n.hypsometricSetting.hypsometricSetting.MaxVisibleValue=-1e3,clearInterval(a),d=[],o.currentHeight=Number(o.floodHeight[0]),window.handlerPolygon&&me("Polygon")},floodBegin:function(e){e.preventDefault(),c.DisplayMode=l,c._lineColor=new Cesium.Color(1,0,0,1),c.MinVisibleValue=Number(o.floodHeight[0]),c.MaxVisibleValue=0,c.ColorTableMinKey=0,c.ColorTableMaxKey=200,c.ColorTable=u,c.Opacity=Number(o.floodTrans),c.LineInterval=10,window.handlerPolygon||ue("Polygon"),t&&t.floodPositions?f(t.floodPositions):(de("Polygon",o.lineVisible).then((function(e){var t=window.handlerPolygon;f(e.positions),t.polygon.show=!1,t.deactivate()}),(function(e){console.log(e)})),window.handlerPolygon.activate(),viewer.scene.pickPositionSupported||g.Message.errorMsg(re.NoPickPositionSupported))},changeColor:function(e){o.colorBandShow=!1,o.cheackedBand=e},floodPosition:d})},photography:function(t){var i=e.reactive({layerNames:[],selectedLayerName:"none",operationType:"Excavation",lineVisible:!0});if(t)for(var n in t)i.hasOwnProperty(n)?i[n]=t[n]:g.Message.errorMsg(re.AttributeError+n);var o,r,a=[],l=[];function c(){viewer.scene,(o=viewer.scene.layers.layerQueue)&&o.length>0&&(o.forEach((function(e,t){i.layerNames.includes(e._name)||i.layerNames.push(e._name)})),(i.selectedLayerName="none")&&(i.selectedLayerName=i.layerNames[0],r=o[0]))}function u(e){e&&(a=e),r.addExcavationRegion({position:e,name:"excavation_"+Math.random()})}function d(e){e&&(l=e),r.addFlattenRegion({position:e,name:"flatten"+Math.random()})}return A.isViewer&&c(),e.watch((function(){return A.isViewer}),(function(e){e&&c()})),e.watch((function(){return A.changeLayers}),(function(e){c()})),e.watch((function(){return i.selectedLayerName}),(function(e){var t=i.layerNames.indexOf(e);-1!=t&&(r=o[t])})),e.onBeforeUnmount((function(){o=null})),s(s({},e.toRefs(i)),{},{startExcavation:function(e){e.preventDefault(),window.handlerPolygon||ae("Polygon"),t&&t.excavationPositions?u(t.excavationPositions):(se("Polygon",i.lineVisible).then((function(e){var t=window.handlerPolygon;u(e.positions),t.polygon.show=!1,t.polyline.show=!1,t.deactivate()}),(function(e){console.log(e)})),window.handlerPolygon.activate(),viewer.scene.pickPositionSupported||g.Message&&g.Message.errorMsg(re.NoPickPositionSupported))},clearExcavation:function(e){e.preventDefault(),a=[],window.handlerPolygon&&(r.removeAllExcavationRegion(),le("Polygon"))},startFlatten:function(e){e.preventDefault(),window.handlerPolygon||ae("Polygon"),t&&t.flattenPositions?d(t.flattenPositions):(se("Polygon",i.lineVisible).then((function(e){var t=window.handlerPolygon;d(e.positions),t.polygon.show=!1,t.polyline.show=!1}),(function(e){console.log(e)})),window.handlerPolygon.activate(),viewer.scene.pickPositionSupported||g.Message&&g.Message.errorMsg(re.NoPickPositionSupported))},clearFlatten:function(e){e.preventDefault(),window.handlerPolygon&&(r.removeAllFlattenRegion(),le("Polygon"))},excavationPositions:a,flattenPositions:l})},imglayerAttribute:function(t){var i,n,o=e.reactive({layerNames:[],selectedLayerName:"none",brightness:1,contrast:1,hue:0,saturation:1,gamma:1,alpha:1,transparentBackColor:"#eecccc",transparentBackColorTolerance:0});if(t)for(var r in t)o.hasOwnProperty(r)?o[r]=t[r]:g.Message.errorMsg(re.AttributeError+r);function a(){viewer.scene,(i=viewer.imageryLayers._layers)&&i.length>1&&(i.forEach((function(e,t){var i=e._imageryProvider instanceof Cesium.MvtProviderGL;if(0===t||i)return!0;o.layerNames.includes(e._imageryProvider.tablename)||o.layerNames.push(e._imageryProvider.tablename)})),(o.selectedLayerName="none")&&(o.selectedLayerName=o.layerNames[0],n=i[1]))}return A.isViewer&&a(),e.watch((function(){return A.isViewer}),(function(e){e&&a()})),e.watch((function(){return A.changeLayers}),(function(e){a()})),e.onBeforeUnmount((function(){i=null})),e.watch((function(){return o.selectedLayerName}),(function(e){var t=o.layerNames.indexOf(e);-1!=t&&(n=i[t+1])})),e.watch((function(){return o.brightness}),(function(e){n&&(n.brightness=Number(e))})),e.watch((function(){return o.contrast}),(function(e){n&&(n.contrast=Number(e))})),e.watch((function(){return o.hue}),(function(e){n&&(n.hue=Number(e))})),e.watch((function(){return o.saturation}),(function(e){n&&(n.saturation=Number(e))})),e.watch((function(){return o.gamma}),(function(e){n&&(n.gamma=Number(e))})),e.watch((function(){return o.alpha}),(function(e){n&&(n.alpha=Number(e))})),e.watch((function(){return o.transparentBackColor}),(function(e){var t=Cesium.Color.fromCssColorString(e);n&&(n.transparentBackColor=t)})),e.watch((function(){return o.transparentBackColorTolerance}),(function(e){n&&(n.transparentBackColorTolerance=Number(e))})),s({},e.toRefs(o))},sceneAttribute:function(t){var i=e.reactive({earthShow:!0,shadows:!1,cloud:!1,skyBox:!1,sunShow:!1,timeline:!1,depthAgainst:!0,atomsphereRender:!0,fogEffect:!0,underground:!0,frameRate:!1,rain:!1,snow:!1,surfaceTransparency:1,cloudsUrl:"public/img/skyboxs/clouds/clouds1.png",skyboxSources:null,skyboxType:"bluesky",uspeed:0,vspeed:0,wspeed:.5,viewMode:"3D",rainAngle:45,rainSpeed:8,snowDesity:10,snowSpeed:4,snowAngle:10,snowType:"0",compass:!1,isCompass:""});if(i.skyboxSources={bluesky:{positiveX:"public/img/skyboxs/bluesky/Right.jpg",negativeX:"public/img/skyboxs/bluesky/Left.jpg",positiveY:"public/img/skyboxs/bluesky/Front.jpg",negativeY:"public/img/skyboxs/bluesky/Back.jpg",positiveZ:"public/img/skyboxs/bluesky/Up.jpg",negativeZ:"public/img/skyboxs/bluesky/Down.jpg"},sunsetglow:{positiveX:"public/img/skyboxs/sunsetglow/Right.jpg",negativeX:"public/img/skyboxs/sunsetglow/Left.jpg",positiveY:"public/img/skyboxs/sunsetglow/Front.jpg",negativeY:"public/img/skyboxs/sunsetglow/Back.jpg",positiveZ:"public/img/skyboxs/sunsetglow/Up.jpg",negativeZ:"public/img/skyboxs/sunsetglow/Down.jpg"}},t)for(var n in t)i.hasOwnProperty(n)?i[n]=t[n]:g.Message.errorMsg(re.AttributeError+n);var o,r=new Cesium.CloudBox({url:i.cloudsUrl}),a={};for(var l in i.skyboxSources){var c=new Cesium.SkyBox({sources:i.skyboxSources[l]});c.USpeed=i.uspeed,c.VSpeed=i.vspeed,c.WSpeed=i.wspeed,a[l]=c}function u(){if(viewer.scene.frameState.passes.render){for(var e in a)a[e].update(viewer.scene.frameState,!0),a[e].show=!1;viewer.scene.postRender.removeEventListener(u)}}function d(){i.skyBox&&(viewer.scene.camera.positionCartographic.height>22e4?(viewer.scene.skyBox.show=!1,i.atomsphereRender=!0):(viewer.scene.skyBox.show=!0,i.atomsphereRender=!1))}return A.isViewer&&(o=viewer.scene.skyBox,viewer.scene.postRender.addEventListener(u),viewer.scene.postProcessStages.snow.uniforms.density=parseFloat(i.snowDesity),viewer.scene.postProcessStages.snow.uniforms.speed=parseFloat(i.snowSpeed),viewer.scene.postProcessStages.rain.uniforms.speed=parseFloat(i.rainSpeed),d()),e.watch((function(){return A.isViewer}),(function(e){e&&(o=viewer.scene.skyBox,viewer.scene.postRender.addEventListener(u),viewer.scene.postProcessStages.snow.uniforms.density=parseFloat(i.snowDesity),viewer.scene.postProcessStages.snow.uniforms.speed=parseFloat(i.snowSpeed),viewer.scene.postProcessStages.rain.uniforms.speed=parseFloat(i.rainSpeed),d())})),e.onBeforeUnmount((function(){for(var e in r.destroy(),a)a[e].destroy();viewer.scene.skyBox=o})),e.watch((function(){return i.earthShow}),(function(e){viewer.scene.globe.show=e})),e.watch((function(){return i.shadows}),(function(e){viewer.scene.shadows=e})),e.watch((function(){return i.sunShow}),(function(e){viewer.scene.globe.enableLighting=e})),e.watch((function(){return i.timeline}),(function(e){var t=document.getElementsByClassName("cesium-viewer-timelineContainer")[0];t.style.visibility=e?"visible":"hidden"})),e.watch((function(){return i.depthAgainst}),(function(e){viewer.scene.globe.depthTestAgainstTerrain=e})),e.watch((function(){return i.atomsphereRender}),(function(e){viewer.scene.skyAtmosphere.show=e})),e.watch((function(){return i.fogEffect}),(function(e){viewer.scene.fog.enabled=e})),e.watch((function(){return i.surfaceTransparency}),(function(e){viewer.scene.globe.globeAlpha=parseFloat(e)})),e.watch((function(){return i.underground}),(function(e){viewer.scene.undergroundMode=e})),e.watch((function(){return i.frameRate}),(function(e){viewer.scene.debugShowFramesPerSecond=e})),e.watch((function(){return i.cloud}),(function(e){viewer.scene.cloudBox=e?r:null})),e.watch((function(){return i.cloudsUrl}),(function(e){viewer.scene.cloudBox.url=e})),e.watch((function(){return i.skyBox}),(function(e){if(e){var t=viewer.scene.camera.positionCartographic.height;viewer.scene.postRender.addEventListener(d),viewer.scene.skyBox=a[i.skyboxType],t<22e4?(viewer.scene.skyBox.show=!0,i.atomsphereRender=!1):i.atomsphereRender=!0}else i.atomsphereRender=!0,viewer.scene.skyBox.show=!1,viewer.scene.skyBox=o,viewer.scene.postRender.removeEventListener(d)})),e.watch((function(){return i.skyboxType}),(function(e){i.skyBox&&(a[e].show=!0,viewer.scene.skyBox=a[e])})),e.watch((function(){return i.uspeed}),(function(e){a[i.skyboxType].USpeed=Number(e),i.skyBox&&(viewer.scene.skyBox.USpeed=Number(e))})),e.watch((function(){return i.vspeed}),(function(e){a[i.skyboxType].VSpeed=Number(e),i.skyBox&&(viewer.scene.skyBox.VSpeed=Number(e))})),e.watch((function(){return i.wspeed}),(function(e){a[i.skyboxType].WSpeed=Number(e),i.skyBox&&(viewer.scene.skyBox.WSpeed=Number(e))})),e.watch((function(){return i.viewMode}),(function(e){viewer.scene.mode="2D"===e?Cesium.SceneMode.SCENE2D:"3D"===e?Cesium.SceneMode.SCENE3D:Cesium.SceneMode.COLUMBUS_VIEW})),e.watch((function(){return i.rain}),(function(e){viewer.scene.postProcessStages.rain.enabled=e})),e.watch((function(){return i.snow}),(function(e){viewer.scene.postProcessStages.snow.enabled=e,console.log(viewer.scene.postProcessStages.snow.uniforms)})),e.watch((function(){return i.rainAngle}),(function(e){viewer.scene.postProcessStages.rain.uniforms.angle=parseFloat(e)})),e.watch((function(){return i.rainSpeed}),(function(e){viewer.scene.postProcessStages.rain.uniforms.speed=parseFloat(e)})),e.watch((function(){return i.snowDesity}),(function(e){viewer.scene.postProcessStages.snow.uniforms.density=parseFloat(e)})),e.watch((function(){return i.snowSpeed}),(function(e){viewer.scene.postProcessStages.snow.uniforms.speed=parseFloat(e)})),e.watch((function(){return i.snowAngle}),(function(e){viewer.scene.postProcessStages.snow.uniforms.angle=parseFloat(e)})),e.watch((function(){return i.snowType}),(function(e){switch(e){case"0":i.snowDesity=5,i.snowSpeed=2;break;case"1":i.snowDesity=10,i.snowSpeed=4;break;case"2":i.snowDesity=15,i.snowSpeed=6;break;case"3":i.snowDesity=20,i.snowSpeed=10;break;default:i.snowDesity=5,i.snowSpeed=2}})),e.watch((function(){return i.isCompass}),(function(e){i.compass=e?"Sm3dCompass":""})),s({},e.toRefs(i))},facade:function(t){var i,n,o,r=e.reactive({maxDistance:200,maxHeight:100,setLodrange:!1,layerNames:[],selectedLayerName:"none",lodrange:.01});if(t)for(var a in t)r.hasOwnProperty(a)?r[a]=t[a]:g.Message.errorMsg(re.AttributeError+a);function l(){viewer.scene,(n=viewer.scene.layers.layerQueue)&&n.length>0&&(n.forEach((function(e,t){r.layerNames.includes(e._name)||r.layerNames.push(e._name)})),(r.selectedLayerName="none")&&(r.selectedLayerName=r.layerNames[0],o=n[0]))}function c(){i.clear(),le("Polyline"),tooltip.setVisible(!1)}return A.isViewer&&(window.tooltip||(window.tooltip=ee(viewer._element)),(i=new Cesium.Facade(viewer.scene)).build(),l()),e.watch((function(){return A.isViewer}),(function(e){e&&(window.tooltip||(window.tooltip=ee(viewer._element)),(i=new Cesium.Facade(viewer.scene)).build(),l())})),e.watch((function(){return A.changeLayers}),(function(e){l()})),e.onBeforeUnmount((function(){c(),i.destroy()})),e.watch((function(){return r.maxDistance}),(function(e){i.farDistance=Number(e)})),e.watch((function(){return r.maxHeight}),(function(e){i.maxHeight=Number(e)})),e.watch((function(){return r.selectedLayerName}),(function(e){var t=r.layerNames.indexOf(e);-1!=t&&(o=n[t])})),e.watch((function(){return r.lodrange}),(function(e){o&&o.setLodRangeScale(Number(e))})),e.watch((function(){return r.setLodrange}),(function(e){o&&(e?o.setLodRangeScale(Number(r.lodrange)):o.setLodRangeScale(1))})),s(s({},e.toRefs(r)),{},{setRegion:function(){tooltip.showAt(" <p>点击鼠标左键开始绘制起点</p><p>绘制两点确定区域宽度</p> <p>单击右键结束分析</p><p>设置模型精细度调整图片清晰度</p>","350px"),window.handlerPolyline||ae("Polyline"),se("Polyline").then((function(e){var t=e.result.object.positions[0],n=e.result.object.positions[1];i.startPoint=t,i.endPoint=n;var o=window.handlerPolyline;o.polyline.show=!1,window.polylineTransparent.show=!1,o.deactivate(),tooltip.setVisible(!1)}),(function(e){console.log(e)})),window.handlerPolyline.activate()},execute:function(){i.readyPromise.then((function(e){!function(e){var t=new Image;t.src=e,t.onload=function(){var e=function(e){var t=document.createElement("canvas");return t.width=e.width,t.height=e.height,t.getContext("2d").drawImage(e,0,0),t}(t).toDataURL("image/jpeg"),i=document.createElement("a"),n=new MouseEvent("click");i.download=(new Date).getTime()+".jpg",i.href=e,i.dispatchEvent(n)}}(e)}))},clear:c})},compass:function(t){var i,n,o=e.reactive({resetPosition:"",isfull:!1});if(o.resetPosition=new Cesium.Cartesian3.fromDegrees(110.60396458865515,34.54408834959379,30644793.325518917),t)for(var r in t)o.hasOwnProperty(r)?o[r]=t[r]:g.Message.errorMsg(re.AttributeError+r);o.isfull&&p();var a,l,c=e.ref(null),u=!1;function d(){(n=new Cesium.Cartesian2).x=i.canvas.clientWidth/2,n.y=i.canvas.clientHeight/2,i.postRender.addEventListener(m),window.addEventListener("resize",(function(){n.x=i.canvas.clientWidth/2,n.y=i.canvas.clientHeight/2}))}function m(){var e=i.camera.heading,t="rotate("+-Cesium.Math.toDegrees(e)+"deg)";c.value.style.transform=t,u&&(e<=.05||e>=6.23)&&(i.camera.stopFlyCircle(),e=0,u=!1)}function f(){var e=i.pickPosition(n),t=viewer.camera.position,o=Cesium.Cartesian3.distance(e,t);return o>=1e3?o/30:o>=20?o/20:o>0?.5:0}function p(){var e;document.fullscreenElement?(o.isfull=!1,document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()):(o.isfull=!0,(e=document.documentElement).requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.msRequestFullscreen?e.msRequestFullscreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen())}return A.isViewer&&(i=viewer.scene,d()),e.watch((function(){return A.isViewer}),(function(e){e&&(i=viewer.scene,d())})),e.onBeforeUnmount((function(){i.postRender.removeEventListener(m)})),s(s({},e.toRefs(o)),{},{compass_dom:c,reduceCompass:function(){var e=i.camera.heading,t=8;if(!(e<=.05||e>=6.23)){(e<=.5||e>=5.8)&&(t=2),u=!0;var o=i.pickPosition(n);if(i.camera.heading-Cesium.Math.PI>=0)return i.camera.speedRatio=t,void i.camera.flyCircle(o);i.camera.speedRatio=-t,i.camera.flyCircle(o)}},reset:function(){viewer.camera.flyTo({destination:o.resetPosition})},fullscreenchange:p,zoomIn:function(){var e=10;clearInterval(a),a=setInterval((function(){e=f(),viewer.camera.zoomIn(e)}),30)},mouseup_zoomIn:function(){clearInterval(a)},zoomOut:function(){var e=10;clearInterval(l),l=setInterval((function(){e=f(),viewer.camera.zoomOut(e)}),30)},mouseup_zoomOut:function(){clearInterval(l)}})},flyRoute:function(t){var i,n,o=e.reactive({routeType:"designatedRoute",fileSrc:"",fpfUrl:null,selectedStopIndex:0,showRoute:!1,showStop:!1,currentStopNames:[],customRouteNames:[],customRouteSelectedIndex:null,routeStops:[],selectedAddedStopIndex:null,setStopName:"Stop-1",setStopSpeed:0,stopPlayMode:"StopPause",waitTime:0,surroundDuration:1,isAlongline:!1,routeSpeed:200});if(t)for(var r in t)o.hasOwnProperty(r)?o[r]=t[r]:g.Message.errorMsg(re.AttributeError+r);var a,l,c=e.ref(null),u=new FileReader,d=[];function m(){n=new Cesium.RouteCollection(viewer.entities),i=new Cesium.FlyManager({scene:viewer.scene,routes:n}),l=new he,o.fpfUrl&&f()}function f(){i.stop(),n.fromFile(o.fpfUrl),i.readyPromise.then((function(){var e=i.currentRoute;e.isLineVisible=o.showRoute,e.isStopVisible=o.showStop,w()}))}function p(){n.readyPromise.then((function(){i.routes=n;var e=i.currentRoute;e.isLineVisible=o.showRoute,e.isStopVisible=o.showStop,w()}))}function w(){o.currentStopNames.length=0;for(var e=0,t=(a=i.getAllRouteStops()).length;e<t;e++){var n=a[e].stopName||"Stop"+(e+1);o.currentStopNames.push(n)}}return A.isViewer&&(window.tooltip||(window.tooltip=ee(viewer._element)),m()),e.watch((function(){return A.isViewer}),(function(e){e&&(window.tooltip||(window.tooltip=ee(viewer._element)),m())})),e.onMounted((function(){c.value.addEventListener("change",(function(e){i.stop();var t=i.currentRoute;t&&t.clear(),n=new Cesium.RouteCollection(viewer.entities);var r=e.target.files[0];r&&(o.fileSrc=c.value.value,u.onload=function(e){var t=e.target.result;n.fromXML(t)},u.readAsBinaryString(r),p())}))})),e.watch((function(){return o.selectedStopIndex}),(function(e){i&&i.stop();var t=Number(e),n=a[t];i.viewToStop(n)})),e.watch((function(){return o.showRoute}),(function(e){var t=i.currentRoute;t&&(t.isLineVisible=e)})),e.watch((function(){return o.showStop}),(function(e){var t=i.currentRoute;t&&(t.isStopVisible=e)})),e.watch((function(){return o.fpfUrl}),(function(e){f()})),e.watch((function(){return o.customRouteSelectedIndex}),(function(e){if(null!==e){i&&i.stop();var t=i.currentRoute;t&&t.clear(),(n=new Cesium.RouteCollection(viewer.entities)).fromXML(d[e]),p()}})),e.watch((function(){return o.selectedAddedStopIndex}),(function(e){var t=o.routeStops[e];t&&viewer.camera.setView({destination:Cesium.Cartesian3.fromDegrees(t.point[0],t.point[1],t.point[2]),orientation:{heading:t.heading,pitch:t.tilt,roll:0}})})),e.watch((function(){return o.routeType}),(function(e){"customRoute"===e?(window.tooltip.showAt(" <p>调整当前相机位置和视角</p><p>以当前相机位置和视角设置站点</p><p>点击添加保存此站点</p>","50%"),setTimeout((function(){window.tooltip.setVisible(!1)}),5e3)):window.tooltip.setVisible(!1)})),e.onBeforeUnmount((function(){o=null,i=n=null,a=null,l=d=null})),s(s({},e.toRefs(o)),{},{flyFile_dom:c,chooseFile:function(){c.value.click()},flyStart:function(){i.readyPromise.then((function(){i.play()}))},flyPause:function(){i&&i.pause()},flyStop:function(){i&&i.stop()},addStop:function(){i.stop();var e=viewer.camera.position,t=g.CartesiantoDegrees(e),n={stopName:o.setStopName,point:t,heading:viewer.camera.heading,tilt:viewer.camera.pitch,speed:o.setStopSpeed,stopPlayMode:o.stopPlayMode,surroundDuration:o.surroundDuration,waitTime:o.waitTime};if(o.routeStops.push(n),o.routeStops.length>0){var r=o.routeStops.length,a=o.routeStops[r-1].stopName.split("-")[1]||1,s="Stop-"+(Number(a)+1);o.setStopName=s}o.selectedAddedStopIndex=o.routeStops.length-1},saveStop:function(){if(o.routeStops.length<2)g.Message.warnMsg("节点小于2");else{var e={routeName:"飞行路线_"+(d.length+1),speed:o.routeSpeed,isAlongLine:"False",routeStops:o.routeStops},t=l.createXMLflyLine(e);d.push(t),o.customRouteNames.push(e.routeName),null===o.customRouteSelectedIndex&&(o.customRouteSelectedIndex=0)}},restStops:function(){o.routeStops.length=0,o.setStopName="Stop-1",o.setStopSpeed=0,o.stopPlayMode="StopPause",o.waitTime=0,o.surroundDuration=1},downLoad:function(){var e=d[o.customRouteSelectedIndex];if(e){var t=new Blob([e]),i=document.createElement("a");i.download="fly-route.fpf",i.href=URL.createObjectURL(t),i.click()}},clearRoute:function(){if(i.stop(),!(d.length<1))if(d.splice(o.customRouteSelectedIndex,1),o.customRouteNames.splice(o.customRouteSelectedIndex,1),d.length>0)o.customRouteSelectedIndex=0;else{o.customRouteSelectedIndex=null,o.currentStopNames.length=0;var e=i.currentRoute;e&&e.clear()}},clearStop:function(){o.routeStops.splice(o.selectedAddedStopIndex,1),o.routeStops.length>0?o.selectedAddedStopIndex=o.routeStops.length-1:(o.selectedAddedStopIndex=null,o.setStopName="Stop-1")}})},drawLineSrface:function(t){var i=e.reactive({drawModle:"space",currentId:"1",config:ve,lineColor:"rgba(250, 196, 65, 1)",lineWidth:5,dottedColor:"rgba(250, 196, 65, 0)",dottedLength:30,outLineColor:"rgba(29, 206, 200, 1)",outLineWidth:2,glowStrength:.5,trailPercentage:.3,trailPeroid:2,isEdit:!0,isEditZ:!1,drawType:"polyline",solidColor:"rgba(250, 196, 65, 1)",gridColor:"rgba(250, 196, 65, 1)",gridWidth:1,gridCount:8,gridCellAlpha:.1,stripeEvenColor:"#FFFFFF",stripeOddColor:"#000000",stripeRepeat:12,stripeOffset:0,stripeOrientation:"horizontal"});if(t)for(var n in t)i.hasOwnProperty(n)?i[n]=t[n]:g.Message.errorMsg(re.AttributeError+n);var o=void 0,r=void 0,a=!0,l=(Cesium.ClassificationType.TERRAIN,void 0),c=void 0,u=void 0;function d(){window.handlerPolyline||ae("Polyline"),window.tooltip.showAt(" <p>点击鼠标左键开始绘制</p><p>右键单击结束分析</p><p>选中对象进行编辑或清除</p>","50%"),se("Polyline").then((function(e){!function(e){var t,n=Cesium.Color.fromCssColorString(i.lineColor),a=Number(i.lineWidth);switch(i.currentId){case"1":t=n;break;case"2":var s=Cesium.Color.fromCssColorString(i.dottedColor),c=Number(i.dottedLength);t=new Cesium.PolylineDashMaterialProperty({color:n,gapColor:s,dashLength:c});break;case"3":var d=Cesium.Color.fromCssColorString(i.outLineColor),m=Number(i.outLineWidth);t=new Cesium.PolylineOutlineMaterialProperty({color:n,outlineWidth:m,outlineColor:d});break;case"4":t=new Cesium.PolylineArrowMaterialProperty(n);break;case"5":var f=Number(i.glowStrength);t=new Cesium.PolylineGlowMaterialProperty({glowPower:f,color:n});break;case"6":var p=Number(i.trailPercentage);t=new Cesium.PolylineTrailMaterialProperty({color:n,trailLength:p,period:i.trailPeroid});break;default:t=n}l=viewer.entities.add({id:"polyline-symbol-line-"+(new Date).getTime(),polyline:{positions:e,width:a,material:t,clampToGround:o,classificationType:r,height:u}})}(e.result.object.positions);var t=window.handlerPolyline;t.polyline.show=!1,window.polylineTransparent.show=!1,t.deactivate(),tooltip.setVisible(!1)}),(function(e){console.log(e)})),window.handlerPolyline.activate()}function m(e){var t=viewer.scene.pick(e.message.position);t&&t.id&&t.id.id&&"string"==typeof t.id.id&&(-1!=t.id.id.indexOf("polyline-symbol-line")&&(l=t.id),-1!=t.id.id.indexOf("polygon-symbol-gon")&&(c=t.id))}function f(e,t,i){o=e,r=t,u=i,l&&(l.polyline.clampToGround=o,l.polyline.classificationType=r,l.polyline.height=i)}function p(e,t,i){a=e,r=t,u=i,c&&(c.polygon.perPositionHeight=a,c.classificationType=r,c.polygon.height=i)}return A.isViewer&&(window.tooltip||(window.tooltip=ee(viewer._element)),viewer.eventManager.addEventListener("CLICK",m,!1),fe()),e.watch((function(){return A.isViewer}),(function(e){e&&(window.tooltip||(window.tooltip=ee(viewer._element)),viewer.eventManager.addEventListener("CLICK",m,!1),fe())})),e.onBeforeUnmount((function(){viewer&&viewer.eventManager.removeEventListener("CLICK",m)})),e.watch((function(){return i.drawModle}),(function(e){var t="polyline"===i.drawType;switch(e){case"space":t?f(void 0,void 0,void 0):p(!0,void 0,void 0);break;case"stick":t?f(!0,Cesium.ClassificationType.TERRAIN,0):p(!1,Cesium.ClassificationType.TERRAIN,0);break;case"postObject":t?f(!0,Cesium.ClassificationType.S3M_TILE,void 0):p(!1,Cesium.ClassificationType.S3M_TILE,void 0);break;default:f(void 0,void 0,void 0),p(!0,!1,void 0)}})),e.watch((function(){return i.lineColor}),(function(e){var t=Cesium.Color.fromCssColorString(e);l&&(l.polyline.material.color=t)})),e.watch((function(){return i.lineWidth}),(function(e){l&&(l.polyline.width=Number(e))})),e.watch((function(){return i.dottedColor}),(function(e){var t=Cesium.Color.fromCssColorString(e);l&&(l.polyline.material.gapColor=t)})),e.watch((function(){return i.dottedLength}),(function(e){l&&(l.polyline.material.dashLength=Number(e))})),e.watch((function(){return i.outLineColor}),(function(e){var t=Cesium.Color.fromCssColorString(e);l&&(l.polyline.material.outlineColor=t)})),e.watch((function(){return i.outLineWidth}),(function(e){l&&(l.polyline.material.outlineWidth=Number(e))})),e.watch((function(){return i.glowStrength}),(function(e){l&&(l.polyline.material.glowPower=Number(e))})),e.watch((function(){return i.trailPercentage}),(function(e){l&&(l.polyline.material.trailLength=Number(e))})),e.watch((function(){return i.isEdit}),(function(e){l&&(e?fe():pe())})),e.watch((function(){return i.isEditZ}),(function(e){l&&window.editHandler&&(window.editHandler.isEditZ=e)})),e.watch((function(){return i.drawType}),(function(e){i.currentId="1"})),e.watch((function(){return i.solidColor}),(function(e){var t=Cesium.Color.fromCssColorString(e);c&&(c.polygon.material=t)})),e.watch((function(){return i.gridColor}),(function(e){var t=Cesium.Color.fromCssColorString(e);c&&(c.polygon.material.color=t)})),e.watch((function(){return i.gridWidth}),(function(e){c&&(c.polygon.material.lineThickness=new Cesium.Cartesian2(Number(e),Number(e)))})),e.watch((function(){return i.gridCount}),(function(e){c&&(c.polygon.material.lineCount=new Cesium.Cartesian2(Number(e),Number(e)))})),e.watch((function(){return i.gridCellAlpha}),(function(e){c&&(c.polygon.material.cellAlpha=Number(e))})),e.watch((function(){return i.stripeEvenColor}),(function(e){var t=Cesium.Color.fromCssColorString(e);c&&(c.polygon.material.evenColor=t)})),e.watch((function(){return i.stripeOddColor}),(function(e){var t=Cesium.Color.fromCssColorString(e);c&&(c.polygon.material.oddColor=t)})),e.watch((function(){return i.stripeRepeat}),(function(e){c&&(c.polygon.material.repeat=Number(e))})),e.watch((function(){return i.stripeOffset}),(function(e){c&&(c.polygon.material.offset=Number(e))})),e.watch((function(){return i.stripeOrientation}),(function(e){if(c){var t="horizontal"===e?0:1;c.polygon.material.orientation=t}})),s(s({},e.toRefs(i)),{},{draw:function(){"polyline"===i.drawType?d():function(){window.handlerPolygon||ae("Polygon");se("Polygon",!1).then((function(e){var t=window.handlerPolygon;!function(e){var t;switch(i.currentId){case"1":t=Cesium.Color.fromCssColorString(i.solidColor);break;case"2":var n=Cesium.Color.fromCssColorString(i.gridColor),o=Number(i.gridWidth),s=Number(i.gridCount),l=Number(i.gridCellAlpha);t=new Cesium.GridMaterialProperty({color:n,cellAlpha:l,lineCount:new Cesium.Cartesian2(s,s),lineThickness:new Cesium.Cartesian2(o,o)});break;case"3":var d=Cesium.Color.fromCssColorString(i.stripeEvenColor),m=Cesium.Color.fromCssColorString(i.stripeOddColor),f=Number(i.stripeRepeat),p=Number(i.stripeOffset);t=new Cesium.StripeMaterialProperty({evenColor:d,oddColor:m,repeat:f,offset:p,orientation:"horizontal"===i.stripeOrientation?0:1})}c=viewer.entities.add({id:"polygon-symbol-gon-"+(new Date).getTime(),polygon:{hierarchy:{positions:e},material:t,perPositionHeight:a,groundBottomAltitude:0,groundExtrudedHeight:100},classificationType:r,height:u})}(e.result.object.positions),t.polygon.show=!1,t.polyline.show=!1,t.deactivate()}),(function(e){console.log(e)})),window.handlerPolygon.activate()}()},changeSelect:function(e){i.currentId=e},clear:function(){l&&"polyline"===i.drawType&&viewer.entities.removeById(l.id),c&&"polygon"===i.drawType&&viewer.entities.removeById(c.id),window.tooltip.setVisible(!1),le("Polyline"),le("Polygon"),window.editHandler&&window.editHandler.clear()}})},symbol:function(t){var i=e.reactive({selectedTypeId:0,selectedSymbolId:0,symbolColor:"#ffffff",space:10,density:100,addType:"single"});if(t)for(var n in t)i.hasOwnProperty(n)?i[n]=t[n]:g.Message.errorMsg(re.AttributeError+n);var o,r,a,l=ye[i.selectedTypeId].data,c=null,u=!1,d=[],m=!1,f=!0;function p(e){if(!u){if(m){tooltip.setVisible(!1),viewer.enableCursorStyle=!0,document.body.classList.remove("measureCur");var t=scene.pickPosition(e.message.position),n=Cesium.Color.fromCssColorString(i.symbolColor),a="symbol-"+ye[i.selectedTypeId].id+"-"+l[i.selectedSymbolId].id+"-"+(new Date).getTime(),s=l[i.selectedSymbolId].path;return o.add(s,{id:a,position:t,color:n}),d.includes(s)||d.push(s),void(m=!1)}var f=viewer.scene.pick(e.message.position)||viewer.selectedEntity;if(f&&f.id&&"string"==typeof f.id&&-1!=f.id.indexOf("symbol-")){if(c&&c.id===f.id)return;return r&&r.destroy(),c=f,void(r=new Cesium.ModelEditor({model:c.primitive,scene:viewer.scene})).activate()}r&&r.destroy(),r=null,c=null}}function w(){viewer.enableCursorStyle=!1,viewer._element.style.cursor="",document.body.classList.add("measureCur"),m=!0}function h(){u=!0,window.handlerPolyline||ae("Polyline"),se("Polyline").then((function(e){!function(e,t){for(var n=[],r=1,a=t._positions.length;r<a;r++)for(var s=t._positions[r-1],c=t._positions[r],m=Cesium.Cartesian3.distance(s,c),f=v(parseInt(m)),p=1,w=f;p<=w;p++)n.push(Cesium.Cartesian3.lerp(s,c,p/f,new Cesium.Cartesian3));viewer.scene.clampToHeightMostDetailed(n).then((function(e){u=!1;var t=Cesium.Color.fromCssColorString(i.symbolColor),n="symbol-"+ye[i.selectedTypeId].id+"-"+l[i.selectedSymbolId].id+"-",r=l[i.selectedSymbolId].path;d.includes(r)||d.push(r);for(var a=0,s=e.length;a<=s;a++)o.add(r,{id:n+(new Date).getTime()+a,position:e[a],color:t})}))}(0,e.result.object);var t=window.handlerPolyline;t.polyline.show=!1,window.polylineTransparent.show=!1,t.deactivate(),tooltip.setVisible(!1)}),(function(e){console.log(e)})),window.handlerPolyline.activate()}function v(e){var t=Number(i.space);return parseInt(e/t)+1}return A.isViewer&&(window.tooltip||(window.tooltip=ee(viewer._element)),o=new Cesium.S3MInstanceCollection(scene._context),viewer.scene.primitives.add(o),a=new ge),e.watch((function(){return A.isViewer}),(function(e){e&&(window.tooltip||(window.tooltip=ee(viewer._element)),o=new Cesium.S3MInstanceCollection(scene._context),viewer.scene.primitives.add(o),a=new ge)})),e.onBeforeUnmount((function(){l.length=0,o=null,c=null,r&&r.destroy(),d.length=0})),e.watch((function(){return i.selectedTypeId}),(function(e){l=ye[i.selectedTypeId].data})),e.watch((function(){return i.symbolColor}),(function(e){var t=Cesium.Color.fromCssColorString(e);if(c){var i=c.primitive,n=c.id;i.updateColor(t,n)}})),s(s({},e.toRefs(i)),{},{s3mModels:ye,changeSelect:function(e){i.selectedSymbolId=e},clear:function(){if(c){var e=c.id,t=e.split("-"),i=ye[t[1]].data[t[2]].path;i&&(o.removeInstance(i,e),c=null)}else d.forEach((function(e){o.removeCollection(e)})),d.length=0;0===d.length&&viewer.eventManager.removeEventListener("CLICK",p),r&&r.destroy(),r=null,window.tooltip.setVisible(!1),le("Polyline"),le("Polygon"),m=!1,viewer.enableCursorStyle=!0,document.body.classList.remove("measureCur")},statrtAdd:function(){switch(f&&(window.tooltip.showAt("<p>选中模型可以编辑和清除选中模型</p><p>未选中模型时清除所有</p>","420px"),f=!1),viewer.eventManager.addEventListener("CLICK",p,!0),i.addType){case"single":w();break;case"line":h();break;case"face":u=!0,window.handlerPolygon||ae("Polygon"),se("Polygon",!1).then((function(e){tooltip.setVisible(!1);var t=window.handlerPolygon;t.polygon.show=!1,t.polyline.show=!1,t.deactivate(),a.initPolygonEmitter(e.result.object.positions);var n=Cesium.Color.fromCssColorString(i.symbolColor),r="symbol-"+ye[i.selectedTypeId].id+"-"+l[i.selectedSymbolId].id+"-",s=l[i.selectedSymbolId].path;d.includes(s)||d.push(s);for(var c=Number(i.density),m=0;m<c;m++){var f=a.getOneRandomPosition();o.add(s,{id:r+(new Date).getTime()+m,position:f,color:n})}u=!1}),(function(e){console.log(e)})),window.handlerPolygon.activate();break;default:w()}}})},light:function(t){var i,n,o,r=e.reactive({lightSelectId:0,lightColor:"#FFFFFF",cutoffDistance:200,lightDecay:5,lightIntensity:5,spotLightAngle:30,visibleModel:!0,dockFontShow:!0,modelPosition:[0,0,0],modelLongitude:"",modelLatitude:"",modelHeight:"",bubbleShow:!1,visiblePositions:!1});if(t)for(var a in t)r.hasOwnProperty(a)?r[a]=t[a]:g.Message.errorMsg(re.AttributeError+a);var l,c=!1,u=new Map,d="public/data/s3m/light.s3m",m=e.ref(null);function f(e,t){var n="light-model-"+(new Date).getTime();o.add(d,{id:n,position:e,scale:new Cesium.Cartesian3(2,2,2)}),i=o.getInstance(d,n),u.set(n,t)}A.isViewer&&(window.tooltip||(window.tooltip=ee(viewer._element)),o=new Cesium.S3MInstanceCollection(scene._context),viewer.scene.primitives.add(o)),e.watch((function(){return A.isViewer}),(function(e){e&&(window.tooltip||(window.tooltip=ee(viewer._element)),o=new Cesium.S3MInstanceCollection(scene._context),viewer.scene.primitives.add(o))}));var p,w=!1;function h(){window.handlerPolyline||ae("Polyline"),se("Polyline").then((function(e){var t,i,o,a,s;1===r.lightSelectId?(t=e.result.object.positions,i=y(t[0]),o=t[1],a={color:Cesium.Color.fromCssColorString(r.lightColor),distance:Number(r.cutoffDistance),decay:Number(r.lightDecay),intensity:Number(r.lightIntensity),angle:Cesium.Math.toRadians(Number(r.spotLightAngle))},s=new Cesium.SpotLight(i,o,a),n=s,viewer.scene.addLightSource(s),f(i,s)):function(e){var t=y(e[0]),i={targetPosition:e[1],color:Cesium.Color.fromCssColorString(r.lightColor),intensity:Number(r.lightIntensity)},o=new Cesium.DirectionalLight(t,i);n=o,viewer.scene.addLightSource(o),f(t,o)}(e.result.object.positions);var l=window.handlerPolyline;l.polyline.show=!1,window.polylineTransparent.show=!1,l.deactivate(),tooltip.setVisible(!1)}),(function(e){console.log(e)})),window.handlerPolyline.activate()}function v(e){if(c){c=!1,viewer.enableCursorStyle=!0,document.body.classList.remove("measureCur"),!function(e){var t=y(e),i={color:Cesium.Color.fromCssColorString(r.lightColor),cutoffDistance:Number(r.cutoffDistance),decay:Number(r.lightDecay),intensity:Number(r.lightIntensity)},o=new Cesium.PointLight(t,i);n=o,viewer.scene.addLightSource(o),f(t,o)}(scene.pickPosition(e.message.position)),tooltip.setVisible(!1)}else{var t=viewer.scene.pick(e.message.position)||viewer.selectedEntity;if(t&&t.id&&"string"==typeof t.id&&-1!=t.id.indexOf("light-model-")){var o;if(i&&i.id===t.id.id)return;i=t,n=u.get(t.id),l?l.setEditObject(t.primitive):(s=t.primitive,(l=new Cesium.ModelEditor({model:s,scene:viewer.scene,axesShow:{translation:!0,rotation:!1,scale:!0}})).activate(),l.changedEvt.addEventListener((function(e){var t=new Cesium.Cartesian3;if(Cesium.Matrix4.getTranslation(e.modelMatrix,t),t){var i;n.position=t,w=!0,b((function(){return w=!1}));var o=g.CartesiantoDegrees(t);r.modelPosition.length=0,(i=r.modelPosition).push.apply(i,[o[0].toFixed(6),o[1].toFixed(6),o[2].toFixed(2)])}}))),m.value.style.top=e.message.position.y-160+"px",m.value.style.left=e.message.position.x+"px",console.log(l);var a=g.CartesiantoDegrees(l._position);return r.modelPosition.length=0,(o=r.modelPosition).push.apply(o,[a[0].toFixed(6),a[1].toFixed(6),a[2].toFixed(2)]),void(r.bubbleShow=!0)}i=void 0,n=void 0,l&&l.deactivate(),r.bubbleShow=!1}var s}function y(e){var t=Cesium.Cartographic.fromCartesian(e);return t.height+=.5,Cesium.Cartographic.toCartesian(t)}function C(){r.bubbleShow=!1}function b(e){p&&clearTimeout(p),p=setTimeout((function(){e()}),1e3)}return e.watch((function(){return r.lightColor}),(function(e){if(n){var t=Cesium.Color.fromCssColorString(e);n.color=t}})),e.watch((function(){return r.cutoffDistance}),(function(e){n&&(1!==n.lightType?2!==n.lightType||(n.distance=Number(e)):n.cutoffDistance=Number(e))})),e.watch((function(){return r.lightDecay}),(function(e){n&&0!==n.lightType&&(n.decay=Number(e))})),e.watch((function(){return r.lightIntensity}),(function(e){n&&(n.intensity=Number(e))})),e.watch((function(){return r.spotLightAngle}),(function(e){n&&2===n.lightType&&(n.angle=Cesium.Math.toRadians(Number(e)))})),e.watch((function(){return r.visibleModel}),(function(e){i&&(l&&l.deactivate(),o.visible=e)})),e.watch((function(){return r.modelPosition}),(function(e){i&&!w&&b((function(){var t=Number(e[0]),o=Number(e[1]),r=Number(e[2]),a=Cesium.Cartesian3.fromDegrees(t,o,r);n.position=a,i.primitive.updatePosition(a),l&&l.setEditObject(i.primitive)}))}),{deep:!0}),e.onBeforeUnmount((function(){})),s(s({},e.toRefs(r)),{},{config:Ce,addLight:function(){var e=0===r.lightSelectId?"<p>点击确认点光源位置</p><p>选中光源模型可编辑与删除</p>":"<p>点击第一点确认光源位置</p><p>第二点确认光源方向</p><p>选中光源模型可编辑与删除</p>";if(window.tooltip.showAt(e,"400px"),viewer.eventManager.addEventListener("CLICK",v,!0),0===r.lightSelectId)return viewer.enableCursorStyle=!1,viewer._element.style.cursor="",document.body.classList.add("measureCur"),void(c=!0);h()},clearLight:function(){i&&(u.delete(i.id),o.removeInstance(d,i.id),i=null),n&&viewer.scene.removeLightSource(n),0===u.size&&viewer.eventManager.removeEventListener("CLICK",v),l&&l.deactivate(),c=!1,n=null,le(),viewer.enableCursorStyle=!0,document.body.classList.remove("measureCur"),tooltip.setVisible(!1),C()},bubble:m,closeBubble:C,dockBubble:function(e){e?(m.value.classList.add("bubbleDock"),r.dockFontShow=!1):(m.value.classList.remove("bubbleDock"),r.dockFontShow=!0)}})},projection:function(t){var i,n,o,r=e.reactive({viewlongitude:"",viewlatitude:"",viewheight:"",direction:"",pitch:"",horizontal:20,vertical:10,distance:200,hintLineColor:"rgba(251,250,248,1)",clipMode:"clip-inside",visibleLine:!0,fileText:"",fromInfo:null});if(t)for(var a in t)r.hasOwnProperty(a)?r[a]=t[a]:g.Message.errorMsg(re.AttributeError+a);var l,c,u,d=e.ref(null),m=new Map,f="public/data/s3m/projector.s3m",p=!1,w=null,h=new FileReader,v=!1;function y(e,t){return new Promise((function(i,n){var o=document.getElementById("videoContain"),r=document.createElement("video"),a=document.createElement("source");a.src=e,r.appendChild(a),r.id="trailer-"+t,r.classList.add("videoBox"),r.setAttribute("autoplay","autoplay"),r.setAttribute("loop","loop"),r.setAttribute("crossorigin","crossorigin"),r.setAttribute("controls","controls"),r.setAttribute("muted","muted"),o.appendChild(r),setTimeout((function(){i(r)}),500)}))}function C(e){if(!v){if(p){viewer.enableCursorStyle=!0,document.body.classList.remove("measureCur");var t=Cesium.Cartesian3.fromDegrees(o.viewPosition[0],o.viewPosition[1],o.viewPosition[2]),i=JSON.parse(JSON.stringify(t));return viewer.eventManager.removeEventListener("MOUSE_MOVE",b),n=i,a="projector-"+(new Date).getTime(),s=o.direction,u=o.pitch,d=Cesium.Math.toRadians(s),h=d>=Cesium.Math.PI?d-Cesium.Math.PI:d+Cesium.Math.PI,y=-Cesium.Math.toRadians(u),l.add(f,{id:a,position:n,hpr:{heading:h,pitch:0,roll:y}}),w=l.getInstance(f,a),m.set(a,o),void(p=!1)}var n,a,s,u,d,h,y,g=viewer.scene.pick(e.message.position)||viewer.selectedEntity;if(g&&g.id&&"string"==typeof g.id&&-1!=g.id.indexOf("projector-"))return c&&c.destroy(),w=g,void((o=m.get(g.id))&&(r.horizontal=o.horizontalFov,r.vertical=o.verticalFov,r.distance=o.distance));w=null,o=null}}function b(e){var t=0,i=viewer.scene.camera.position,r=n.pickPosition(e.message.endPosition);r&&(t=Cesium.Cartesian3.distance(i,r)),t>0&&t<1e3&&o.setDistDirByPoint(g.CartesiantoDegrees(r))}return A.isViewer&&(window.tooltip||(window.tooltip=ee(viewer._element)),n=viewer.scene,i=viewer.scene.layers.layerQueue,l=new Cesium.S3MInstanceCollection(n._context),viewer.scene.primitives.add(l),viewer.eventManager.addEventListener("CLICK",C,!0)),e.watch((function(){return A.isViewer}),(function(e){e&&(window.tooltip||(window.tooltip=ee(viewer._element)),n=viewer.scene,i=viewer.scene.layers.layerQueue,l=new Cesium.S3MInstanceCollection(n._context),viewer.scene.primitives.add(l))})),e.watch((function(){return A.changeLayers}),(function(e){for(var t=0;t<i.length;t++)i[t].selectEnabled=!1})),e.onMounted((function(){d.value.addEventListener("change",(function(e){var t=e.target.files[0];if(t){r.fileText=d.value.value;var i=new Blob([t],{type:"video/mp4"});h.readAsDataURL(i),h.onload=function(e){var t=e.target.result,i=document.querySelectorAll("#videoContain>video").length;y(t,i).then((function(e){u=document.getElementById("trailer-"+i)}))}}})),u=document.getElementById("trailer-0")})),e.watch((function(){return r.fileText}),(function(e){if(-1!==e.indexOf("http")){var t=document.querySelectorAll("#videoContain>video").length;y(e,t).then((function(e){u=document.getElementById("trailer-"+t)}))}})),e.watch((function(){return r.horizontal}),(function(e){""!=e&&o&&(o.horizontalFov=Number(e))})),e.watch((function(){return r.vertical}),(function(e){""!=e&&o&&(o.verticalFov=Number(e))})),e.watch((function(){return r.distance}),(function(e){""!=e&&o&&(o.distance=Number(e))})),e.watch((function(){return r.visibleLine}),(function(e){o&&(l.visible=e,m.forEach((function(t){t.hintLineVisible=e})))})),e.watch((function(){return r.hintLineColor}),(function(e){o&&(o.hintLineColor=Cesium.Color.fromCssColorString(e))})),e.watch((function(){return r.clipMode}),(function(e){if(o){var t="clip-outside"===e?Cesium.ModifyRegionMode.CLIP_INSIDE:Cesium.ModifyRegionMode.CLIP_OUTSIDE;o.setClipMode(t)}})),e.watch((function(){return r.viewlongitude}),(function(e){o&&""!=e&&(o.viewPosition[0]=e)})),e.watch((function(){return r.viewlatitude}),(function(e){o&&""!=e&&(o.viewPosition[1]=e)})),e.watch((function(){return r.viewheight}),(function(e){o&&""!=e&&(o.viewPosition[2]=e)})),e.watch((function(){return r.direction}),(function(e){o&&""!=e&&(o.direction=Number(e))})),e.watch((function(){return r.pitch}),(function(e){o&&""!=e&&(o.pitch=Number(e))})),e.watch((function(){return r.fromInfo}),(function(e){e&&""!=e&&Cesium.ProjectionImage.fromInfo(n,r.fromInfo.infoUrl,r.fromInfo.baseUrl)})),e.onBeforeUnmount((function(){for(var e=0;e<i.length;e++)i[e].selectEnabled=!0})),s(s({},e.toRefs(r)),{},{chooseFile:function(){d.value.click()},vedioFile_dom:d,startProjection:function(){viewer.enableCursorStyle=!1,viewer._element.style.cursor="",document.body.classList.add("measureCur");var e=viewer.scene.camera.position;u.play(),(o=new Cesium.ProjectionImage(n)).setImage({video:u}),o.distance=Number(r.distance),o.horizontalFov=Number(r.horizontal),o.verticalFov=Number(r.vertical),o.viewPosition=g.CartesiantoDegrees(e),o.build(),p=!0,window.tooltip.showAt(" <p>选中投放模型进行编辑和清除</p>","400px"),viewer.eventManager.addEventListener("MOUSE_MOVE",b),viewer.eventManager.addEventListener("CLICK",C,!0)},clear:function(){viewer.eventManager.removeEventListener("MOUSE_MOVE",b),w&&(m.delete(w.id),l.removeInstance(f,w.id),w=null),o&&(o.removeAllClipRegion(),o.destroy()),0===m.size&&viewer.eventManager.removeEventListener("CLICK",C),c&&c.destroy(),c=null,o=null,window.tooltip.setVisible(!1),le(),viewer.enableCursorStyle=!0,document.body.classList.remove("measureCur")},clipProjectImg:function(){v=!0,tooltip.setVisible(!1),window.tooltip.showAt(" <p>点击鼠标左键绘制裁剪区域</p><p>点击鼠标右键结束绘制</p><p>注：只能裁剪当前选中投放对象</p>","400px"),window.handlerPolygon||ae("Polygon"),se("Polygon").then((function(e){v=!1;var t=window.handlerPolygon;!function(e){if(!o)return;o.addClipRegion({name:"clip-Projector"+(new Date).getTime(),position:e})}(e.positions),t.polygon.show=!1,t.polyline.show=!1,window.polylineTransparent.show=!1,t.deactivate()}),(function(e){console.log(e)})),window.handlerPolygon.activate()}})},scanEffect:function(i){var n=e.reactive({scanMode:"lineMode",scanColor:"#0F7AF4",scanTextures:[],selectedTextureIndex:0,bloomShow:!1,openHDR:!1,threshold:.01,intensity:.5,lineWidth:100,period:3,speed:100,addTextures:null,scanShow:!1});if(i)for(var o in i)n.hasOwnProperty(o)?n[o]=i[o]:g.Message.errorMsg(re.AttributeError+o);var r=[{name:"无纹理",type:"line",url:""}],a=[{name:"无纹理",type:"ring",url:""}];function l(e){for(var t=0;t<e.length;t++)"line"===e[t].type?r.push(e[t]):a.push(e[t]);n.scanTextures="lineMode"===n.scanMode?r:a}function c(){viewer.scene.scanEffect.color=Cesium.Color.fromCssColorString(n.scanColor),viewer.scene.scanEffect.textureUrl="",viewer.scene.scanEffect.lineWidth=Number(n.lineWidth),viewer.scene.scanEffect.period=Number(n.period),viewer.scene.scanEffect.speed=Number(n.speed),viewer.scene.scanEffect.centerPostion=new Cesium.Cartesian3.fromDegrees(0,0,0)}function u(){window.handlerPolyline||ae("Polyline"),window.tooltip.showAt(" <p>点击鼠标左键开始绘制</p><p>绘制两点确定扫描线方向</p><p>鼠标右键结束绘制</p>","350px"),se("Polyline").then((function(e){!function(e){var t=new Cesium.Cartesian3;if(Cesium.Cartesian3.subtract(e[1],e[0],t),n.scanShow)return viewer.scene.scanEffect.add(e[0]),void(viewer.scene.scanEffect.lineMoveDirection=t);viewer.scene.scanEffect.centerPostion=e[0],viewer.scene.scanEffect.lineMoveDirection=t,n.scanShow=!0}(e.result.object.positions);var t=window.handlerPolyline;t.polyline.show=!1,window.polylineTransparent.show=!1,t.deactivate(),tooltip.setVisible(!1)}),(function(e){console.log(e)})),window.handlerPolyline.activate()}function d(e){viewer.enableCursorStyle=!0,document.body.classList.remove("measureCur");var t=viewer.scene.pickPosition(e.message.position);n.scanShow?viewer.scene.scanEffect.add(t):(viewer.scene.scanEffect.centerPostion=t,n.scanShow=!0,viewer.eventManager.removeEventListener("CLICK",d))}return l(be),A.isViewer&&(window.tooltip||(window.tooltip=ee(viewer._element)),c()),e.watch((function(){return A.isViewer}),(function(e){e&&(window.tooltip||(window.tooltip=ee(viewer._element)),c())})),e.watch((function(){return n.scanShow}),(function(e){viewer.scene.scanEffect.show=e})),e.watch((function(){return n.scanMode}),(function(e){if("lineMode"===e)return viewer.scene.scanEffect.mode=Cesium.ScanEffectMode.LINE,void(n.scanTextures=r);viewer.scene.scanEffect.mode=Cesium.ScanEffectMode.CIRCLE,n.scanTextures=a})),e.watch((function(){return n.scanColor}),(function(e){viewer.scene.scanEffect.color=Cesium.Color.fromCssColorString(e)})),e.watch((function(){return n.selectedTextureIndex}),(function(e){viewer.scene.scanEffect.textureUrl=n.scanTextures[e].url})),e.watch((function(){return n.scanTextures}),(function(e){n.selectedTextureIndex=0})),e.watch((function(){return n.bloomShow}),(function(e){viewer.scene.bloomEffect.show=e,viewer.scene.bloomEffect.threshold=Number(n.threshold),viewer.scene.bloomEffect.bloomIntensity=Number(n.intensity)})),e.watch((function(){return n.openHDR}),(function(e){viewer.scene.hdrEnabled=e})),e.watch((function(){return n.threshold}),(function(e){viewer.scene.bloomEffect.threshold=Number(e)})),e.watch((function(){return n.intensity}),(function(e){viewer.scene.bloomEffect.bloomIntensity=Number(e)})),e.watch((function(){return n.lineWidth}),(function(e){viewer.scene.scanEffect.lineWidth=Number(e)})),e.watch((function(){return n.period}),(function(e){viewer.scene.scanEffect.period=Number(e)})),e.watch((function(){return n.speed}),(function(e){viewer.scene.scanEffect.speed=Number(e)})),e.watch((function(){return n.scanShow}),(function(e){viewer.scene.scanEffect.scanShow=e})),e.watch((function(){return n.addTextures}),(function(e){"object"===t(e)?l(e):console.log("addTextures类型不是数组！")})),e.onBeforeUnmount((function(){})),s(s({},e.toRefs(n)),{},{addScans:function(){"lineMode"!==n.scanMode?(viewer.enableCursorStyle=!1,viewer._element.style.cursor="",document.body.classList.add("measureCur"),viewer.eventManager.addEventListener("CLICK",d,!0)):u()},clear:function(){n.scanShow=!1;for(var e=viewer.scene.scanEffect.count,t=0;t<e;t++)viewer.scene.scanEffect.remove(t);viewer.eventManager.removeEventListener("CLICK",d),le("Polyline")}})},geologicalBody:function(t){var i=e.reactive({operationType:"stretch_cut",stretchHeight:1,modelUrls:null,digHeight:500,drillRadius:400,drillHeight:2e3,clipType:"drawClip",drawClipMode:"KeepInside"});if(i.modelUrls=[{id:1,model:"http://www.supermapol.com/realspace/services/data-dizhiti/rest/data/datasources/%E5%9C%B0%E8%B4%A8%E4%BD%93/datasets/Layer1/features/1.stream",color:new Cesium.Color(179/255,179/255,179/255,1)},{id:2,model:"http://www.supermapol.com/realspace/services/data-dizhiti/rest/data/datasources/%E5%9C%B0%E8%B4%A8%E4%BD%93/datasets/Layer2/features/1.stream",color:new Cesium.Color(94/255,179/255,59/255,1)},{id:3,model:"http://www.supermapol.com/realspace/services/data-dizhiti/rest/data/datasources/%E5%9C%B0%E8%B4%A8%E4%BD%93/datasets/Layer3/features/1.stream",color:new Cesium.Color(52/255,94/255,35/255,1)},{id:4,model:"http://www.supermapol.com/realspace/services/data-dizhiti/rest/data/datasources/%E5%9C%B0%E8%B4%A8%E4%BD%93/datasets/Layer4/features/1.stream",color:new Cesium.Color(115/255,115/255,115/255,1)},{id:5,model:"http://www.supermapol.com/realspace/services/data-dizhiti/rest/data/datasources/%E5%9C%B0%E8%B4%A8%E4%BD%93/datasets/Layer5/features/1.stream",color:new Cesium.Color(171/255,85/255,66/255,1)},{id:6,model:"http://www.supermapol.com/realspace/services/data-dizhiti/rest/data/datasources/%E5%9C%B0%E8%B4%A8%E4%BD%93/datasets/Layer6/features/1.stream",color:new Cesium.Color(68/255,68/255,68/255,1)}],t)for(var n in t)i.hasOwnProperty(n)?i[n]=t[n]:g.Message.errorMsg(re.AttributeError+n);var o,r,a,l,c=[],u=0,d=[];function m(){(o=viewer.scene).logarithmicDepthBuffer=!0,o.camera.frustum.near=.1,o.globe.show=!1,viewer.scene.skyAtmosphere.show=!1,(r=new Cesium.SolidModelsProfile(o)).addModels(i.modelUrls),console.log(r),r.addedEvent.addEventListener((function(e){console.log(r._s3mInstanceCollection.getInstance(i.modelUrls[2].model,3))})),viewer.scene.camera.setView({destination:new Cesium.Cartesian3(-2167835.4408299956,4423497.534529096,4095839.2845661934),orientation:{heading:4.029329438295484,pitch:-.23796647219353817,roll:8.994289757424667e-10}})}function f(){tooltip.setVisible(!1),r.clearProfile(),le("Polyline"),c.forEach((function(e){viewer.entities.removeById(e)})),c.length=0}function p(){window.handlerPolygon||ae("Polygon"),se("Polygon",!1).then((function(e){var t=window.handlerPolygon;!function(e){var t=new Cesium.Point3Ds;g.CartesiantoDegreesObjs(e).forEach((function(e){var i=new Cesium.Point3D(e.longitude,e.latitude,e.height+1e3);t.add(i)}));var n=new Cesium.GeoRegion3D([t]);if("dig"===i.operationType){r.clippingType=Cesium.ClippingType.KeepOutside,n.extrudedHeight=-Number(i.digHeight);var o=new Cesium.GeoRegion3D([t]);o.isLatLon=!1,o.bottomAltitude=n.extrudedHeight,r.addProfileGeometry(o)}else n.extrudedHeight=-7e3;n.isLatLon=!1,r.setClipGeometry(n);for(var a=0;a<e.length;a++){var s=[];s.push(e[a]),a==e.length-1?s.push(e[0]):s.push(e[a+1]),r.addProfileGeometry(s),r.build()}}(e.result.object.positions),t.polygon.show=!1,t.polyline.show=!1,t.deactivate()}),(function(e){console.log(e)})),window.handlerPolygon.activate()}function w(){tooltip.setVisible(!1),r.clearProfile(),le()}function v(e){var t=viewer.scene.pickPosition(e.message.position);!function(e){u++,viewer.entities.add({id:"Drill_Point-"+u,position:e,cylinder:{length:100,topRadius:Number(i.drillRadius),bottomRadius:Number(i.drillRadius),material:Cesium.Color.fromCssColorString("#d60000")}})}(t),d.push(t)}function y(e){window.tooltip.setVisible(!1),document.body.classList.remove("measureCur"),g.CartesiantoDegreesObjs(d).forEach((function(e){var t=new Cesium.GeoCylinder(Number(i.drillRadius),Number(i.drillRadius),Number(i.drillHeight)),n=Number(i.drillHeight)/2;t.geoPosition=new Cesium.Point3D(e.longitude,e.latitude,e.height-n),r.addProfileGeometry(t)}));for(var t=1;t<=u;t++)viewer.entities.removeById("Drill_Point-"+t);r.build(),viewer.eventManager.removeEventListener("CLICK",v),viewer.eventManager.removeEventListener("RIGHT_CLICK",y)}function C(){tooltip.setVisible(!1),r.clearProfile(),document.body.classList.remove("measureCur");for(var e=1;e<=u;e++)viewer.entities.removeById("Drill_Point-"+e);viewer.eventManager.removeEventListener("CLICK",v),viewer.eventManager.removeEventListener("RIGHT_CLICK",y),u=0,d.length=0}function b(){w(),le("Box"),a&&(a.deactivate(),a.destroy(),a=null)}function S(){f(),b(),C()}return A.isViewer&&(window.tooltip||(window.tooltip=ee(viewer._element)),m()),e.watch((function(){return A.isViewer}),(function(e){e&&(window.tooltip||(window.tooltip=ee(viewer._element)),m())})),e.watch((function(){return i.modelUrls}),(function(e){r.addModels(e)})),e.watch((function(){return i.stretchHeight}),(function(e){if(i.modelUrls&&0!=i.modelUrls.length){var t,n=h(i.modelUrls);try{for(n.s();!(t=n.n()).done;){var o=t.value.model;r._s3mInstanceCollection._group[o].instances._array[0].updateScale(new Cesium.Cartesian3(1,1,Number(e)))}}catch(e){n.e(e)}finally{n.f()}}})),e.watch((function(){return i.operationType}),(function(e){S()})),e.watch((function(){return i.drawClipMode}),(function(e){r.clippingType=Cesium.ClippingType[e]})),e.watch((function(){return i.clipType}),(function(e){b()})),e.onBeforeUnmount((function(){r.clear(),viewer.scene.globe.show=!0,viewer.scene.skyAtmosphere.show=!0,S(),o=null,r=null,l=null})),s(s({},e.toRefs(i)),{},{drawLine:function(){window.handlerPolyline||ae("Polyline"),window.tooltip.showAt(" <p>点击鼠标左键开始绘制</p><p>鼠标右键结束绘制</p><p>可以绘制多条线段</p>","350px"),se("Polyline").then((function(e){!function(e){var t=[];if(e.length<2)return;for(var i=0;i<e.length-1;i++)t.length=0,t.push(e[i]),t.push(e[i+1]),r.addProfileGeometry(t)}(e.result.object.positions);var t=window.handlerPolyline;t.polyline.show=!1,t.deactivate(),tooltip.setVisible(!1);var i="geologicalbody_cutline-"+(new Date).getTime();c.push(i),viewer.entities.add({id:i,polyline:{positions:e.result.object.positions,width:2,material:Cesium.Color.fromCssColorString("#51ff00")}})}),(function(e){console.log(e)})),window.handlerPolyline.activate()},startCut:function(){tooltip.setVisible(!1),le("Polyline"),0!==c.length?r.build():window.tooltip.showAt(" <p>请先绘制剖切的线段</p>","350px")},clearCut:f,startDig:function(){w(),p()},clearDig:w,startDrilling:function(){C(),viewer.enableCursorStyle=!1,viewer._element.style.cursor="",document.body.classList.add("measureCur"),window.tooltip.showAt(" <p>点击鼠标左键确认钻孔位置</p><p>鼠标右键结束绘制并执行钻孔</p>","350px"),console.log(1),viewer.eventManager.addEventListener("CLICK",v,!0),viewer.eventManager.addEventListener("RIGHT_CLICK",y,!0)},clearDrilling:C,startClip:function(){b(),r.clippingType=Cesium.ClippingType[i.drawClipMode],"drawClip"!==i.clipType?function(){a&&a.deactivate();tooltip.showAt(" <p>点击鼠标左键开始绘制box底面</p><p>然后移动鼠标绘制box高度</p><p>点击鼠标右键结束绘制</p>","350px"),window.handlerBox||ae("Box");se("Box",!1).then((function(e){var t=window.handlerBox;!function(e){e.show=!1;var t=e.box.dimensions.getValue(),i=Cesium.Cartographic.fromCartesian(e.position.getValue(0));if((l=new Cesium.GeoBox(t.x,t.y,t.z)).geoPosition=new Cesium.Point3D(Cesium.Math.toDegrees(i.longitude),Cesium.Math.toDegrees(i.latitude),i.height),r.addProfileGeometry(l),r.build(),a)a.setEditObject(e);else{(a=new Cesium.BoxEditor(viewer,e)).color=Cesium.Color.WHITE.withAlpha(0),a.hoverColor=Cesium.Color.BLUE;var n=function(e){var t=e.dimensions;l.geoWidth=t.y,l.geoHeight=t.z,l.geoLength=t.x;var i=g.CartesiantoDegrees(e.position);l.geoPosition=new Cesium.Point3D(i[0],i[1],i[2]),l.geoRotationZ=a.hpr.heading*(180/Cesium.Math.PI)};a.editEvt.addEventListener(n)}a.activate()}(e.result.object),t.deactivate()}),(function(e){console.log(e)})),window.handlerBox.activate()}():p()},clearClip:b})},volume:function(t){var i,n=e.reactive({dataUrl:"",operationType:"addDate",dimensions:[],variables:[],selectedDateName:null,xDim:100,yDim:200,zDim:9,timeDim:40,drawMode:"volume",opacityInterval:[0,1],useGradientOpacity:!1,gradientOpacityValue:[0,1],gradientOpacity:[0,1],showClipPlane:!1,clipX:.5,clipY:.5,clipRotate:0,xOffset:.5,yOffset:.5,zOffset:.5,contourValue:1,contourRange:[0,1],zScale:0,colorInterval:[0,1],timeOrder:0,timeRange:[0,24],openLight:!1});if(t)for(var o in t)n.hasOwnProperty(o)?n[o]=t[o]:g.Message.errorMsg(re.AttributeError+o);var r,a=new Cesium.Cartesian3(1,1,1),l=new Cesium.Cartesian3(.5,.5,.5),c=Cesium.Plane.fromPointNormal(new Cesium.Cartesian3(0,0,0),new Cesium.Cartesian3(1,0,0));function u(){if(!n.dataUrl)return g.Message.warnMsg("请先定义数据路径！");var e=viewer.scene.addVoxelGridLayer(n.dataUrl,"test");Cesium.when(e,(function(e){i=e,n.dimensions=i._NetCDFInfo.dimensions,n.variables=i._NetCDFInfo.variables,n.selectedDateName=n.variables[0].name,n.xDim=n.dimensions[0].name,n.yDim=n.dimensions[0].name,n.zDim=n.dimensions[0].name,n.timeDim=n.dimensions[0].name,i.layerBounds=new Cesium.Rectangle(99.95422,32.25671,107.1912,37.1386),i.zBounds=new Cesium.Cartesian2(500,5e4)}))}function d(){var e=i.layerBounds.west+(i.layerBounds.east-i.layerBounds.west)*Number(n.clipX),t=i.layerBounds.south+(i.layerBounds.north-i.layerBounds.south)*Number(n.clipY);viewer.entities.removeById("volume-clip-plane"),viewer.entities.add({id:"volume-clip-plane",position:Cesium.Cartesian3.fromDegrees(e,t,5e4),point:{color:Cesium.Color.YELLOW,pixelSize:10}})}return A.isViewer&&(window.tooltip||(window.tooltip=ee(viewer._element)),u()),e.watch((function(){return A.isViewer}),(function(e){e&&(window.tooltip||(window.tooltip=ee(viewer._element)),u())})),e.onBeforeUnmount((function(){viewer.scene.layers.remove(i.name),i=null})),e.watch((function(){return n.drawMode}),(function(e){i&&(i.volumeRenderMode="slice"===e?1:"gradient"===e?2:0)})),e.watch((function(){return n.useGradientOpacity}),(function(e){i&&(i.useGradientOpacity=e)})),e.watch((function(){return n.gradientOpacityValue}),(function(e){i&&(r.gradientMinOpacity=e[0],r.gradientMaxOpacity=e[1],r.setGradientOpacityValue(i))})),e.watch((function(){return n.opacityInterval}),(function(e){i&&(r.opacityMinValue=e[0],r.opacityMaxValue=e[1],r.setColorTable(i))})),e.watch((function(){return n.gradientOpacity}),(function(e){i&&(i.gradientOpacityMinOpacity=e[0],i.gradientOpacityMaxOpacity=e[1])})),e.watch((function(){return n.zScale}),(function(e){i&&(a.z=parseFloat(e),i.scale=a)})),e.watch((function(){return n.colorInterval}),(function(e){i&&(r.visibleMinValue=e[0],r.visibleMaxValue=e[1],r.setColorTable(i))})),e.watch((function(){return n.timeOrder}),(function(e){i&&(i.frameIndex=Number(e))})),e.watch((function(){return n.openLight}),(function(e){i&&(i.enableLighting=e)})),e.watch((function(){return n.clipX}),(function(e){if(i){d();var t=parseFloat(e),o=parseFloat(n.clipY),r=Cesium.Math.toRadians(n.clipRotate),a=Cesium.Quaternion.fromAxisAngle(Cesium.Cartesian3.UNIT_Z,r),s=new Cesium.Cartesian3(t,o,0),l=new Cesium.TranslationRotationScale(s,a),u=Cesium.Matrix4.fromTranslationRotationScale(l);Cesium.Plane.fromPointNormal(new Cesium.Cartesian3(0,0,0),new Cesium.Cartesian3(1,0,0),c),Cesium.Plane.transform(c,u,c)}})),e.watch((function(){return n.clipY}),(function(e){if(i){d();var t=parseFloat(n.clipX),o=parseFloat(e),r=new Cesium.Cartesian3(t,o,0);Cesium.Plane.fromPointNormal(r,new Cesium.Cartesian3(0,1,0),c)}})),e.watch((function(){return n.clipRotate}),(function(e){if(i){var t=parseFloat(n.clipX),o=parseFloat(n.clipY),r=Cesium.Math.toRadians(e),a=Cesium.Quaternion.fromAxisAngle(Cesium.Cartesian3.UNIT_Z,r),s=new Cesium.Cartesian3(t,o,0),l=Cesium.Matrix3.fromQuaternion(a),u=Cesium.Matrix4.fromRotationTranslation(l),d=new Cesium.Cartesian3(1,0,0);d=Cesium.Matrix4.multiplyByPoint(u,d,new Cesium.Cartesian3),Cesium.Plane.fromPointNormal(s,d,c)}})),e.watch((function(){return n.xOffset}),(function(e){i&&(l.x=parseFloat(e),i.sliceCoordinate=l)})),e.watch((function(){return n.yOffset}),(function(e){i&&(l.y=parseFloat(e),i.sliceCoordinate=l)})),e.watch((function(){return n.zOffset}),(function(e){i&&(l.z=parseFloat(e),i.sliceCoordinate=l)})),e.watch((function(){return n.contourValue}),(function(e){i&&(i.contourValue=parseFloat(e))})),s(s({},e.toRefs(n)),{},{startRender:function(){i?n.xDim!=n.yDim&&n.xDim!=n.zDim&&n.yDim!=n.zDim?((r=new Se({opacityMinValue:0,opacityMaxValue:.8,gradientMinOpacity:1,gradientMaxOpacity:1,visibleMinValue:0,visibleMaxValue:.37})).setColorTable(i,0),i.startRender({variableName:n.selectedDateName,xDimName:n.xDim,yDimName:n.yDim,zDimName:n.zDim,timeDimName:n.timeDim}),function(){n.contourRange=[Math.ceil(i.minValue),Math.ceil(i.maxValue)],n.contourValue=Math.ceil(i.minValue);var e=i._NetCDFInfo.recordDimension;e&&e.length>0&&(n.timeRange=[0,e.length])}(),viewer.scene.camera.flyTo({destination:{x:-1688158.0372444934,y:6654029.431965283,z:2998692.1265170774},orientation:{heading:.028840576504810755,pitch:-.8994386458052253,roll:6.283185307179586}})):g.Message.warnMsg("各维度名不能一样"):u()},addClipPlane:function(){!Cesium.defined(i)||i.getNumberOfClipPlanes()>0||(n.showClipPlane=!0,i.addClipPlane(c),d())},removeClipPlane:function(){Cesium.defined(i)&&0!==i.getNumberOfClipPlanes()&&(n.showClipPlane=!1,i.removeAllClipPlanes(),viewer.entities.removeById("volume-clip-plane"))},clear:function(){i&&(viewer.scene.layers.remove(i.name),i=null,u())}})},particle:function(t){var i,n,o,r=e.reactive({particles:[{id:0,iconfont:"iconhuoyan",particleName:"火焰"},{id:1,iconfont:"iconshui",particleName:"水"},{id:2,iconfont:"iconyanhua",particleName:"烟花"}],particleSelectedId:0,flameTyle:"0",fountainTyle:"0",ringRadius:[30,25],emissionRate:50,particleSize:2,particleLife:[1.5,1.6],speed:[3.5,4],startScale:2.5,endScale:1,gravity:0,lifetime:6,particleSystemType:"conical",image:"public/img/particle/基础火焰.png",startColor:"rgba(255, 255, 255, 0.3)",endColor:"rgba(0, 0, 0, 0)",visibleModel:!0,visibleParameter:!1,emitter:["ConeEmitter",[60]],bursts:[]});if(t)for(var a in t)r.hasOwnProperty(a)?null!=t[a]&&(r[a]=t[a]):g.Message.errorMsg(re.AttributeError+a);var l,c,u=!1,d=new Map,m="public/data/s3m/box.s3m",f=[],p=[{minimumRed:.95,green:0,minimumBlue:.8,alpha:1},{red:0,minimumGreen:.75,minimumBlue:.8,alpha:1},{red:0,green:0,minimumBlue:.8,alpha:1},{minimumRed:.9,minimumGreen:.9,blue:0,alpha:1}];function w(){o=new Cesium.S3MInstanceCollection(viewer.scene._context),viewer.scene.primitives.add(o)}function h(e){viewer.scene.globe.show=!e,viewer.scene.sun.show=!e,viewer.scene.globe.enableLighting=!e,viewer.scene.particlePostRender.quality=e?1:.25,viewer.scene.bloomEffect.show=!!e,viewer.scene.bloomEffect.threshold=e?.8:0,viewer.scene.bloomEffect.bloomIntensity=e?3.6:1.34,viewer.scene.skyAtmosphere.show=!e}function v(){window.handlerPolyline||ae("Polyline");var e=new Pe;se("Polyline").then((function(t){var i=window.handlerPolyline;i.polyline.show=!1,window.polylineTransparent.show=!1,i.deactivate(),tooltip.setVisible(!1);var o=t.result.object.positions;e.create(r,o[0]),n=e,b(o[0],n);var a=g.getAngleAndRadian(o[0],o[1]).angle;a=a-90>=0?a-90:a+270;var s=g.getPitch(o[0],o[1]).angle-90;console.log(a,s);var l={heading:a,pitch:s,roll:0};n.particleSystem.emitterModelMatrix=n.computeEmitterModelMatrix(l,{x:0,y:0,z:2},!0)}),(function(e){console.log(e)})),window.handlerPolyline.activate()}function y(e){if(u){var t=viewer.scene.pickPosition(e.message.position);0===r.particleSelectedId?function(e){var t=new Pe;t.create(r,e),b(e,t),n=t,console.log(t)}(t):1===r.particleSelectedId?function(e){var t=new Pe;t.create(r,e),b(e,t),n=t,console.log(t)}(t):function(e){h(!0),c=new Pe;for(var t=0;t<18;++t){for(var i=Cesium.Math.randomBetween(-600,600),n=Cesium.Math.randomBetween(-600,600),o=Cesium.Math.randomBetween(0,200),r=new Cesium.Cartesian3(i,n,o),a=[],s=0;s<3;++s)a.push(new Cesium.ParticleBurst({time:12*Cesium.Math.nextRandomNumber(),minimum:400,maximum:400}));var l=Cesium.Color.fromRandom(p[t%p.length]);c.createFirework(r,l,a,e)}C()}(t)}else{var o=viewer.scene.pick(e.message.position)||viewer.selectedEntity;if(o&&o.id&&"string"==typeof o.id&&-1!=o.id.indexOf("particle-model-")){if(i&&i.id===o.id.id)return;return i=o,n=d.get(o.id),void(l?l.setEditObject(o.primitive):(a=o.primitive,(l=new Cesium.ModelEditor({model:a,scene:viewer.scene,axesShow:{translation:!0,rotation:!1,scale:!1}})).activate(),l.changedEvt.addEventListener((function(e){var t=new Cesium.Cartesian3;Cesium.Matrix4.getTranslation(e.modelMatrix,t),t&&n&&(n.particleSystem.modelMatrix=n.computeModelMatrix(t),n.particleSystem.emitterModelMatrix=n.computeEmitterModelMatrixByHpr(e.rotationAddtion))}))))}i=void 0,n=void 0,l&&l.deactivate()}var a}function C(){window.tooltip.setVisible(!1),document.body.classList.remove("measureCur"),u=!1,viewer.eventManager.removeEventListener("RIGHT_CLICK",C)}function b(e,t,n){var r="particle-model-"+(new Date).getTime();n?o.add(m,{id:r,position:e,hpr:n}):o.add(m,{id:r,position:e}),i=o.getInstance(m,r),d.set(r,t)}return A.isViewer&&(window.tooltip||(window.tooltip=ee(viewer._element)),w()),e.watch((function(){return A.isViewer}),(function(e){e&&(window.tooltip||(window.tooltip=ee(viewer._element)),w())})),e.watch((function(){return r.particleSelectedId}),(function(e){n=null,i=null,2===e&&(r.visibleParameter=!1);var t={};for(var o in 0===e?t=Me[e].particleList[r.flameTyle]:1===e&&(t=Me[e].particleList[r.fountainTyle]),t)r.hasOwnProperty(o)&&(r[o]=t[o])})),e.watch((function(){return r.flameTyle}),(function(e){n=null,i=null,l&&l.deactivate(),r.bursts="4"==e?[new Cesium.ParticleBurst({time:1.5,minimum:80,maximum:150}),new Cesium.ParticleBurst({time:1.7,minimum:150,maximum:200})]:[];var t=Me[r.particleSelectedId].particleList[e];for(var o in t)r.hasOwnProperty(o)&&(r[o]=t[o])})),e.watch((function(){return r.fountainTyle}),(function(e){n=null,i=null,l&&l.deactivate();var t=Me[r.particleSelectedId].particleList[e];for(var o in t)r.hasOwnProperty(o)&&(r[o]=t[o])})),e.watch((function(){return r.emissionRate}),(function(e){n&&(n.particleSystem.emissionRate=Number(e))})),e.watch((function(){return r.particleSize}),(function(e){if(n){var t=Number(e);n.particleSystem.minimumImageSize.x=t,n.particleSystem.minimumImageSize.y=t,n.particleSystem.maximumImageSize.x=t,n.particleSystem.maximumImageSize.y=t}})),e.watch((function(){return r.particleLife}),(function(e){n&&(n.particleSystem.minimumParticleLife=Number(e[0]),n.particleSystem.maximumParticleLife=Number(e[1]))})),e.watch((function(){return r.speed}),(function(e){n&&(n.particleSystem.minimumSpeed=Number(e[0]),n.particleSystem.maximumSpeed=Number(e[1]))})),e.watch((function(){return r.startScale}),(function(e){n&&(n.particleSystem.startScale=Number(e))})),e.watch((function(){return r.endScale}),(function(e){n&&(n.particleSystem.endScale=Number(e))})),e.watch((function(){return r.particleSystemType}),(function(e){if(n)switch(e){case"circular":n.particleSystem.emitter=new Cesium.CircleEmitter(2);break;case"spheroid":n.particleSystem.emitter=new Cesium.SphereEmitter(2.5);break;case"conical":n.particleSystem.emitter=new Cesium.ConeEmitter(Cesium.Math.toRadians(30));break;case"box":n.particleSystem.emitter=new Cesium.BoxEmitter(new Cesium.Cartesian3(10,10,10))}})),e.watch((function(){return r.image}),(function(e){n&&(n.particleSystem.image=e)})),e.watch((function(){return r.startColor}),(function(e){n&&(n.particleSystem.startColor=Cesium.Color.fromCssColorString(e))})),e.watch((function(){return r.endColor}),(function(e){n&&(n.particleSystem.endColor=Cesium.Color.fromCssColorString(e))})),e.watch((function(){return r.visibleModel}),(function(e){o.visible=e,l&&l.deactivate()})),e.watch((function(){return r.ringRadius}),(function(e){n&&(n.particleSystem.emitter=new Cesium.CircleEmitter(e[1],e[0]),"CircleEmitter"===r.emitter[0]&&(r.emitter[1]=e))})),e.watch((function(){return r.lifetime}),(function(e){n&&(n.particleSystem.lifetime=Number(e))})),e.watch((function(){return r.gravity}),(function(e){n&&(n.gravity=Number(e))})),e.onBeforeUnmount((function(){})),s(s({},e.toRefs(r)),{},{addParticle:function(){return viewer.eventManager.addEventListener("CLICK",y,!0),viewer.eventManager.addEventListener("RIGHT_CLICK",C),0==r.particleSelectedId&&"2"==r.flameTyle?(window.tooltip.showAt(" <p>点击鼠标左键开始绘制两点</p><p>右键单击结束绘制</p>","400px"),u=!1,void v()):0==r.particleSelectedId&&"3"==r.flameTyle?(window.tooltip.showAt(" <p>点击鼠标左键绘制区域</p><p>右键单击结束分析</p>","400px"),u=!1,f.forEach((function(e){return e.clear()})),f.length=0,window.handlerPolygon||ae("Polygon"),se("Polygon",!1).then((function(e){tooltip.setVisible(!1);var t=window.handlerPolygon;t.polygon.show=!1,t.polyline.show=!1,t.deactivate();var i=new Pe;i.create(r,void 0,e.result.object.positions),n=i,f.push(i)}),(function(e){console.log(e)})),void window.handlerPolygon.activate()):1==r.particleSelectedId&&"1"==r.fountainTyle?(window.tooltip.showAt(" <p>点击鼠标左键开始绘制两点</p><p>右键单击结束绘制</p>","400px"),u=!1,void v()):(viewer.enableCursorStyle=!1,viewer._element.style.cursor="",document.body.classList.add("measureCur"),u=!0,void(2!=r.particleSelectedId?window.tooltip.showAt(" <p>点击鼠标左键确认位置</p><p>右键单击结束添加</p><p>选中模型进行删除和编辑</p> ","400px"):window.tooltip.showAt(" <p>点击鼠标左键确认烟花中心位置</p>","400px")))},clear:function(){c&&(c.clearFireWoke(),h(!1),c=null),d.forEach((function(e){e.clear()}));var e=Object.fromEntries(d);for(var t in e)console.log("key:",t),d.delete(t),o.removeInstance(m,t);0===d.size&&viewer.eventManager.removeEventListener("CLICK",y),l&&l.deactivate(),u=!1,n=null,le(),viewer.enableCursorStyle=!0,document.body.classList.remove("measureCur"),tooltip.setVisible(!1),le("Polygon"),f.forEach((function(e){return e.clear()})),f.length=0}})}};return"undefined"!=typeof window&&window.Vue&&(window.webgl3d_mc=Ee),Ee}));
